(self.webpackChunklms=self.webpackChunklms||[]).push([[60812],{942518:function(e,r,t){var o=t(708468),n=t(730381),i=t(904072),c=t(993776),a=t(361204);t(682772),t(66992),t(185827),t(702707),t(140561),t(556977),t(324603),t(339714),t(115306),t(323123),t(333948);var s=t(693604);r.duration=()=>function(e){var r=o.filter(e.syllabuses||[],(e=>n(e.date).isValid()));if(0===r.length)return"";var t=r[0],c=r[r.length-1],a="YYYY.MM.DD";return n.locale(i("html").attr("lang")),"".concat(n(t.date).format(a)," ~ ").concat(n(c.date).format(a))},r.formatTime=()=>e=>s.formatTime(e),r.statFormatTime=()=>function(e){return e?s.formatTime(e):"- -"},r.humanizeBytes=()=>function(e){var r=["Bytes","KB","MB","GB","TB"];if(0===e)return"0 "+r[0];var t=parseInt(Math.floor(Math.log(e)/Math.log(1024)));return Math.round(e/Math.pow(1024,t),2)+" "+r[t]},r.humanizeSpeed=()=>function(e){var r=["Bytes/s","KB/s","MB/s","GB/s","TB/s"];if(0===e)return"0 "+r[0];var t=parseInt(Math.floor(Math.log(e)/Math.log(1024)));return Math.round(e/Math.pow(1024,t)*100,2)/100+" "+r[t]},r.courseFilter=()=>function(e,r){return!!e&&o.filter(e,(function(e){var t=r.notStarted&&"notStarted"===e.status,o=r.ongoing&&"ongoing"===e.status,n=r.closed&&"closed"===e.status;return t||o||n}))},r.limitLength=()=>function(e,r){var t=!r||!("number"==typeof r)||r<=3,o=!e||!("string"==typeof e)||e.length<=3;return t||o||e.length<=r?e:"".concat(e.substring(0,r-3),"...")},r.formatScore=()=>s.formatScore,r.statDatetime=()=>function(e){if(!e)return"- -";n.locale(i("html").attr("lang"));var r=n(e);return r.isValid()?r.format("YYYY.MM.DD HH:mm"):e},r.percent=()=>function(e,r){if(e||(e="0"),null!=e&&/^\d+\.?\d*$/.test(e)){if(r){var t=new c(e);return t=t<0?0:t.toFixed(r,c.ROUND_HALF_UP),"".concat(t,"%")}return"".concat(e,"%")}return e},r.truncateText=["$sanitize",e=>function(r,t){var o,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],c=()=>"<div>"+r+"</div>";if("string"!=typeof(r=e(r)))return r;n&&(o=c());var a=n?i(o).text().replace(/\t|\n/g,""):r;return a.length>t?"".concat(a.substr(0,t-3),"..."):a}],r.fileName=()=>function(e){if(!o.contains(e,"."))return e;var r=e.split(".");return r.pop(),r.join(".")},r.fileExtension=()=>function(e){if(!o.contains(e,"."))return"";var r=e.split(".");return".".concat(r.pop())},r.clearText=["$sanitize",e=>function(r){return r&&""!==r?e(r.replace(/<|>/g,(function(e){return"<"===e?"&lt;":"&gt;"})).replace(/\n/g,"<br/>")):""}],r.sanitizeHtml=["$sanitize",e=>function(r){var t=e(r),o={"rgb(227, 55, 55)":"color-E33737","rgb(226, 139, 65)":"color-E28B41","rgb(200, 167, 50)":"color-C8A732","rgb(32, 147, 97)":"color-209361","rgb(65, 140, 175)":"color-418CAF","rgb(170, 135, 115)":"color-AA8773","rgb(153, 153, 153)":"color-999999"},n=i(t="<div>"+t+"</div>");i("*[style]",n).each((function(e,r){if(o.hasOwnProperty(r.style.color)&&r.classList.add(o[r.style.color]),r.style.marginLeft){var t=Math.min(Math.round(parseInt(r.style.marginLeft)/40),10);r.classList.add("margin-level-"+t)}var n=r.style.fontSize;if(n&&(/px/.test(n)&&parseInt(n)<12||/em/.test(n)&&parseFloat(n)<.6))return r.style.fontSize="12px"}));var c=n.toArray().reduce(((e,r)=>e+r.outerHTML),"");return c.substring(5,c.length-6)}],r.year=()=>function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"-";return a.isString(e)?e.split(r)[0]:e},r.month=()=>function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"-";return a.isString(e)?e.split(r)[1]:e},r.day=()=>function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"-";return a.isString(e)?e.split(r)[2]:e},r.trustSrc=["$sce",e=>r=>e.trustAsResourceUrl(r)],r.scoreAsActivity=()=>function(e){var r;if(!e.score||!e.score_percentage)return"0";r=e.score>100?100:e.score,r=new c(r);var t=new c(e.score_percentage);return r.times(t).dividedBy(100).toFixed(1)},r.uuidFilter=()=>function(e){return e&&0===e.indexOf("_uuid_")?"":e};var u=e=>String.fromCharCode(65+e%26);r.intToChar=()=>function(e){return a.isNumber(e)?u(e):a.isArray(e)&&o.all(e,a.isNumber)?o.map(e,u).join(" "):e},r.contains=()=>(e,r)=>-1!==e.indexOf(r),r.trustAsHtml=["$sce",e=>r=>e.trustAsHtml(r)],r.removeHtmlTag=["$sce",e=>e=>e.replace(/<[^>]+>/g,"").replace(/&nbsp;/gi," ")],r.replaceImgTag=["$sce",e=>e=>e.replace(/<img.*?(?:>|\/>|img>|\/img>)/gi," [image] ")];var l=RegExp(/&(?:amp|lt|gt|quot|#39|#96);/g.source);r.unescape=()=>function(e){return Array.isArray(e)?o.map(e,(e=>unescape(e))):(e=null==(r=e)?"":r+"")&&l.test(e)?o.unescape(e):e;var r},r.displayName=()=>function(e){return"object"!=typeof e?"":"True"===i("#showNickname").val()&&e.nickname?"".concat(e.name," (").concat(e.nickname,")"):e.name||""},r.displayUserNo=()=>function(e){return e.length>14?"".concat(e.substr(0,5),"...").concat(e.substring(e.length-5)):e},r.insert=()=>function(e,r){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(null==e)return e;var o=[...e];return o.splice(t,0,r),o},r.orderBySort=()=>function(e){return Array.isArray(e)?(e.sort(((e,r)=>0===e.sort?1:0===r.sort?-1:e.sort-r.sort)),e):e}},683257:function(e,r,t){var o=t(708468);e.exports=["$http","toastr",function(e,r){return{getMyGroup(r,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o.noop;return e.get("/api/group-sets/".concat(r,"/group")).success(t).error(n)},getGroupSets(t){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0,i={};return null!=o&&(i.preload_id=o),e.get("/api/courses/".concat(t,"/group-sets"),{params:i}).success(n).error(r.decorateError())},getGroupSet:(t,o)=>e.get("/api/group-sets/".concat(t)).success(o).error(r.decorateError()),addGroupSet(t,n,i){var c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:o.noop;return e.post("/api/courses/".concat(t,"/group-sets"),n).success(i).error(r.decorateError(c))},updateGroupSet(t,n,i){var c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:o.noop;return e.put("/api/group-sets/".concat(t),n).success(i).error(r.decorateError(c))},deleteGroupSet:(t,o)=>e.delete("/api/group-sets/".concat(t)).success(o).error(r.decorateError()),copyGroupSet(t,n,i,c){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:o.noop;return e.post("/api/courses/".concat(t,"/group-sets/").concat(n,"/copy"),{name:i}).success(c).error(r.decorateError(a))},getStudents(t,o){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i={ignore_avatar:arguments.length>2&&void 0!==arguments[2]&&arguments[2]};return n&&(i.fields=n),e.get("/api/course/".concat(t,"/students"),{params:i}).success(o).error(r.decorateError())},getEnrollments:(t,o)=>e.get("/api/course/".concat(t,"/enrollments")).success(o).error(r.decorateError()),getGroups(r,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o.noop,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,c={};return i&&(c.fields=i),e.get("/api/group-sets/".concat(r,"/groups"),{params:c}).success(t).error(n)},updateGroup(t,n,i){var c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:o.noop;return e.put("/api/groups/".concat(t.id),n).success(r.decorateSuccess(i)).error(r.decorateError(c))},addGroupMembers(t,n,i){var c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:o.noop;return e.put("/api/groups/".concat(t.id,"/members"),n).success(r.decorateSuccess(i)).error(r.decorateError(c))},deleteGroupMember(t,n,i){var c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:o.noop;return e.delete("/api/groups/".concat(t.id,"/members/").concat(n.id)).success(r.decorateSuccess(i)).error(r.decorateError(c))},updateGroupMember(t,n,i,c){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:o.noop;return e.put("/api/groups/".concat(t.id,"/members/").concat(n.id),i).success(r.decorateSuccess(c)).error(r.decorateError(a))},updateGroupInfo(t,n,i){var c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:o.noop;return e.put("/api/groups/".concat(t,"/info"),n).success(r.decorateSuccess(i)).error(r.decorateError(c))},addGroup(t,n,i){var c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:o.noop;return e.post("/api/group-sets/".concat(t,"/groups"),n).success(r.decorateSuccess(i)).error(r.decorateError(c))},deleteGroup(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o.noop;return e.delete("/api/groups/".concat(t.id)).success(r.decorateSuccess(n)).error(r.decorateError(i))},sortGroups(t,n,i){var c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:o.noop;return e.put("/api/group-sets/".concat(t.id,"/sort"),{groupsSorting:n}).success(r.decorateSuccess(i)).error(r.decorateError(c))},uploadFileToGroup(t,n,i){var c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:o.noop;return e.put("/api/groups/".concat(t.id,"/upload"),{uploads:n}).success(r.decorateSuccess(i)).error(r.decorateError(c))},deleteFile(t,n,i){var c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:o.noop;return e.delete("/api/groups/".concat(t.id,"/upload/").concat(n.reference_id)).success(r.decorateSuccess(i)).error(r.decorateError(c))},batchDownload(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o.noop;return e.post("/api/uploads/batch/blob",{id:t}).success(n).error(r.decorateError(i))},sendBatchDownload(t,n,i){var c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:o.noop;return e.post(t,{data:n}).success(i).error(r.decorateError(c))},randomGrouping(t,n,i){var c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:o.noop;return e.post("/api/group-sets/".concat(t,"/random-grouping"),n).success(r.decorateSuccess(i)).error(r.decorateError(c))},exportCourseGroupSetInfoToExcel(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o.noop;return e({url:"/api/courses/".concat(t,"/group-sets/export/excel"),method:"GET",responseType:"arraybuffer"}).success(r.decorateSuccess(n)).error(r.decorateError(i))},exportGroupSetInfoToExcel(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o.noop;return e({url:"/api/group-sets/".concat(t,"/export/excel"),method:"GET",responseType:"arraybuffer"}).success(r.decorateSuccess(n)).error(r.decorateError(i))},getGroupsSubmissionStatusOfUser(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o.noop;return e.get("/api/courses/".concat(t,"/groups/submission-status")).success(n).error(r.decorateError(i))},getActivitiesByGroupSet(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o.noop;return e.get("/api/group-sets/".concat(t,"/activities")).success(n).error(r.decorateError(i))},getTeachingTeamGroups(r,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o.noop;return e.get("/api/courses/".concat(r,"/teaching-team/groups")).success(t).error(n)}}}]},194410:function(e,r,t){var o=t(904072),n=t(708468);function i(e,r){return function(e){if(Array.isArray(e))return e}(e)||function(e,r){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var t=[],o=!0,n=!1,i=void 0;try{for(var c,a=e[Symbol.iterator]();!(o=(c=a.next()).done)&&(t.push(c.value),!r||t.length!==r);o=!0);}catch(e){n=!0,i=e}finally{try{o||null==a.return||a.return()}finally{if(n)throw i}}return t}(e,r)||a(e,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(e,r){var t;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(t=a(e))||r&&e&&"number"==typeof e.length){t&&(e=t);var o=0,n=function(){};return{s:n,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,c=!0,s=!1;return{s:function(){t=e[Symbol.iterator]()},n:function(){var e=t.next();return c=e.done,e},e:function(e){s=!0,i=e},f:function(){try{c||null==t.return||t.return()}finally{if(s)throw i}}}}function a(e,r){if(e){if("string"==typeof e)return s(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?s(e,r):void 0}}function s(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,o=new Array(r);t<r;t++)o[t]=e[t];return o}t(66992),t(569720),t(115306),t(573210),t(454747),t(333948);var u=t(554174).checkUserLarkAuth,l=t(693604),p=t(117403).default;e.exports=["commonApi","config","toastr","$http",function(e,r,t,a){var s="True"===o("#enrollmentIsStudent").val(),d=function(e){if(!e.type)return"slide";if("scorm"===e.type)return"scorm";if("evercam"===e.type)return"evercam";if("folder"===e.type)return"folder";if("video-quiz"===e.type)return"video-quiz";if("subject-lib"===e.type)return"subject-lib";if("lesson-resource"===e.type)return"lesson-resource";if("link"===e.type)return"link";if("other"===e.type)return"other";var t=l.fileExtension(e.name,!0);return n.include(r.SUPPORTED_VIDEO_FORMATS,t)?"video":n.include(r.SUPPORTED_AUDIO_FORMATS,t)?"audio":n.include(r.SUPPORTED_IMAGE_FORMATS,t)?"image":n.include(r.SUPPORTED_DOCUMENT_FORMATS,t)?"document":n.include(r.SUPPORTED_FLASH_FORMATS,t)?"swf":"file"===e.type?"file":"other"},f=function(e){return e.isThirdPartResource="third_part_resource"===m.tab,e.selectable=!n.isFunction(m.checkIsSelectable)||m.checkIsSelectable(e),"lark"===m.tab?(e.allow_download=!1,e.allow_forward_seeking=!1,e.origin_allow_download=!1,e.source="LARK",e.status="ready",e.selected=!!n.find(m.selectedUploads,{token:e.token,source:"LARK"}),e.deleted=!1):"wedrive"===m.tab?(e.allow_download=!1,e.allow_forward_seeking=!1,e.origin_allow_download=!1,e.source="WEDRIVE",e.status="ready",e.selected=!!n.find(m.selectedUploads,{fileid:e.fileid,source:"WEDRIVE"}),e.selectable=1!==e.file_type,e.deleted=!1):("academic_learning_platform"!==m.tab&&(e.type=d(e),e.selected=!!n.find(m.selectedUploads,{id:e.id,isThirdPartResource:e.isThirdPartResource})),"academic_learning_platform"===m.tab?(e.allow_download=!1,e.allow_forward_seeking=!1,e.origin_allow_download=!0,e.source="SHTVU",e.status="ready",e.deleted=!1):void 0)},m={showLarkSpace:!0,showAcademicLearningPlatformTab:!1,tab:"repository",fileType:"all",mode:"thumbnail",keyword:"",searching:!1,selectedUploads:[],singleSelectedUpload:void 0,supportFormat:[],limitTypes:[],singleSelect:!1,context:{},filters:[],linkTypes:[],path:[],identifyFileType:d,pagination:{currentList:[],currentPage:1,totalPage:1,inputPage:1},uploadFileAllowList:[],uploadFileAllowListMap:"",resetPagination(){m.pagination={currentList:[],currentPage:1,totalPage:1,inputPage:1}},changeFileType:(e,r)=>(m.fileType=e,m.path=[],m.changePage(1,r)),getDefaultFileType:()=>1===m.limitTypes.length?m.limitTypes[0]:"all",changePath:(e,r)=>(m.path.push(e),m.changePage(1,r)),addUploads:e=>r.load().then((()=>(()=>{var r,t=[],o=c(e);try{for(o.s();!(r=o.n()).done;){var n=r.value;"academic_learning_platform"!==m.tab&&(n.type=d(n)),t.push(m.pagination.currentList.unshift(n))}}catch(e){o.e(e)}finally{o.f()}return t})())),removeUpload:e=>n.remove(m.pagination.currentList,{id:e.id}),cleanCreateFailed:()=>n.remove(m.pagination.currentList,{createFailed:!0}),search:e=>(m.searching=m.keyword.trim().length>0,m.selectedUploads=[],m.changePage(1,e)),changePage:(o,n)=>function(o,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,c=function(e){var t,n=e.uploads||e.resources||(null===(t=e.data)||void 0===t?void 0:t.items)||[];return r.load().then((()=>n.map((e=>f(e))))),m.pagination={currentList:n,currentPage:e.page,totalPage:e.pages,inputPage:e.page},o()},s=function(e){return m.pagination={currentList:[],currentPage:1,totalPage:1,inputPage:1},o(),t.error(e.message)},l=()=>{u().then((e=>{if(!e.data.authorized){var r="".concat(e.data.authorization_url,"&state=").concat(window.location.pathname);window.open(r,"_self")}}))},p=m.searching?m.keyword:"",d={keyword:p,includeSlides:m.context.includeSlides,includeSubjectLibs:m.context.includeSubjectLibs,includeVideoQuizzes:m.context.includeVideoQuizzes,includeLessonResources:m.context.includeLessonResources,limitTypes:m.limitTypes,fileType:m.fileType,fileExts:m.fileExts,parentId:m.path.length>0?m.path[m.path.length-1].id:0,folderToken:m.path.length>0?m.path.at(-1).token:"",resourceType:m.path.length>0?m.path[m.path.length-1].resource_type:null,filters:m.filters,linkTypes:m.linkTypes};if("repository"===m.tab)return e.getUserResources(n,i,d,c,s);if("third_part_resource"===m.tab)return e.getThirdPartUserResources(n,i,d,c,s);if("lark"===m.tab)return l(),e.getResourceFromLark(n,i,d.folderToken,c,s);if("wedrive"===m.tab){var g="/api/wedrive/files?page=".concat(n,"&page_size=").concat(i);m.path.length>0&&(g="/api/wedrive/files?page=".concat(n,"&page_size=").concat(i,"&file_id=").concat(m.path.at(-1).fileid)),a.get(g).success(c).error(s)}return"other_video_resources"===m.tab?e.getOtherVideoResources(n,i,c,s):"academic_learning_platform"===m.tab?e.getAcademicLearningPlatformResources(n,i,p,m.courseCode,m.filterFileTypes,c,s):void 0}(n,o),getSelectedUploads:()=>m.singleSelect?m.singleSelectedUpload?[m.singleSelectedUpload]:[]:m.selectedUploads,copySelectedThirdPartResources(r){var t=m.getSelectedUploads();return 0===n.filter(t,{isThirdPartResource:!0}).length?r(t):function(r,t){return e.copyThirdPartResources(n.filter(r,{isThirdPartResource:!0}).map((e=>e.id)),(function(e){var o=e.uploads||[];return t(o.concat(n.filter(r,{isThirdPartResource:!1})))}),(function(){}))}(t,r)},clearSelected(){var e,r=c(m.pagination.currentList);try{for(r.s();!(e=r.n()).done;){e.value.selected=!1}}catch(e){r.e(e)}finally{r.f()}return m.selectedUploads=[],m.singleSelectedUpload=void 0},getSupportFormatString(e){if(m.fileExts&&m.fileExts.length)return".".concat(m.fileExts.join(",."));var r,t=[],o=c(e);try{for(o.s();!(r=o.n()).done;){var n=r.value;t=t.concat(m.supportFormat[n])}}catch(e){o.e(e)}finally{o.f()}return 0===t.length&&(t=s?m.getLimitUploadedFileAllowList():l.getSupportedFormats()),".".concat(t.join(",."))},getSupportFormatMsg:e=>m.getSupportFormatString(e).replace(/\./g,""),getSupportFormatMsgWithSpaces:e=>m.getSupportFormatString(e).replace(/\./g," ").replace(/^[\s]+/,""),verifyPageIndexInput(){if(m.pagination.inputPage){var e=String(m.pagination.inputPage).replace(/\./,"");return m.pagination.inputPage=isNaN(e)||e<1||e>m.pagination.totalPage?m.pagination.currentPage:parseInt(e)}},setLimitUploadedFiles(e){var r=o("#courseId").val(),t=e=>{var r="<p></p>";if(s){m.uploadFileAllowList.push(...e.limit_upload_file_allowlist_list);var t=e.limit_upload_file_allowlist_map;Object.entries(t).forEach((e=>{var t=i(e,2),o=t[0],c=t[1];if(!n.isEmpty(c)){var a=c.join(", "),s=p.t("limitType.".concat(o)),u="<p>".concat(s,": ").concat(a,"</p>");r=r.concat(u)}}))}else{var o="\n              <p>".concat(p.t("limitType.video"),"：avi, wmv, mov, mp4, mpg, rm, rmvb, mkv, webm, flv, mp3, </br> wma, wav, m4a, m4v</p>\n              <p>").concat(p.t("limitType.audio"),"：mp3, wma, wav, m4a</p>\n              <p>").concat(p.t("limitType.image"),"：jpg, jpeg, png, webp, gif, bmp, heic</p>\n              <p>").concat(p.t("limitType.document"),"：txt, doc, docx, ppt, pptx, xls, xlsx, csv, pdf, rtf, odt, odp, ods</p>\n              <p>").concat(p.t("limitType.archive"),"：zip, rar, tar</p>");r=r.concat(o)}m.uploadFileAllowListMap=r};if(s)return a.get("/api/user/course/".concat(r,"/uploaded-file-allowlist")).success((e=>{t(e)})).error((()=>{}));t(null)},getLimitUploadedFileAllowList:()=>m.uploadFileAllowList,getLimitUploadedFileAllowListMap:()=>m.uploadFileAllowListMap};return r.load().then((function(){return m.supportFormat.video=r.SUPPORTED_VIDEO_FORMATS,m.supportFormat.audio=r.SUPPORTED_AUDIO_FORMATS,m.supportFormat.document=r.SUPPORTED_DOCUMENT_FORMATS,m.supportFormat.image=r.SUPPORTED_IMAGE_FORMATS,m.supportFormat.scorm="zip",m.supportFormat.evercam="zip",m.supportFormat.swf=r.SUPPORTED_FLASH_FORMATS,m.supportFormat["open-office"]=r.SUPPORTED_OPEN_OFFICE_FORMATS})),m}]},330459:function(e,r,t){var o=t(904072),n=t(361204);e.exports=["toastr","performanceApi","$q",function(e,r,t){var i,c=o("#courseId").val(),a=t.defer(),s=null,u={},l=null,p=null,d={};return{initScorePercentage(){if(!d.id){r.getPerformanceScorePercentage(c,(function(e){return n.copy(e,d),a.resolve(d)}),(e=>a.reject(e)))}return a.promise},updateScorePercentage(e){d.score_percentage=e},clearCachedCourseStudentsPerformance(){s=null},initCourseStudentsPerformance(){return s?s.promise:this.refreshCourseStudentsPerformance()},initCourseStudentByUserId(e){if(u[e])return u[e];var o=t.defer();return r.initCourseStudentPerformance(c,e,(r=>{u[e]=r,o.resolve(r)})),o.promise},clearSpecificCachedStudentPerformance(e){u[e]&&(u[e]=null)},clearAllCachedStudentPerformance(){u={}},initCoursePagedStudentsPerformance(e){var o=t.defer();return r.initCoursePagedStudentsPerformance(c,e.pageIndex,e.pageSize,e.condition,(e=>o.resolve(e))),o.promise},initCourseStudentsName(){if(i)return i.promise;i=t.defer();return r.initCourseStudentsName(c,(e=>i.resolve(e))),i.promise},refreshCourseStudentsPerformance(){s=t.defer();return r.initCourseStudentsPerformance(c,(e=>s.resolve(e)),(function(){})),s.promise},initCoursePerformanceScoreSetting(){if(l)return l.promise;l=t.defer();return r.initCoursePerformanceScoreSetting(c,(e=>l.resolve(e)),(function(){})),l.promise},updateCoursePerformanceScoreSetting(){l=null},getCourseLeftScorePercent(){if(p)return p.promise;p=t.defer();return r.getLeftScorePercentage(c,(e=>p.resolve(e)),(function(){})),p.promise}}}]},776405:function(e,r,t){var o=t(708468);e.exports=["$http","toastr","commonApi",function(e,r,t){return{getPerformanceScorePercentage:t.getPerformanceScorePercentage,getPerformanceScoreSetting(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o.noop;return e.get("/api/course/".concat(t,"/performance/score-setting")).success(n).error(r.decorateError(i))},updatePerformanceScoreSetting(r,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:o.noop;return e.put("/api/course/".concat(r,"/performance/score-setting"),t).success(n).error(i)},getInteractions:r=>e.get("/api/courses/".concat(r,"/interactions")),saveInteractionScores:(r,t)=>e.put("/api/courses/interactions/".concat(r,"/score"),t),updateVoteById:(r,t)=>e.put("/api/courses/interactions/vote/".concat(r),t),initCourseStudentsPerformance(r,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o.noop;return e.get("/api/course/".concat(r,"/students-performance?isOriginalScore=true")).success(t).error(n)},initCoursePagedStudentsPerformance(r,t,n,i,c){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:o.noop;return e.get("/api/course/".concat(r,"/students-performance?isOriginalScore=true"),{params:{page:t,page_size:n,conditions:i}}).success(c).error(a)},initCourseStudentsName(r,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o.noop;return e.get("/api/course/".concat(r,"/students-performance?isOriginalScore=true&onlyStudentsName=true")).success(t).error(n)},initCourseStudentPerformance(r,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:o.noop;return e.get("/api/course/".concat(r,"/students-performance?isOriginalScore=true"),{params:{conditions:{user_ids:Array.isArray(t)?t:[t]}}}).success(n).error(i)},initCoursePerformanceScoreSetting(r,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o.noop;return e.get("/api/course/".concat(r,"/performance/score-setting")).success(t).error(n)},saveStudentPerformanceScore(r,t,n,i){var c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:o.noop;return e.put("/api/course/".concat(r,"/performance/score"),{student_id:t,score:n}).success(i).error(c)},getLeftScorePercentage(r,t,o){var n="/api/course/".concat(r,"/score-percentages");return e.get(n).success(t).error(o)}}}]},301253:function(e,r,t){var o=t(904072),n=t(361204);function i(e,r){var t;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(t=function(e,r){if(!e)return;if("string"==typeof e)return c(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(e);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return c(e,r)}(e))||r&&e&&"number"==typeof e.length){t&&(e=t);var o=0,n=function(){};return{s:n,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){t=e[Symbol.iterator]()},n:function(){var e=t.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==t.return||t.return()}finally{if(s)throw i}}}}function c(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,o=new Array(r);t<r;t++)o[t]=e[t];return o}e.exports=["toastr","$q","commonApi","groupApi",function(e,r,t,c){var a=o("#courseId").val(),s=r.defer(),u=null,l={},p={init:()=>(d(),s.promise),updateSetting:e=>(n.copy(e,l),l.has_advanced_rules=!!(l.arrive_late_as_absence||l.max_absence_times||l.leave_early_as_absence||l.on_personal_leave_as_absence)),setting:l,initGroupSets:function(){if(u)return u.promise;u=r.defer();return c.getGroupSets(a,0,(function(e){var r,t={},o=i(e.group_sets);try{for(o.s();!(r=o.n()).done;){var n=r.value;t[n.id]=n}}catch(e){o.e(e)}finally{o.f()}return u.resolve(t)})),u.promise},getGroups:function(e){var t=r.defer();return null!=e.groups?t.resolve(e.groups):c.getGroups(e.id,(function(r){return e.groups=r.groups,t.resolve(e.groups)}),t.reject,"name,members"),t.promise}},d=function(){return t.getCourseRollcallSetting(a,(function(e){return n.copy(e,p.setting),s.resolve(p.setting),p.updateSetting(e)}),(e=>s.reject(e)))};return p}]},548373:function(e,r,t){var o=t(904072),n=t(708468),i=t(993776),c=t(361204);function a(e,r){return function(e){if(Array.isArray(e))return e}(e)||function(e,r){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var t=[],o=!0,n=!1,i=void 0;try{for(var c,a=e[Symbol.iterator]();!(o=(c=a.next()).done)&&(t.push(c.value),!r||t.length!==r);o=!0);}catch(e){n=!0,i=e}finally{try{o||null==a.return||a.return()}finally{if(n)throw i}}return t}(e,r)||function(e,r){if(!e)return;if("string"==typeof e)return s(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(e);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return s(e,r)}(e,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,o=new Array(r);t<r;t++)o[t]=e[t];return o}t(491038),t(185827),t(556977),t(454747);var u=t(180736);e.exports=["$rootScope","$scope","$http","$timeout","toastr","rollcallRepository","onlineVideoCompletenessRepository","$q","performanceRepository","modelHelper","scoreRepository","$window",function(e,r,t,s,l,p,d,f,m,g,v,y){var h=o("#courseId").val();r.errorMessage="",r.ui.validTotalPercentage=!0,r.ui.isPercentage100=r.ui.isPercentage100||!1,r.getActivityGreyIcon=g.getActivityGreyIcon,r.getActivityI18nMessage=g.getActivityI18nMessage,r.courseScoreSetting=r.courseScoreSetting||{},r.courseTemplatParams=r.courseScoreSetting.CourseTemplateParms||{},r.percentageData=r.percentageData||{},r.activityListFromMaster=[];var S=u(r),_=["online_video","interaction","homework","exam","forum"];r.isShowObe=e=>_.includes(e);var b=function(e){var t;if([r.scoreLeftPercent].every(Boolean)){var o=n.any(e,(e=>isNaN(e.score_percentage))),c=new i(r.rollcallSetting.score_percentage||0).plus(new i((null===(t=r.onlineVideoCompletenessSetting)||void 0===t?void 0:t.score_percentage)||0)).plus(new i(r.performanceSetting.score_percentage||0));o||(c=c.plus(n.reduce(e,(function(e,r){var t=r.score_percentage;return t?e.plus(new i(t)):e.plus(new i(0))}),new i(0))));var a=new i(r.scoreLeftPercent.score_percentage_total)-c;r.courseScoreSetting.limitCourseScorePercent=r.courseScoreSetting.limitCourseScorePercent?r.courseScoreSetting.limitCourseScorePercent:r.scoreLeftPercent.score_percentage_total,a=a<0?0:a.toFixed(1,i.ROUND_HALF_UP),r.totalPercentage=isNaN(c)?"-":"".concat(c,"%"),r.remainingPercentage=isNaN(a)?"-":"".concat(a,"%"),r.ui.validTotalPercentage=!isNaN(c)&&c>=0&&c<=100,r.ui.isPercentage100=100===c,r.courseScoreSetting.currentPercentage=isNaN(c)?0:c;var s=r.courseScoreSetting.currentPercentage-r.courseScoreSetting.limitCourseScorePercent;r.courseScoreSetting.excessPercentage=s>0?s:0}},w=function(){r.customScoreItemList?b(r.activityList.concat(r.customScoreItemList)):b(r.activityList),r.loading=!1},P=e=>n.forEach(e,(function(e){if(!e[1]||!e[0])return!0;var r=parseFloat(e[1].score_percentage);return e[0].score_percentage=r,e[1].score_percentage=r}));r.onChangeInput=function(e){"0."!==e&&(r.errorMessage="",r.errors={},w())},r.save=function(){S.show();var i={activity_score_percentages:n.map(r.activityList,(e=>({id:e.id,type:e.type,score_percentage:e.score_percentage,metrics:e.metrics}))),custom_score_percentages:n.map(r.customScoreItemList,(e=>({id:e.id,percentage:e.score_percentage,metrics:e.metrics}))),rollcall_score_percentage:r.rollcallSetting.score_percentage,performance_score_percentage:r.performanceSetting.score_percentage,online_video_completeness_score_percentage:r.onlineVideoCompletenessSetting.score_percentage,online_video_obe_metrics:r.onlineVideoCompletenessSetting.metrics};return t.put("/api/course/".concat(h,"/course-advance-setting"),{params:r.courseTemplatParams}),t.put("/api/courses/".concat(h,"/score-percentages"),i).success((function(){if(S.hide(),"excess"==r.courseScoreSetting.popupType)return o("#score-percentage-popup").foundation("reveal","close"),l.success(),void e.$broadcast("scorePercentageUpdated");P(n.zip(r.activities,r.activityList)),P(n.zip(r.customScoreItems,r.customScoreItemList)),r.percentageData.activityList=c.copy(r.activityList),r.percentageData.customScoreItemList=c.copy(r.customScoreItemList),p.updateSetting(r.rollcallSetting),m.updateScorePercentage(r.performanceSetting.score_percentage),d.updateScorePercentage(r.onlineVideoCompletenessSetting.score_percentage),e.$broadcast("scoreChanged"),o("#score-percentage-popup").foundation("reveal","close"),window.location.reload()})).error((function(e,t){S.hide(),400===t&&(r.errorMessage=function(e){if(e.rollcall_score_percentage)return e.rollcall_score_percentage[0];if(e.performance_score_percentage)return e.performance_score_percentage[0];if(e.online_video_completeness_score_percentage)return e.online_video_completeness_score_percentage[0];var r=e=>"string"==typeof e,t="",o=e.custom_score_percentages;return n.any(o,(function(e){if(r(e))t=e;else{if(!e.percentage)return!1;t=e.percentage[0]}return!0})),t||(o=e.activity_score_percentages,n.any(o,(function(e){if(r(e))t=e;else{if(!e.score_percentage)return!1;t=e.score_percentage[0]}return!0})),t)}(e.errors),r.errors=e.errors),404===t&&(o("#score-percentage-popup").foundation("reveal","close"),l.error(e.message),window.location.reload())}))};var A=function(e){r.customScoreItemListCopy=c.copy(r.percentageData.customScoreItemList);var t=n.groupBy(e,(e=>e.from_master?"master":"child"));t.child?r.activityList=t.child:r.activityList=[],t.master&&(r.activityListFromMaster=t.master),r.customScoreItemListCopy&&(r.customScoreItemList=r.customScoreItemListCopy)};r.closePopup=function(){if(r.isChild&&"excess"==r.courseScoreSetting.popupType){if(window.opener)return y.close();y.location.href="/user/courses"}else o("#score-percentage-popup").foundation("reveal","close")},y.addEventListener("obe-metrics-changed-event",(e=>{if(e.detail&&e.detail.activityType){var t=e.detail.activityType,o=e.detail.activityId;"custom_score"===t?r.customScoreItemList.forEach((r=>{r.id===o&&(r.metrics=e.detail.metrics)})):"online_video"===t?r.onlineVideoCompletenessSetting.metrics=e.detail.metrics:r.activityList.forEach((r=>{r.type===t&&r.id===o&&(r.metrics=e.detail.metrics)}))}})),r.$watch("allowVirtualExperiment",(function(){r.allowVirtualExperiment&&v.initVirtualExperimentPercentages().then((e=>{var t=c.copy(e);r.activityList=r.activityList.concat(t),r.activityList=n.sortBy(r.activityList,["module_sort","syllabus_sort","sort","created_at"]),r.isChild&&A(r.activityList),w()}))}));var T=function(){r.openObeMetric&&f.all([v.initCourseObeMetrics(),v.initActivityMetricSetting()]).then((function(){var e=Array.from(arguments.length<=0?void 0:arguments[0]),t=a(e,2),o=t[0],n=t[1],i=["obe_metrics",h].join("_"),c={metrics:[],selected:{},programs:1};window.localStorage.removeItem(i),200===o.status&&(c.metrics=o.data.metrics,c.programs=o.data.programs),200===n.status&&(c.selected=n.data),window.localStorage.setItem(i,JSON.stringify(c)),r.obeMetricsInited=!0}))},E=function(){"excess"==r.courseScoreSetting.popupType&&setTimeout((function(){r.errors={activity_score_percentages:[],custom_score_percentages:[],performance_score_percentage:["error"],rollcall_score_percentage:["error"],online_video_completeness_score_percentage:["error"]},r.errors.activity_score_percentages=n.map(r.activityList,(function(){return{score_percentage:["error"]}})),r.errors.custom_score_percentages=n.map(r.activityList,(function(){return{percentage:["error"]}}))}),10)},L=function(){if(r.loading=!0,r.obeMetricsInited=!1,r.activityList=c.copy(r.percentageData.activityList),r.customScoreItemList=c.copy(r.percentageData.customScoreItemList),!r.isMaster)return f.all([p.init(),d.init(),m.initScorePercentage(),v.initActivitiesPercentages(),v.initCustomScoreItems(),v.initScoreStatus(),m.getCourseLeftScorePercent()]).then((function(){var e=Array.from(arguments.length<=0?void 0:arguments[0]),t=a(e,7),o=t[0],n=t[1],i=t[2],s=t[3],u=t[4],l=t[5],p=t[6];r.rollcallSetting=c.copy(o),r.onlineVideoCompletenessSetting=c.copy(n),r.performanceSetting=c.copy(i),r.activityList=c.copy(s),r.customScoreItemList=r.customScoreItemList||c.copy(u),r.scoreStatus=l.score_status,r.scoreLeftPercent=c.copy(p),r.isChild&&A(r.activityList),w(),E(),T()}));f.all([v.initActivitiesPercentages(),v.initScoreStatus(),m.getCourseLeftScorePercent()]).then((function(){var e=a(Array.from(arguments.length<=0?void 0:arguments[0]),3),t=e[0],o=e[1],n=e[2];r.activityList=t,r.customScoreItemList=[],r.rollcallSetting={score_percentage:0},r.performanceSetting={score_percentage:0},r.onlineVideoCompletenessSetting={score_percentage:0},r.scoreStatus=o.score_status,r.scoreLeftPercent=c.copy(n),w(),E(),T()}))};return r.$on("calculatePercentage",L),L()}]},6201:function(e,r,t){var o=t(904072),n=t(361204);t(788674),t(117727),e.exports=["$http","$q",function(e,r){var t=o("#courseId").val(),i=r.defer(),c={},a=!1;return{setting:c,init:()=>(c.id||a||(a=!0,e.get("/api/course/".concat(t,"/online-video-completeness/setting?no-loading-animation=true")).success((e=>{n.copy(e,c),i.resolve(c)})).finally((()=>{a=!1}))),i.promise),update:function(o){var i=r.defer(),a=n.copy(o);return"rate"===a.score_method&&delete a.custom_score_rule,e.put("/api/course/".concat(t,"/online-video-completeness/setting"),a).success((function(e){return n.copy(e,c),i.resolve()})).error((e=>i.reject(e))),i.promise},delete:r=>e.delete("/api/course/".concat(r,"/online-video-completeness/setting")).success((()=>n.copy({},c))),getScoresOfCourse:function(){var o=r.defer();return e.get("/api/course/".concat(t,"/online-video-completeness/scores")).success((e=>o.resolve(e))),o.promise},getScoresOfStudent:function(){var o=r.defer();return e.get("/api/course/".concat(t,"/online-video-completeness/score")).success((e=>o.resolve(e))),o.promise},updateScorePercentage:e=>c.score_percentage=e}}]},201305:function(e,r,t){var o=t(904072),n=t(708468),i=t(361204),c=t(730381);function a(e,r){return function(e){if(Array.isArray(e))return e}(e)||function(e,r){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var t=[],o=!0,n=!1,i=void 0;try{for(var c,a=e[Symbol.iterator]();!(o=(c=a.next()).done)&&(t.push(c.value),!r||t.length!==r);o=!0);}catch(e){n=!0,i=e}finally{try{o||null==a.return||a.return()}finally{if(n)throw i}}return t}(e,r)||function(e,r){if(!e)return;if("string"==typeof e)return s(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(e);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return s(e,r)}(e,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,o=new Array(r);t<r;t++)o[t]=e[t];return o}t(491038),t(556977),e.exports=["$http","$q","commonApi","toastr","activityRepository","onlineVideoCompletenessRepository",function(e,r,t,s,u,l){var p=o("#courseId").val(),d=o("#userId").attr("value"),f=r.defer(),m=r.defer(),g=r.defer(),v=r.defer(),y=r.defer(),h=r.defer(),S=r.defer(),_=r.defer(),b=r.defer(),w=r.defer(),P=r.defer(),A=r.defer(),T=r.defer(),E=r.defer(),L=r.defer(),I=r.defer(),x=r.defer(),C=r.defer(),F=r.defer(),M={},O=function(){t.homeworkStudentStatus(p,(e=>{M.homework=e}));var o=r.defer(),c=r.defer();r.all([o.promise,c.promise]).then((function(){var e=Array.from(arguments.length<=0?void 0:arguments[0]),r=a(e,2),t=r[0],o=r[1],c=n.each(i.copy(t.homework_activities),(function(e){e.type="homework",e.url="/course/".concat(p,"/learning-activity#/").concat(e.id);var r=n.find(t.scores,{activity_id:e.id})||{};return e.score=r.score,e.waitForScore=null===r.score||void 0===r.score,e.instructor_comment=r.instructor_comment,e.recommend=-1!==n.findIndex(o,{activity_id:e.id}),e.public=e.is_announce_score_time_passed,e.student_status=j(e),!0}));return m.resolve(c)}));return t.homeworkScores(p,"id,title,data,start_time,end_time,syllabus_id,module_id,is_announce_score_time_passed,score_percentage,created_at,prerequisites,module_sort,syllabus_sort,sort,publish_type,is_in_progress",(e=>o.resolve(e)),s.decorateError()),e.get("/api/course/".concat(p,"/all-recommend-submissions?fields=activity_id")).success((e=>c.resolve(e.submissions))).error(s.decorateError())},k=function(){t.examStudentStatus(p,(e=>{M.exam=e}));var e=u.initExams(p),o=u.initExamScores(p),c=u.initExamsSubmissions(p);return r.all([e,o,c]).then((function(){var e=Array.from(arguments.length<=0?void 0:arguments[0]),r=a(e,3),t=r[0],o=r[1],c=r[2];return t=n.each(i.copy(t),(function(e){e.type="exam",e.url="/course/".concat(p,"/learning-activity#/exam/").concat(e.id);var r=n.find(o,{activity_id:e.id})||{};return e.score=r.score,e.submissions=c[e.id],e.leftTimes=e.submit_times-c[e.id].length,e.leftTimes<0&&(e.leftTimes=0),e.public=e.is_announce_score_time_passed,e.waitForScore=!(void 0===c[e.id]&&null===c[e.id]||null!==r.score&&void 0!==r.score),e.student_status=j(e),!0})),g.resolve(t)}))},R=function(){t.classroomStudentStatus(p,(e=>{M.classroom=e}));var o=u.initClassroom(p),c=u.initClassroomScores(p),l=r.defer();return e.get("/api/courses/".concat(p,"/classroom-exams/correct-percent")).success((e=>l.resolve(e))).error(s.decorateError()),r.all([o,c,l.promise]).then((function(){var e=Array.from(arguments.length<=0?void 0:arguments[0]),r=a(e,3),t=r[0],o=r[1],c=r[2];return t=n.filter(t,{type:"classroom"}),t=n.each(i.copy(t),(function(e){e.url="#";var r=n.find(o,{activity_id:e.id})||{};if(e.score=r.score,e.waitForScore=null===r.score||void 0===r.score,e.start_time=e.created_at,e.public=e.is_score_public,e.student_status=j(e),c[e.id]||0===c[e.id])return e.correctPercent=(100*c[e.id]).toFixed(1)})),n.remove(t,{status:"none"}),v.resolve(t)}))},U=function(){return t.customScoreItemScores(p,(e=>T.resolve(e.custom_score_items)),(function(){})),T.promise},j=function(e){return((M[e.type]||{})[e.id]||{})[d]||""},D={deferredHomeworks:r.defer(),deferredExams:r.defer(),deferredClassroom:r.defer(),deferredForums:r.defer(),deferredWeblink:r.defer(),deferredQuestionnaires:r.defer(),deferredInteractions:r.defer()};return{init:function(){var o,c,d,L,I,x,C,M,j,D;return t.course(p,"id,learning_mode,modules(id,name,sort,syllabuses(id,summary))",(e=>f.resolve(e)),s.decorateError()),e.get("/api/course/".concat(p,"/student-self-score")).success((e=>P.resolve(e))),O(),R(),k(),o=u.initForumActivity(p),c=u.initForumScores(p),r.all([o,c]).then((function(){var e=a(Array.from(arguments.length<=0?void 0:arguments[0]),2),r=e[0],t=e[1];return r=n.each(i.copy(r),(function(e){e.type="forum";var r=n.find(t,{activity_id:e.id})||{};return e.score=r.score,e.waitForScore=null===r.score||void 0===r.score,e.public=e.can_show_score,!0})),y.resolve(r)})),d=u.initWeblinkActivity(p),L=u.initWeblinkScores(p),r.all([d,L]).then((function(){var e=a(Array.from(arguments.length<=0?void 0:arguments[0]),2),r=e[0],t=e[1];return r=n.each(i.copy(r),(function(e){e.type="web_link";var r=n.find(t,{activity_id:e.id})||{};return e.score=r.score,e.waitForScore=null===r.score||void 0===r.score,e.public=e.can_show_score,!0})),h.resolve(r)})),I=u.initQuestionnaireActivity(p),x=u.initQuestionnaireScores(p),r.all([I,x]).then((function(){var e=a(Array.from(arguments.length<=0?void 0:arguments[0]),2),r=e[0],t=e[1],o=n.filter(r,(e=>e.data.is_scored));return r=n.each(i.copy(o),(function(e){e.type="questionnaire";var r=n.find(t,{activity_id:e.id})||{};return e.score=r.score,e.waitForScore=!1,e.public=!0,!0})),S.resolve(r)})),C=u.initInteractionActivity(p),M=u.initInteractionScores(p),r.all([C,M]).then((function(){var e=a(Array.from(arguments.length<=0?void 0:arguments[0]),2),r=e[0],t=e[1];return r=n.each(i.copy(r),(function(e){e.type="interaction";var r=n.find(t,{activity_id:e.id})||{};return e.score=r.score,e.waitForScore=null==e.score,e.public=!0,!0})),_.resolve(r)})),e.get("/api/course/".concat(p,"/rollcall-score")).success((function(e){var r=e;return b.resolve(r)})).error(s.decorateError()),e.get("/api/course/".concat(p,"/performance-score?isOriginalScore=true")).success((e=>w.resolve(e))).error(s.decorateError()),r.all([l.init(),l.getScoresOfStudent()]).then((function(){var e=a(Array.from(arguments.length<=0?void 0:arguments[0]),2),r=e[0],t=e[1];return r.id?(t={score_percentage:r.score_percentage,score:t.score,complete_rate:t.complete_rate},A.resolve(t)):A.resolve()})),U(),t.getAnnounceScoreSettings(p,(e=>E.resolve(e.announce_score_settings||{})),(function(){})),j=u.initCourseVirtualExperimentActivity(p),D=u.initCourseVirtualExperimentScores(p),r.all([j,D]).then((function(){var e=a(Array.from(arguments.length<=0?void 0:arguments[0]),2),r=e[0],t=e[1];return r=n.each(i.copy(r),(function(e){e.type="virtual_experiment";var r=n.find(t,{activity_id:e.id})||{};return e.score=r.score,e.waitForScore=null===r.score||void 0===r.score,e.public=e.can_show_score||!0,!0})),F.resolve(r)})),r.all([f.promise,m.promise,v.promise,g.promise,P.promise,y.promise,h.promise,S.promise,_.promise,b.promise,w.promise,A.promise,T.promise,E.promise,F.promise]).then((function(){var e=Array.from(arguments.length<=0?void 0:arguments[0]),r=a(e,15),t=r[0],o=r[1],i=r[2],c=r[3],s=r[4],u=r[5],l=r[6],p=r[7],d=r[8],f=r[9],m=r[10],g=r[11],v=r[12],y=r[13],h=r[14];t.rollcallScore=f,t.performanceScore=m,t.onlineVideoCompletenessScore=g,t.customScoreItems=v,t.announceScoreSettings=y;var S=o.concat(i).concat(c).concat(u).concat(l).concat(p).concat(h).concat(d);return t.allActivities=n.sortBy(S,["module_sort","syllabus_sort","sort","created_at"]),{course:t,courseStudentScore:s}}))},initScoreSection:function(){return e.get("/api/course/".concat(p,"/score-distribution?no-intercept=true")).success((e=>L.resolve(e||{}))),L.promise},initActivitiesPercentages:function(){var e,o,c,s,l,d;return t.homeworkScores(p,"id,title,data,start_time,end_time,syllabus_id,module_id,is_announce_score_time_passed,score_percentage,created_at,prerequisites,module_sort,syllabus_sort,sort,publish_type,is_in_progress",(function(e){var r=n.each(i.copy(e.homework_activities),(function(e){e.type="homework",e.score_published=e.is_announce_score_time_passed,e.url="/course/".concat(p,"/learning-activity#/").concat(e.id)}));return D.deferredHomeworks.resolve(r)}),(e=>D.deferredHomeworks.reject(e))),e=u.initClassroom(p),r.all([e]).then((function(){var e=a(Array.from(arguments.length<=0?void 0:arguments[0]),1)[0];return e=n.filter(e,{type:"classroom"}),e=n.each(i.copy(e),(function(e){return e.url="/course/".concat(p,"/learning-activity#/classroom/").concat(e.id),e.start_time=e.created_at})),D.deferredClassroom.resolve(e)}),(e=>D.deferredClassroom.reject(e))),o=u.initExams(p),r.all([o]).then((function(){var e=a(Array.from(arguments.length<=0?void 0:arguments[0]),1)[0];return e=n.each(i.copy(e),(function(e){e.type="exam",e.score_published=e.is_announce_score_time_passed,e.url="/course/".concat(p,"/learning-activity#/exam/").concat(e.id)})),D.deferredExams.resolve(e)}),(e=>D.deferredExams.reject(e))),c=u.initForumActivity(p),r.all([c]).then((function(){var e=a(Array.from(arguments.length<=0?void 0:arguments[0]),1)[0];return e=n.each(i.copy(e),(function(e){return e.type="forum",e.url="/course/".concat(p,"/learning-activity#/").concat(e.id),e.start_time=e.created_at,e.public=e.can_show_score,!0})),D.deferredForums.resolve(e)}),(e=>D.deferredForums.reject(e))),s=u.initWeblinkActivity(p),r.all([s]).then((function(){var e=a(Array.from(arguments.length<=0?void 0:arguments[0]),1)[0];return e=n.each(i.copy(e),(function(e){return e.type="web_link",e.url="/course/".concat(p,"/learning-activity#/").concat(e.id),e.start_time=e.created_at,e.public=e.can_show_score,!0})),D.deferredWeblink.resolve(e)}),(e=>D.deferredWeblink.reject(e))),l=u.initQuestionnaireActivity(p),r.all([l]).then((function(){var e=a(Array.from(arguments.length<=0?void 0:arguments[0]),1)[0],r=n.filter(e,(e=>e.data.is_scored));return e=n.each(i.copy(r),(function(e){return e.type="questionnaire",e.url="/course/".concat(p,"/learning-activity/full-screen#/questionnaire/").concat(e.id),e.start_time=e.created_at,e.public=!0,!0})),D.deferredQuestionnaires.resolve(e)}),(e=>D.deferredQuestionnaires.reject(e))),d=u.initInteractionActivity(p),r.all([d]).then((function(){var e=a(Array.from(arguments.length<=0?void 0:arguments[0]),1)[0];return e=n.each(i.copy(e),(function(e){return e.type="interaction",e.url="/course/".concat(p,"/learning-activity/full-screen#/").concat(e.id),e.start_time=e.created_at,e.public=!0,!0})),D.deferredInteractions.resolve(e)}),(e=>D.deferredInteractions.reject(e))),r.all([D.deferredHomeworks.promise,D.deferredClassroom.promise,D.deferredExams.promise,D.deferredForums.promise,D.deferredWeblink.promise,D.deferredQuestionnaires.promise,D.deferredInteractions.promise]).then((function(){var e=Array.from(arguments.length<=0?void 0:arguments[0]),r=a(e,7),t=r[0],o=r[1],i=r[2],c=r[3],s=r[4],u=r[5],l=r[6],p=t.concat(o).concat(i).concat(c).concat(s).concat(u).concat(l);return p=n.sortBy(p,["module_sort","syllabus_sort","sort","created_at"])}))},initCustomScoreItems:U,initScoreStatus:function(){return t.scoreStatus(p,(function(e){var r=e;return"string"==typeof e.published_at&&(r.published_at=c(e.published_at).format("YYYY.MM.DD HH:mm")),I.resolve(r)}),(e=>I.reject(e))),I.promise},initCourseObeMetrics:function(){return t.getCourseAvailableObeMetrics(p,(e=>x.resolve(e||{})),(function(){}))},initActivityMetricSetting:function(){return t.getActivityExistedObeMetrics(JSON.stringify({course_id:p,refers:[]}),(e=>C.resolve(e||{})),(function(){}))},initVirtualExperimentPercentages:function(){var e=u.initCourseVirtualExperimentActivity(p);return r.all([e]).then((function(){var e=Array.from(arguments.length<=0?void 0:arguments[0]),r=a(e,1),t=r[0];return t=n.each(i.copy(t),(function(e){return t.type="virtual_experiment",t.url="/course/".concat(p,"/learning-activity#/").concat(e.id),t.start_time=e.created_at,t.public=e.can_show_score||!0,!0}))}))}}}]}}]);