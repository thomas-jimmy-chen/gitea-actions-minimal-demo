(self.webpackChunklms=self.webpackChunklms||[]).push([[74976],{543637:function(t,e,i){"use strict";i.r(e);i(682772),i(323123);var s=i.p+"ba821b6280680fdc453469588f3b4710.js",a=i(708468),r=i(904072);function n(t,e){var i;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(i=function(t,e){if(!t)return;if("string"==typeof t)return c(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return c(t,e)}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var s=0,a=function(){};return{s:a,n:function(){return s>=t.length?{done:!0}:{done:!1,value:t[s++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,n=!0,o=!1;return{s:function(){i=t[Symbol.iterator]()},n:function(){var t=i.next();return n=t.done,t},e:function(t){o=!0,r=t},f:function(){try{n||null==i.return||i.return()}finally{if(o)throw r}}}}function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,s=new Array(e);i<e;i++)s[i]=t[i];return s}var o=function(t){for(var e=t.target;e&&e.tagName&&"A"!==e.tagName;){if("BODY"===e.tagName)return;e=e.parentNode}var i=window.gaSettings.pageName,s=function(t){for(var e=window.gaSettings.pageAreaMap;t&&t.tagName&&"BODY"!==t.tagName;){if("DIV"===t.tagName){var i,s=n(t.className.split(" "));try{for(s.s();!(i=s.n()).done;){var a=i.value;if(void 0!==e[a])return e[a]}}catch(t){s.e(t)}finally{s.f()}}t=t.parentNode}return"unknown"}(e);return t.data&&t.data.tracker?ga("".concat(t.data.tracker,".send"),"event","PageArea","click","".concat(i,"-").concat(s)):ga("send","event","PageArea","click","".concat(i,"-").concat(s))},u=function(t,e){if(e){if(ga("create",t,"auto",e),window.analyticsData){var i="".concat(e,".set");ga(i,"dimension1",window.analyticsData.orgName),ga(i,"dimension2","".concat(window.analyticsData.userId,"-").concat(window.analyticsData.userName))}return ga("".concat(e,".send"),"pageview"),h("".concat(e,".send")),r((function(){if(window.gaSettings)return r("body").on("click",{tracker:e},o)}))}return ga("create",t,"auto"),window.analyticsData&&(ga("set","dimension1",window.analyticsData.orgName),ga("set","dimension2","".concat(window.analyticsData.userId,"-").concat(window.analyticsData.userName))),ga("send","pageview"),h("send"),r((function(){if(window.gaSettings)return r("body").on("click",o)}))},h=function(t){if(window.performance){var e=Math.round(performance.now());ga(t,"timing","Page Load","load",e)}};!function(){var t,e,i,r,n,c,o,h;if(e=window,i=document,r="script",n=s,c="ga",e.GoogleAnalyticsObject=c,e.ga=e.ga||function(){return(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,o=i.createElement(r),h=i.getElementsByTagName(r)[0],o.async=1,o.src=n,h.parentNode.insertBefore(o,h),null!=window.statisticsSettings?window.statisticsSettings.gaTrackingId:void 0)t=window.statisticsSettings.gaTrackingId;else{var d=a.find([{domain:/.*tronclass\.com\.cn$/,ua:"UA-59224628-6"},{domain:/lms\.eurasia\.edu/,ua:"UA-59224628-5"},{domain:/class\.xjtu\.edu\.cn/,ua:"UA-59224628-7"},{domain:/.*k12\.tronclass\.com/,ua:"UA-59224628-9"},{domain:/www\.ahmooc\.cn/,ua:"UA-59224628-12"},{domain:/lms\.bnu\.edu\.cn/,ua:"UA-59224628-13"},{domain:/lms\.sgjx\.com\.cn/,ua:"UA-59224628-14"},{domain:/wlyx\.21shte\.net/,ua:"UA-59224628-15"},{domain:/dev\.tronclass\.com/,ua:"UA-59224628-25"},{domain:/lms\.csu\.edu\.cn/,ua:"UA-59224628-34"},{domain:/lonelyreader\.com/,ua:"UA-59224628-38"}],(t=>t.domain.test(document.domain)));if(!d)return;t=d.ua}if(t.indexOf(",")>0){var v=t.split(",");return(()=>{for(var t=[],e=0;e<v.length;e++){var i=v[e],s="tracker".concat(e);t.push(u(i,s))}return t})()}u(t)}()},636335:function(t,e,i){var s=i(361204);i(788674);var a=i(887757);function r(t,e,i,s,a,r,n){try{var c=t[r](n),o=c.value}catch(t){return void i(t)}c.done?e(o):Promise.resolve(o).then(s,a)}i(535666),t.exports={bootNgApp(){var t=document.body.getAttribute("-ng-app");setTimeout((()=>{s.bootstrap(document.body,[t],{strictDi:!0})}))},bootNgAppOnDemand(){return(t=a.mark((function t(){var e;return a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=document.body.getAttribute("-ng-app")){t.next=3;break}return t.abrupt("return");case 3:if("common"===e){t.next=6;break}return t.next=6,i(551317)("./".concat(e));case 6:setTimeout((function(){s.bootstrap(document.body,[e],{strictDi:!0})}));case 7:case"end":return t.stop()}}),t)})),function(){var e=this,i=arguments;return new Promise((function(s,a){var n=t.apply(e,i);function c(t){r(n,s,a,c,o,"next",t)}function o(t){r(n,s,a,c,o,"throw",t)}c(void 0)}))})();var t},JSLoad:()=>{document.body.style.visibility="visible"}}},942783:function(t,e,i){var s=i(708468);i(682772),i(747042),i(115306),i(864765);var a=i(180736);t.exports=function(t,e,i){t.pageItems=[];var r=e.search().pageIndex;t.pageIndex=r?s.parseInt(r):1;var n=a(t);t.ui||(t.ui={}),t.ui.searching=!1,t.pageSizeOptions=[10,20,30,50,100],t.pageSize=t.pageSize?t.pageSize:t.pageSizeOptions[0],t.updatePageSize=function(e){return t.pageSize=e,t.search()},t.verifyPageIndexInput=function(){if(t.ui.pageIndexInput){var e=t.result.pages,i=String(t.ui.pageIndexInput).replace(/\./,"");return t.ui.pageIndexInput=isNaN(i)||i<1||i>e?t.pageIndex:parseInt(i)}};var c={changePage(a,r,n,c){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];a||(a=1);return r(a,t.pageSize||t.pageSizeOptions[0],(function(a){return t.result=a,function(i){if(t.pageIndex=i,t.ui.pageIndexInput=t.pageIndex,!t.ui.disableLocationSearch)e.search("pageIndex",i>1?i:null)}(s.parseInt(a.page)),n(a),function(a){if(0!==a.length){var r=e.path();if(t.result[i].length>0){var n=t.result[i][0].id;s.each(a,(function(t){if(r.indexOf(t)>0)return e.path("/".concat(n).concat(t))}))}return 0===t.result.total?e.path("/"):void 0}}(o)}),c)},search(e,i,s,a){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];t.ui.searching=!0;return n.show(),c.changePage(e,i,(function(t){return s(t),n.hide()}),(function(){return a(),n.hide()}),r)},updatePaginationData:(t,e)=>(e.length>parseInt(t.page_size)?t.pages++:1===e.length?(t.start++,t.end++,t.pages++,t.page++):t.end++,t.total++),buildPaginationResult(t,e,i){var s,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:20,r=t.length;if(0===r)(s={start:0,end:0,total:0,pages:0,page:0,page_size:a})[i]=t;else{var n=Math.ceil(r/a);e>n&&(e=n);var c=a*(e-1),o=Math.min(a*e,r),u=t.slice(c,o);(s={start:c+1,end:o,total:r,pages:n,page:e,page_size:a})[i]=u}return s},changePageAtFrontEnd(e,i,a){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"data";e||(e=1);var n=t.pageSize||t.pageSizeOptions[0],o=c.buildPaginationResult(i,e,r,n);return t.result=o,t.pageIndex=s.parseInt(o.page),t.ui.pageIndexInput=t.pageIndex,a(o)}};return c}},684266:function(t,e,i){var s=i(370538).default,a=i(635224);s.filter("datetime",a.datetime())},718652:function(t,e,i){"use strict";i.r(e);i(788674);var s=i(370538),a=i(866473),r=i.n(a),n=i(709564),c=i(593560),o=i(188465),u=i(285256),h=i(74104),d=i(117403),v=i(409669),l=i.n(v);window.Vue=s.default,"$url"in s.default.prototype||s.default.use(h.ZP),s.default.use(r()),i(595221),i(684266),s.default.use(i(509429).default),s.default.use(u.Z),s.default.customElement(n.default.name,n.default),s.default.customElement(c.default.name,c.default),s.default.customElement(o.default.name,o.default),s.default.customElement("chat-robot",i(514478).Z),Promise.all([i.e(67728),i.e(74632),i.e(13971),i.e(72873)]).then(i.bind(i,872873)).then((t=>{t.default.i18n=d.default,s.default.customElement("ono-stat-students",t.default)})),s.default.config.productionTip=!1,l().interceptors.request.use((function(t){var e=/^\/api\//.test(t.url);return window.RequestScope&&e&&(t.headers["Request-Scope"]=window.RequestScope),t}))},521406:function(t,e,i){i(682772),i(323123);!function(){var t;function e(){dataLayer.push(arguments)}if(window.dataLayer=window.dataLayer||[],e("js",new Date),(null!=window.statisticsSettings?window.statisticsSettings.gaTrackingId:void 0)&&(t=window.statisticsSettings.gaTrackingId),t)if(t.indexOf(",")>0)for(var i=t.split(","),s=0;s<i.length;s++){e("config",i[s])}else e("config",t)}()},255178:function(t,e,i){"use strict";i.r(e);var s=i(74104),a=i(370538),r=i(904072);"$url"in a.default.prototype||a.default.use(s.ZP),r("#notification_container").length&&new a.default({el:"#notification_container",data:{},components:{"notification-container":i(577575).Z}})},421169:function(t,e,i){var s;null!==(s=window.CONFIGS)&&void 0!==s&&s.assetsPath&&(i.p=window.CONFIGS.assetsPath)},356230:function(t,e,i){var s=i(708468),a=i(904072),r=i(293789),n=i(730381);function c(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var i=[],s=!0,a=!1,r=void 0;try{for(var n,c=t[Symbol.iterator]();!(s=(n=c.next()).done)&&(i.push(n.value),!e||i.length!==e);s=!0);}catch(t){a=!0,r=t}finally{try{s||null==c.return||c.return()}finally{if(a)throw r}}return i}(t,e)||u(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(t,e){var i;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(i=u(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var s=0,a=function(){};return{s:a,n:function(){return s>=t.length?{done:!0}:{done:!1,value:t[s++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,n=!0,c=!1;return{s:function(){i=t[Symbol.iterator]()},n:function(){var t=i.next();return n=t.done,t},e:function(t){c=!0,r=t},f:function(){try{n||null==i.return||i.return()}finally{if(c)throw r}}}}function u(t,e){if(t){if("string"==typeof t)return h(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?h(t,e):void 0}}function h(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,s=new Array(e);i<e;i++)s[i]=t[i];return s}i(491038),i(682772),i(747042),i(323123),i(454747);class d{constructor(t){this.url=t.server,this.enableMgsQueryCache=t.enableMgsQueryCache,this.videoViewsCache={},this.videosPlayedCache={},this.videoViewsOfOrgCache={},this.videoStatofOrgCache={},this.courseVideosPlayedCache={},this.courseLessonsPlayedCache={},this.lessonViewsCache={},this.lectureLiveViewsCache={},this.lessonsPlayedCache={},this.lectureLivePlayedCache={},this.courseStudentVisitsCache={},this.courseStudentOnlineVideosCache={},this.courseActivityTypeStudentVisitsCache={},this.countInCourseCache={},this.countInCourseWithParamsCache={},this.departmentVisitsDaysCache={},this.departmentVisitsCache={},this.departmentVisitsTodayCache={},this.departmentVisitsYearCache={},this.courseVisitsDaysCache={},this.courseVisitsCache={},this.courseVisitsTodayCache={},this.courseVisitsYearCache={},this.userCourseVideosVisitsCache={},this.userCourseVisitsCache={},this.userCourseVisitsDaysCache={},this.userCourseVisitsTodayCache={},this.userCourseVisitsYearCache={},this.studentCourseVisitDetailsCache={},this.userCourseActivitiesVisitsDaysCache={},this.userCourseActivitiesVisitsTodayCache={},this.userCourseActivitiesVisitsYearCache={},this.courseActivitiesVisitsDaysCache={},this.courseActivitiesVisitsTodayCache={},this.courseActivitiesVisitsYearCache={},this.activitiesVisitCache={},this.activityVisitCache={},this.studentActivityVisitCache={},this.studentWebLinkViewCache={},this.studentVideoViewCache={},this.studentLessonViewCache={},this.studentLectureLiveViewCache={},this.studentMaterialDownloadCache={},this.userMaterialDownloadsCache={},this.courseMaterialDownloadCache={},this.courseWebLinkViewCache={},this.orgVisitsCache={},this.orgVisitsDateRangeCache={},this.orgVisitsDaysCache={},this.orgVisitsTodayCache={},this.orgVisitsYearCache={},this.orgVisitsByBrowserCache={},this.orgVisitsByDateRangeBrowserCache={},this.bulletinVisitsCache={},this.bulletinVisitsDateRangeCache={},this.bulletinVisitsDaysCache={},this.bulletinVisitsTodayCache={},this.bulletinVisitsYearCache={},this.bulletinVisitsStatCache={}}_extractResource(t,e,i){return s.each(e,(function(e){var s=e.user_id,a=e.activity_id;if(null==t[s]&&(t[s]={}),null==t[s][i]&&(t[s][i]={}),null==t[s][i][a]&&(t[s][i][a]={}),"material"===i){var r=e.upload_id;t[s][i][a][r]=(e.data.download_count||0)+(e.data.view_count||0)}else t[s][i][a]=e.data.view_count||0}))}countInCourseWithParams(t,e,i,s){var r=JSON.stringify(e),n="".concat(r).concat(t);n in this.countInCourseWithParamsCache&&i(this.countInCourseWithParamsCache[n]);var c=this._query("courses/".concat(t,"/activities/metrics?types=").concat(r));return a.when(c).then((t=>{i(t)}),s)}countInCourse(t,e){if(!(t in this.countInCourseCache)){var i=this._query("courses/".concat(t,"/activities/metrics?types=").concat(JSON.stringify({material:["user","activity","upload"],web_link:["user","activity"],slide:["user","activity"],lesson:["user","activity"],online_video:["user","activity"]})));return a.when(i).then((i=>{var s={};for(var a in i){var r=i[a];this._extractResource(s,r,a)}return this.countInCourseCache[t]=s,e(s)}),(()=>e({})))}e(this.countInCourseCache[t])}countInCourseWithStudentIds(t,e,i){var s=this._query("courses/".concat(t,"/activities/metrics?user_ids=").concat(e,"&types=").concat(JSON.stringify({material:["user","activity","upload"],web_link:["user","activity"],slide:["user","activity"],lesson:["user","activity"],online_video:["user","activity"],lecture_live:["user","activity"]})));return a.when(s).then((t=>{var e={};for(var s in t){var a=t[s];this._extractResource(e,a,s)}return i(e)}),(()=>i({})))}videoViews(t,e){return this._videoViews(t,e,"online-videos",this.videoViewsCache)}interactionVideoViews(t,e){return this._videoViews(t,e,"interactions",this.videoViewsCache)}lessonViews(t,e){return this._videoViews(t,e,"lessons",this.lessonViewsCache)}lectureLiveViews(t,e){return this._videoViews(t,e,"lecture-live",this.lectureLiveViewsCache)}_videoViews(t,e,i,s){var r="".concat(t,"_").concat(i);if(!(r in s)){var n=this._query("activities/".concat(t,"/").concat(i,"/metrics?group_by=user"));return a.when(n).then((function(t){var a={};return t.forEach((function(t){a[t.user_id]="lecture-live"===i?{lectureLiveDuration:t.data.lecture_live_play_duration||0,lectureLiveViews:t.data.lecture_live_view_count||0,replayViewDuration:t.data.replay_play_duration||0,replayViews:t.data.replay_view_count||0}:{firstView:t.data.first_view,lastView:t.data.last_view,viewDuration:t.data.play_duration||0,views:t.data.view_count||0}})),s[r]=a,e(a)}),(()=>e({})))}e(s[r])}videosViewedOfOrg(t,e){if(!(t in this.videoViewsOfOrgCache)){var i=this._query("orgs/".concat(t,"/online-videos/metrics?time_restrict=day"));return a.when(i).then((i=>{var s={views_today:0,views_this_month:0},a=i[i.length-1];return s.views_today=a.view_count||0,s.views_this_month=0,i.forEach((t=>s.views_this_month+=t.view_count||0)),this.videoViewsOfOrgCache[t]=s,e(s)}),(()=>e({})))}e(this.videoViewsOfOrgCache[t])}videoStatOrg(t,e,i){var s="".concat(t,"_").concat(e);if(!(s in this.videoStatofOrgCache)){var r=this._query("orgs/".concat(t,"/online-videos/stat?range=").concat(e));return a.when(r).then((t=>i(t)),(()=>i({})))}i(this.videoStatofOrgCache[s])}videosPlayed(t,e){return this._videosPlayed(t,e,"online-videos",this.videosPlayedCache)}courseVideosPlayed(t,e){return this._courseVideosPlayed(t,e,"online-videos",this.courseVideosPlayedCache)}interactionVideosPlayed(t,e){return this._videosPlayed(t,e,"interactions",this.videosPlayedCache)}courseInteractionVideosPlayed(t,e){return this._courseVideosPlayed(t,e,"interactions",this.courseVideosPlayedCache)}lessonsPlayed(t,e){return this._videosPlayed(t,e,"lessons",this.lessonsPlayedCache)}lectureLivePlayed(t,e){return this._videosPlayed(t,e,"lecture-live",this.lectureLivePlayedCache)}courseLessonsPlayed(t,e){return this._courseVideosPlayed(t,e,"lessons",this.courseLessonsPlayedCache)}_courseVideosPlayed(t,e,i,s){var r="".concat(t,"_").concat(i);if(!(r in s)){var n=this._query("courses/".concat(t,"/").concat(i,"/metrics?group_by=course,activity"));return a.when(n).then((function(t){var i={};return t.forEach((function(t){i[t.activity_id]=t.data})),s[r]=i,e(i)}),(()=>e({})))}e(s[r])}_videosPlayed(t,e,i,s){var r="".concat(t,"_").concat(i);if(!(r in s)){var n=this._query("courses/".concat(t,"/").concat(i,"/metrics?group_by=user,activity"));return a.when(n).then((function(t){var a={};return t.forEach((function(t){null==a[t.activity_id]&&(a[t.activity_id]={}),a[t.activity_id][t.user_id]="lecture-live"===i?{lectureLiveViews:t.data.lecture_live_view_count||0,lectureLiveViewDuration:t.data.lecture_live_play_duration||0,replayViews:t.data.replay_view_count||0,replayViewDuration:t.data.replay_play_duration||0}:{views:t.data.view_count||0,viewDuration:t.data.play_duration||0}})),s[r]=a,e(a)}),(()=>e({})))}e(s[r])}courseVideosViewsCustomRange(t,e,i,s,r){var n=(new Date).getTimezoneOffset()/-60,c=this._query("courses/".concat(t,"/online-videos/plays?start=").concat(e,"&end=").concat(i,"&timezone_offset=").concat(n,"&split=").concat(s)),u=this._query("courses/".concat(t,"/interactions/plays?start=").concat(e,"&end=").concat(i,"&timezone_offset=").concat(n,"&split=").concat(s));return a.when(c,u).then((function(t,e){var i,s="success"===t[1]?t[0]:[],a="success"===e[1]?e[0]:[],n={},c=o(s.concat(a));try{for(c.s();!(i=c.n()).done;){var u=i.value;n[u.activity_id]=u.plays}}catch(t){c.e(t)}finally{c.f()}return r(n)}),(t=>r({})))}courseVideosViews(t,e,i,s){var n={day:"hour",week:"day",month:"day",year:"month"},c=this._query("courses/".concat(t,"/online-videos/metrics?group_by=activity,user&time_restrict=").concat(n[e])),u=this._query("courses/".concat(t,"/interactions/metrics?group_by=activity,user&time_restrict=").concat(n[e]));return a.when(c,u).then((function(t,a){var n,c="success"===t[1]?t[0]:[],u="success"===a[1]?a[0]:[],h={},d=o(c.concat(u));try{for(d.s();!(n=d.n()).done;){var v=n.value;if(-1===i.indexOf(v.user_id)){var l,y=[],_=o(v.data);try{for(_.s();!(l=_.n()).done;){var f=l.value,m="play_count"in f?f.play_count:0;y.push(m)}}catch(t){_.e(t)}finally{_.f()}if("week"===e&&(y=y.slice(-7)),v.activity_id in h){var V,p=o(r.range(0,h[v.activity_id].length-1,!0));try{for(p.s();!(V=p.n()).done;){var w=V.value;h[v.activity_id][w]+=y[w]}}catch(t){p.e(t)}finally{p.f()}}else h[v.activity_id]=y}}}catch(t){d.e(t)}finally{d.f()}return s(h)}),(()=>s({})))}courseStudentOnlineVideos(t,e){if(!(t in this.courseStudentOnlineVideosCache)){var i=this._query("courses/".concat(t,"/online-videos/metrics?group_by=activity,user"));return a.when(i).then((i=>{var s={};return i.forEach((function(t){t.data.play_duration&&t.data.play_duration<0&&(t.data.play_duration=0),s[t.user_id]?(s[t.user_id].playCount+=t.data.play_count||0,s[t.user_id].playDuration+=t.data.play_duration||0):s[t.user_id]={playCount:t.data.play_count||0,playDuration:t.data.play_duration||0}})),this.courseStudentOnlineVideosCache[t]=s,e(s)}),(()=>e({})))}e(this.courseStudentOnlineVideosCache[t])}courseStudentOnlineVideosWithStudentIds(t,e,i){var s=this._query("courses/".concat(t,"/online-videos/metrics?user_ids=").concat(e,"&group_by=activity,user"));return a.when(s).then((t=>{var e={};return t.forEach((function(t){e[t.user_id]?(e[t.user_id].playCount+=t.data.play_count||0,e[t.user_id].playDuration+=t.data.play_duration||0):e[t.user_id]={playCount:t.data.play_count||0,playDuration:t.data.play_duration||0}})),i(e)}),(()=>i({})))}videoStudentsInterval(t,e,i,s,r,n){var c,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";if("custom"===e){var h=(new Date).getTimezoneOffset()/-60;c=this._query("video/".concat(t,"/online-videos/users/intervals?range=").concat(e,"&start=").concat(r,"&end=").concat(n,"&timezone_offset=").concat(h,"&user_ids=").concat(u))}else c=this._query("video/".concat(t,"/online-videos/users/intervals?range=").concat(e,"&user_ids=").concat(u));return a.when(c).then((function(t){var e,s={},a=o(t);try{for(a.s();!(e=a.n()).done;){var r=e.value;s[r._id]=r.intervals}}catch(t){a.e(t)}finally{a.f()}return i(s)}),(t=>s(t.responseJSON)))}lessonStudentsInterval(t,e,i,s,r,n){var c;if("custom"===e){var u=(new Date).getTimezoneOffset()/-60;c=this._query("video/".concat(t,"/lessons/users/intervals?range=").concat(e,"&start=").concat(r,"&end=").concat(n,"&timezone_offset=").concat(u))}else c=this._query("video/".concat(t,"/lessons/users/intervals?range=").concat(e));return a.when(c).then((function(t){var e,s={},a=o(t);try{for(a.s();!(e=a.n()).done;){var r=e.value;s[r._id]=r.intervals}}catch(t){a.e(t)}finally{a.f()}return i(s)}),(t=>s(t.responseJSON)))}interactionVideoStudentsInterval(t,e,i,s,r,n){var c;if("custom"===e){var u=(new Date).getTimezoneOffset()/-60;c=this._query("video/".concat(t,"/interactions/users/intervals?range=").concat(e,"&start=").concat(r,"&end=").concat(n,"&timezone_offset=").concat(u))}else c=this._query("video/".concat(t,"/interactions/users/intervals?range=").concat(e));return a.when(c).then((function(t){var e,s={},a=o(t);try{for(a.s();!(e=a.n()).done;){var r=e.value;s[r._id]=r.intervals}}catch(t){a.e(t)}finally{a.f()}return i(s)}),(t=>s(t.responseJSON)))}courseStudentVisits(t,e){if(!(t in this.courseStudentVisitsCache)){var i=this._query("courses/".concat(t,"/user-visits/metrics?group_by=user"));return a.when(i).then((i=>{var s={};return i.forEach((t=>s[t.user_id]={visits:t.data.count||0,visitDuration:t.data.sum||0,firstVisit:t.data.first_visit_start_from||t.data.first_time,lastVisit:t.data.last_time})),this.courseStudentVisitsCache[t]=s,e(s)}),(()=>e({})))}e(this.courseStudentVisitsCache[t])}courseStudentVisitsWithStudentIds(t,e,i){var s=this._query("courses/".concat(t,"/user-visits/metrics?user_ids=").concat(e,"&group_by=user"));return a.when(s).then((t=>{var e={};return t.forEach((t=>e[t.user_id]={visits:t.data.count||0,visitDuration:t.data.sum||0,firstVisit:t.data.first_visit_start_from||t.data.first_time,lastVisit:t.data.last_time})),i(e)}),(()=>i({})))}courseZhiyunVisitsWithStudentIds(t,e,i,s){var r=this._query("orgs/".concat(t,"/zhiyun-visits/metrics?user_ids=").concat(i,"&course_ids=").concat(e));return a.when(r).then((t=>{var e={};return t.forEach((t=>{e[t.user_id]={visits:t.data.visits||0}})),s(e)}),(()=>s({})))}courseVideosStudentViews(t,e,i){return this._courseVideosStudentViews(t,e,i,"online-videos",this.studentVideoViewCache)}courseLessonsStudentViews(t,e,i){return this._courseVideosStudentViews(t,e,i,"lessons",this.studentLessonViewCache)}courseLectureLiveStudentViews(t,e,i){return this._courseLiveStudentViews(t,e,i,"lecture-live",this.studentLectureLiveViewCache)}_courseVideosStudentViews(t,e,i,s,r){var n="".concat(t,"_").concat(e);if(!r[n]){var c=this._query("courses/".concat(t,"/users/").concat(e,"/").concat(s,"/metrics?group_by=activity"));return a.when(c).then((function(t){var e={};return t.forEach((t=>e[t.activity_id]={firstView:t.data.first_view,lastView:t.data.last_view,views:t.data.view_count||0,viewDuration:t.data.play_duration||0})),r[n]=e,i(e)}),(()=>i({})))}i(r[n])}_courseLiveStudentViews(t,e,i,s,r){var n="".concat(t,"_").concat(e);if(!r[n]){var c=this._query("courses/".concat(t,"/users/").concat(e,"/").concat(s,"/metrics?group_by=activity"));return a.when(c).then((function(t){var e={};return t.forEach((t=>e[t.activity_id]={lectureLiveViews:t.data.lecture_live_view_count||0,replayViews:t.data.replay_view_count||0,lectureLivePlayDuration:t.data.lecture_live_play_duration||0,replayPlayDuration:t.data.replay_play_duration||0})),r[n]=e,i(e)}),(()=>i({})))}i(r[n])}courseMaterialsStudentDownloads(t,e,i){var s="".concat(t,"_").concat(e);if(!this.studentMaterialDownloadCache[s]){var r=this._query("courses/".concat(t,"/users/").concat(e,"/materials/metrics?group_by=activity,upload"));return a.when(r).then((t=>{var e={};return t.forEach((function(t){var i="".concat(t.activity_id,"_").concat(t.upload_id);return e[i]={downloads:t.data.download_count||0,views:t.data.view_count||0,lastDownload:t.data.last_download,lastView:t.data.last_view}})),this.studentMaterialDownloadCache[s]=e,i(e)}),(()=>i({})))}i(this.studentMaterialDownloadCache[s])}courseMaterialsDownloads(t,e){if(!this.courseMaterialDownloadCache[t]){var i=this._query("courses/".concat(t,"/materials/metrics?group_by=activity,upload,user"));return a.when(i).then((i=>{var s={};return i.forEach((function(t){var e="".concat(t.activity_id,"_").concat(t.upload_id);return null==s[e]&&(s[e]={}),s[e][t.user_id]={downloads:t.data.download_count||0,lastDownload:t.data.last_download,views:t.data.view_count||0,lastView:t.data.last_view}})),this.courseMaterialDownloadCache[t]=s,e(s)}),(()=>e({})))}e(this.courseMaterialDownloadCache[t])}courseWebLinkStudentViews(t,e,i){var s="".concat(t,"_").concat(e);if(!this.studentWebLinkViewCache[s]){var r=this._query("courses/".concat(t,"/users/").concat(e,"/weblinks/metrics?group_by=activity"));return a.when(r).then((t=>{var e={};return t.forEach((t=>e[t.activity_id]={views:t.data.view_count||0,lastView:t.data.last_view})),this.studentWebLinkViewCache[s]=e,i(e)}),(()=>i({})))}i(this.studentWebLinkViewCache[s])}courseWebLinkViews(t,e){if(!this.courseWebLinkViewCache[t]){var i=this._query("courses/".concat(t,"/weblinks/metrics?group_by=activity,user"));return a.when(i).then((i=>{var s={};return i.forEach((function(t){return null==s[t.activity_id]&&(s[t.activity_id]={}),s[t.activity_id][t.user_id]={views:t.data.view_count||0,lastView:t.data.last_view}})),this.courseWebLinkViewCache[t]=s,e(s)}),(()=>e({})))}e(this.courseWebLinkViewCache[t])}studentCourseVisits(t,e,i){var s="".concat(e,"_").concat(t);if(!this.studentCourseVisitDetailsCache[s]){var r=this._query("courses/".concat(e,"/users/").concat(t,"/user-visits"));return a.when(r).then((t=>{var e=[];return t.forEach((function(t){var i={activityId:null==t.activity_id?"":t.activity_id,activityType:t.activity_type||null,groupId:t.group_id,visitTime:t.visit_start_from||t.time,visitDuration:t.visit_duration};return e.push(i)})),this.studentCourseVisitDetailsCache[s]=e,i(e)}),(()=>i({})))}i(this.studentCourseVisitDetailsCache[s])}courseActivitiesStudentVisits(t,e,i){var s="".concat(t,"_").concat(e);if(!this.studentActivityVisitCache[s]){var r=this._query("courses/".concat(t,"/users/").concat(e,"/user-visits/metrics?group_by=activity,group,type"));return a.when(r).then((t=>{var e={};return t.forEach((function(t){var i="".concat(t.activity_type,"_").concat(t.activity_id);return t.group_id>0&&(i+="_".concat(t.group_id)),e[i]={firstVisit:t.data.first_visit_start_from||t.data.first_time,lastVisit:t.data.last_time,visits:t.data.count||0,visitDuration:t.data.sum||0,type:t.activity_type}})),this.studentActivityVisitCache[s]=e,i(e)}),(()=>i({})))}i(this.studentActivityVisitCache[s])}courseStudentActivityTypeVisits(t,e,i,s){var r="course"===e?"user":"user,type";"course"===e&&(e="");var n=this._query("courses/".concat(t,"/user-visits/metrics?user_ids=").concat(i,"&activity_type=").concat(e,"&group_by=").concat(r));return a.when(n).then((t=>{var e={};return t.forEach((t=>e[t.user_id]={firstVisit:t.data.first_visit_start_from||t.data.first_time,lastVisit:t.data.last_time,visits:t.data.count||0,visitDuration:t.data.sum||0,type:t.activity_type})),s(e)}),(()=>s({})))}courseVisitsStat(t,e,i,s,r){"course"===e&&(e="");var c=this._query("courses/".concat(t,"/user-visits/metrics?time_restrict=").concat(s,"&activity_type=").concat(e));return a.when(c).then((t=>{var e,a,c;"month"===s&&(a=n(n().format("YYYY-MM-DD"))),"month"===s&&(e=a.clone().add(-11,"months"));var o=this._emptyDay(),u=this._emptyDay();return"hour"===s?c=t:"day"===s?c=t.slice(t.length-i,t.length+1):"month"===s&&(c=this._filterVisitsByDate(t,e,a)),c.forEach(((t,e)=>o[e]=t.student_count||0)),c.forEach(((t,e)=>u[e]=t.student_distinct||0)),r({visits:o,visitors:u})}),(()=>r({})))}usersCourseActivityTypeVisits(t,e,i,s,r,c){"course"===r&&(r="");var u=this._query("courses/".concat(t,"/user-visits/metrics?time_restrict=").concat(s,"&user_ids=").concat(e,"&activity_type=").concat(r,"&group_by=user"));return a.when(u).then((t=>{var e,a;"month"===s&&(a=n(n().format("YYYY-MM-DD"))),"month"===s&&(e=a.clone().add(-11,"months"));var r,u={},h=o(t);try{for(h.s();!(r=h.n()).done;){var d=r.value,v=[];if("hour"===s)v=d.data;else if("day"===s){u[d.user_id]=this._emptyDays(i);var l=d.data.length;v=d.data.slice(l-i,l+1)}else"month"===s&&(v=this._filterVisitsByDate(d.data,e,a));u[d.user_id]=v.map(((t,e)=>t.student_count||0))}}catch(t){h.e(t)}finally{h.f()}return c(u)}),(()=>c([])))}courseActivitiesVisits(t,e,i){if(!this.activitiesVisitCache[t]){var s=e?"student_":"",r=this._query("courses/".concat(t,"/user-visits/metrics?group_by=activity,group,type"));return a.when(r).then((e=>{var a={};return e.forEach((function(t){var e="".concat(t.activity_type,"_").concat(t.activity_id);return t.group_id>0&&(e+="_".concat(t.group_id)),a[e]={visits:t.data["".concat(s,"count")]||0}})),this.activitiesVisitCache[t]=a,i(a)}),(()=>i({})))}i(this.activitiesVisitCache[t])}activityVisits(t,e,i,r){var n,o="".concat(i,"_").concat(e,"_").concat(t);if(!this.activityVisitCache[o]){if(s.contains(e,"_")){var u=c(Array.from(e.split("_")),2);e=u[0],n=u[1]}else n="null";var h=this._query("courses/".concat(t,"/activities/").concat(e,"/activity-types/").concat(i,"/user-visits/metrics?group=").concat(n,"&group_by=user"));return a.when(h).then((t=>{var e={};return t.forEach((t=>e[t.user_id]={lastVisit:t.data.last_time,visits:t.data.count||0})),this.activityVisitCache[o]=e,r(e)}),(()=>r({})))}r(this.activityVisitCache[o])}userCourseVisits(t,e,i){var s="".concat(e,"_").concat(t);if(!this.userCourseVisitsCache[s]){var r=this._query("courses/".concat(e,"/users/").concat(t,"/user-visits/metrics"));return a.when(r).then((t=>{var e={visits:t.count||0,visitDuration:t.sum||0};return this.userCourseVisitsCache[s]=e,i(e)}),(()=>i({})))}i(this.userCourseVisitsCache[s])}userCourseVideosVisits(t,e,i){var s="".concat(e,"_").concat(t);if(!this.userCourseVideosVisitsCache[s]){var r=this._query("courses/".concat(e,"/users/").concat(t,"/online-videos/metrics?group_by=activity")),n=this._query("courses/".concat(e,"/users/").concat(t,"/interactions/metrics?group_by=activity"));return a.when(r,n).then(((t,e)=>{var a,r={viewCount:0,playCount:0,playDuration:0,dataOnlineVideos:t},n="success"===t[1]?t[0]:[],c="success"===e[1]?e[0]:[],u=o(n.concat(c));try{for(u.s();!(a=u.n()).done;){var h=a.value;h.data&&(r.viewCount+=h.data.view_count||0,r.playCount+=h.data.play_count||0,(null!=h.data.play_duration)>0&&(r.playDuration+=h.data.play_duration))}}catch(t){u.e(t)}finally{u.f()}return this.userCourseVideosVisitsCache[s]=r,i(r)}),(()=>i({})))}i(this.userCourseVideosVisitsCache[s])}userMaterialDownloads(t,e,i){var s="".concat(e,"_").concat(t);if(!this.userMaterialDownloadsCache[s]){var r=this._query("courses/".concat(e,"/users/").concat(t,"/materials/metrics"));return a.when(r).then((t=>{var e={downloads:(t.download_count||0)+(t.view_count||0)};return this.userMaterialDownloadsCache[s]=e,i(e)}),(()=>i({})))}i(this.userMaterialDownloadsCache[s])}_onVisitsQuerySuccess(t,e,i,s){return function(a){var r=a[e]||0;return t[i]=r,s(r)}}_onVisitsDaysQuerySuccess(t,e,i,s,a){return r=>{var n={visits:this._emptyDays(i),visitors:this._emptyDays(i)};return(r=r.slice(r.length-i,r.length+1)).forEach((function(t,e){return n.visits[e]=t["".concat(s,"count")]||0,n.visitors[e]=t["".concat(s,"distinct")]||0})),t[e]=n,a(n)}}_filterVisitsByDate(t,e,i){var s,a=[];if(this._isVisitsByMonth(t)){for(var r=e.get("year"),c=e.get("month")+1,o=i.get("year"),u=i.get("month")+1;r<=o;){for(var h=r<o?12:u;c<=h;){s=n().year(r).month(c-1).date(1).hour(0).minute(0).second(0).format("YYYY/MM/DD HH:mm:ss"),a.push(this._filterVisitByTime(t,s)),c+=1}c=1,r+=1}return a}for(var d=e;i.diff(d,"days")>=0;)s=d.format("YYYY/MM/DD HH:mm:ss"),a.push(this._filterVisitByTime(t,s)),d.add(1,"days");return a}_filterVisitByTime(t,e){var i,a=s.filter(t,(t=>t.time===e));1===a.length?i=a[0]:i=s.find(a,(t=>void 0!==t.count))||{count:0,distinct:0};return i}_isVisitsByMonth(t){if(t.length<2)return!1;var e=n(t[0].time,"YYYY/MM/DD HH:mm");return n(t[1].time,"YYYY/MM/DD HH:mm").diff(e,"days")>27}_onVisitsTodayQuerySuccess(t,e,i,s){return a=>{var r={visits:this._emptyDay(),visitors:this._emptyDay()};return a.forEach((function(t,e){return r.visits[e]=t["".concat(i,"count")]||0,r.visitors[e]=t["".concat(i,"distinct")]||0})),t[e]=r,s(r)}}_onVisitsYearQuerySuccess(t,e,i,s){return a=>{var r={visits:this._emptyYear(),visitors:this._emptyYear()},c=n(n().format("YYYY-MM-DD")),o=c.clone().add(-11,"months");return(a=this._filterVisitsByDate(a,o,c)).forEach((function(t,e){return r.visits[e]=t["".concat(i,"count")]||0,r.visitors[e]=t["".concat(i,"distinct")]||0})),t[e]=r,s(r)}}_emptyYear(){var t=(new Date).getMonth()+1;return s.map(r.range(1,t,!0),(()=>0))}_emptyDays(t){return s.map(r.range(1,t,!0),(()=>0))}_emptyDay(){var t=(new Date).getHours()+1;return s.map(r.range(1,t,!0),(()=>0))}courseVisits(t,e,i){if(!(t in this.courseVisitsCache)){var s=e?"student_":"",r=this._onVisitsQuerySuccess(this.courseVisitsCache,"".concat(s,"count"),t,i),n=this._query("courses/".concat(t,"/user-visits/metrics"));return a.when(n).then(r,(()=>i(0)))}i(this.courseVisitsCache[t])}userCourseVisitsToday(t,e,i){var s="".concat(t,"_").concat(e);if(!(s in this.userCourseVisitsTodayCache)){var r=this._onVisitsTodayQuerySuccess(this.userCourseVisitsTodayCache,s,"",(t=>i(t.visits||[]))),n=this._query("courses/".concat(t,"/users/").concat(e,"/user-visits/metrics?time_restrict=hour"));return a.when(n).then(r,(()=>i({})))}i(this.userCourseVisitsTodayCache[s].visits)}courseVisitsToday(t,e,i){if(!(t in this.courseVisitsTodayCache)){var s=e?"student_":"",r=this._onVisitsTodayQuerySuccess(this.courseVisitsTodayCache,t,s,i),n=this._query("courses/".concat(t,"/user-visits/metrics?time_restrict=hour"));return a.when(n).then(r,(()=>i({})))}i(this.courseVisitsTodayCache[t])}_onGetCourseActivitiesVisitsDays(t,e,i,s,a){return r=>{var n={};return r.forEach((t=>{var e="".concat(t.activity_type,"_").concat(t.activity_id);t.group_id>0&&(e+="_".concat(t.group_id)),n[e]=this._emptyDays(i);var a=t.data.length;return t.data.slice(a-i,a+1).forEach(((t,i)=>n[e][i]=t["".concat(s,"count")]||0))})),t[e]=n,a(n)}}courseVisitsCustomRange(t,e,i,r,n,c){var o=(new Date).getTimezoneOffset()/-60,u="courses/".concat(t,"/user-visits/visits?start=").concat(e,"&end=").concat(i,"&split=").concat(r,"&timezone_offset=").concat(o);n&&(u="".concat(u,"&activity_type=").concat(n));var h=this._query(u);return a.when(h).then((function(t){var e={};return s.map(t,((t,i)=>e[i]={visits:t.visits,visitors:t.visitor_ids.length})),c(e)}),(()=>c({})))}courseActivitiesVisitsCustomRange(t,e,i,s,r,n){var c=(new Date).getTimezoneOffset()/-60,u="courses/".concat(t,"/activities/user-visits/visits?start=").concat(e,"&end=").concat(i,"&split=").concat(s,"&timezone_offset=").concat(c);r&&(u="".concat(u,"&activity_type=").concat(r));var h=this._query(u);return a.when(h).then((function(t){var e,i={},s=o(t);try{for(s.s();!(e=s.n()).done;){var a=e.value;i[a.activity_id]=a.visits}}catch(t){s.e(t)}finally{s.f()}return n(i)}),(()=>n({})))}courseUsersVisitsCustomRange(t,e,i,s,r,n){var c=(new Date).getTimezoneOffset()/-60,u="courses/".concat(t,"/users/user-visits/visits?start=").concat(e,"&end=").concat(i,"&split=").concat(s,"&timezone_offset=").concat(c);r&&(u="".concat(u,"&activity_type=").concat(r));var h=this._query(u);return a.when(h).then((function(t){var e,i={},s=o(t);try{for(s.s();!(e=s.n()).done;){var a=e.value;i[a.user_id]=a.visits}}catch(t){s.e(t)}finally{s.f()}return n(i)}),(()=>n({})))}userCourseActivitiesVisitsDays(t,e,i,s){var r="".concat(t,"_").concat(e,"_").concat(i);if(!(r in this.userCourseActivitiesVisitsDaysCache)){var n=this._onGetCourseActivitiesVisitsDays(this.userCourseActivitiesVisitsDaysCache,r,i,"",s),c=this._query("courses/".concat(t,"/users/").concat(e,"/user-visits/metrics?group_by=activity,group,type&time_restrict=day"));return a.when(c).then(n,(()=>s([])))}s(this.userCourseActivitiesVisitsDaysCache[r])}courseActivitiesVisitsDays(t,e,i,s){var r="".concat(t,"_").concat(e);if(!(r in this.courseActivitiesVisitsDaysCache)){var n=i?"student_":"",c=this._onGetCourseActivitiesVisitsDays(this.courseActivitiesVisitsDaysCache,r,e,n,s),o=this._query("courses/".concat(t,"/user-visits/metrics?time_restrict=day&group_by=activity,group,type"));return a.when(o).then(c,(()=>s([])))}s(this.courseActivitiesVisitsDaysCache[r])}_onGetCourseActivitiesVisitsTodayOrYear(t,e,i,s){return function(a){var r={};return a.forEach((function(t){var e="".concat(t.activity_type,"_").concat(t.activity_id);return t.group_id>0&&(e+="_".concat(t.group_id)),r[e]=t.data.map((t=>t["".concat(i,"count")]||0))})),t[e]=r,s(r)}}userCourseActivitiesVisitsToday(t,e,i){var s="".concat(t,"_").concat(e);if(!(s in this.userCourseActivitiesVisitsTodayCache)){var r=this._onGetCourseActivitiesVisitsTodayOrYear(this.userCourseActivitiesVisitsTodayCache,s,"",i),n=this._query("courses/".concat(t,"/users/").concat(e,"/user-visits/metrics?time_restrict=hour&group_by=activity,group,type"));return a.when(n).then(r,(()=>i([])))}i(this.userCourseActivitiesVisitsTodayCache[s])}courseActivitiesVisitsToday(t,e,i){if(!(t in this.courseActivitiesVisitsTodayCache)){var s=e?"student_":"",r=this._onGetCourseActivitiesVisitsTodayOrYear(this.courseActivitiesVisitsTodayCache,t,s,i),n=this._query("courses/".concat(t,"/user-visits/metrics?time_restrict=hour&group_by=activity,group,type"));return a.when(n).then(r,(()=>i([])))}i(this.courseActivitiesVisitsTodayCache[t])}userCourseActivitiesVisitsYear(t,e,i){var s="".concat(t,"_").concat(e);if(!(s in this.userCourseActivitiesVisitsYearCache)){var r=this._onGetCourseActivitiesVisitsTodayOrYear(this.userCourseActivitiesVisitsYearCache,s,"",i),n=this._query("courses/".concat(t,"/users/").concat(e,"/user-visits/metrics?time_restrict=month&group_by=activity,group,type"));return a.when(n).then(r,(()=>i([])))}i(this.userCourseActivitiesVisitsYearCache[s])}courseActivitiesVisitsYear(t,e,i){if(!(t in this.courseActivitiesVisitsYearCache)){var s=e?"student_":"",r=this._onGetCourseActivitiesVisitsTodayOrYear(this.courseActivitiesVisitsYearCache,t,s,i),n=this._query("courses/".concat(t,"/user-visits/metrics?time_restrict=month&group_by=activity,group,type"));return a.when(n).then(r,(()=>i([])))}i(this.courseActivitiesVisitsYearCache[t])}userCourseVisitsDays(t,e,i,s){var r="".concat(t,"_").concat(e,"_").concat(i);if(!(r in this.userCourseVisitsDaysCache)){var n=this._onVisitsDaysQuerySuccess(this.userCourseVisitsDaysCache,r,i,"",(t=>s(t.visits||[]))),c=this._query("courses/".concat(t,"/users/").concat(e,"/user-visits/metrics?time_restrict=day"));return a.when(c).then(n,(()=>s({})))}s(this.userCourseVisitsDaysCache[r].visits)}courseVisitsDays(t,e,i,s){var r="".concat(t,"_").concat(e);if(!(r in this.courseVisitsDaysCache)){var n=i?"student_":"",c=this._onVisitsDaysQuerySuccess(this.courseVisitsDaysCache,r,e,n,s),o=this._query("courses/".concat(t,"/user-visits/metrics?time_restrict=day"));return a.when(o).then(c,(()=>s({})))}s(this.courseVisitsDaysCache[r])}userCourseVisitsYear(t,e,i){var s="".concat(t,"_").concat(e);if(!this.userCourseVisitsYearCache[s]){var r=this._onVisitsYearQuerySuccess(this.userCourseVisitsYearCache,s,"student_",(t=>i(t.visits||[]))),n=this._query("courses/".concat(t,"/users/").concat(e,"/user-visits/metrics?time_restrict=month"));return a.when(n).then(r,(()=>i({})))}i(this.userCourseVisitsYearCache[s].visits)}courseVisitsYear(t,e,i){if(!(t in this.courseVisitsYearCache)){var s=e?"student_":"",r=this._onVisitsYearQuerySuccess(this.courseVisitsYearCache,t,s,i),n=this._query("courses/".concat(t,"/user-visits/metrics?time_restrict=month"));return a.when(n).then(r,(()=>i({})))}i(this.courseVisitsYearCache[t])}departmentVisits(t,e){if(!(t in this.departmentVisitsCache)){var i=this._onVisitsQuerySuccess(this.departmentVisitsCache,"count",t,e),s=this._query("deps/".concat(t,"/user-visits/metrics"));return a.when(s).then(i,(()=>e(0)))}e(this.departmentVisitsCache[t])}departmentVisitsDays(t,e,i){var s="".concat(t,"_").concat(e);if(!(s in this.departmentVisitsDaysCache)){var r=this._onVisitsDaysQuerySuccess(this.departmentVisitsDaysCache,s,e,"",i),n=this._query("deps/".concat(t,"/user-visits/metrics?time_restrict=day"));return a.when(n).then(r,(()=>i({})))}i(this.departmentVisitsDaysCache[s])}departmentVisitsToday(t,e){if(!(t in this.departmentVisitsTodayCache)){var i=this._onVisitsTodayQuerySuccess(this.departmentVisitsTodayCache,t,"",e),s=this._query("deps/".concat(t,"/user-visits/metrics?time_restrict=hour"));return a.when(s).then(i,(()=>e({})))}e(this.departmentVisitsTodayCache[t])}departmentVisitsYear(t,e){if(!(t in this.departmentVisitsYearCache)){var i=this._onVisitsYearQuerySuccess(this.departmentVisitsYearCache,t,"",e),s=this._query("deps/".concat(t,"/user-visits/metrics?time_restrict=month"));return a.when(s).then(i,(()=>e({})))}e(this.departmentVisitsYearCache[t])}orgVisits(t,e){if(!(t in this.orgVisitsCache)){var i=this._onVisitsQuerySuccess(this.orgVisitsCache,"count",t,e),s=this._query("orgs/".concat(t,"/user-visits/metrics"),!0);return a.when(s).then(i,(()=>e(0)))}e(this.orgVisitsCache[t])}orgVisitsDays(t,e,i){var s="".concat(t,"_").concat(e);if(!(s in this.orgVisitsDaysCache)){var r=this._query("orgs/".concat(t,"/user-visits/metrics?time_restrict=day"),!0);return a.when(r).then((t=>{var a={visits:this._emptyDays(e),visitors:this._emptyDays(e)},r=n(n().format("YYYY-MM-DD")),c=r.clone().add(1-e,"days");return(t=this._filterVisitsByDate(t,c,r)).forEach((function(t,e){var i=t.student_count?t.student_count:0,s=t.teacher_count?t.teacher_count:0;a.visits[e]=i+s;var r=t.student_distinct?t.student_distinct:0,n=t.teacher_distinct?t.teacher_distinct:0;a.visitors[e]=r+n})),this.orgVisitsDaysCache[s]=a,i(a)}),(()=>i({})))}i(this.orgVisitsDaysCache[s])}orgVisitsByBrowserDays(t,e,i){var s="".concat(t,"_").concat(e);if(!(s in this.orgVisitsByBrowserCache)){var r=this._query("orgs/".concat(t,"/user-visits/browsers?days=").concat(e),!0);return a.when(r).then((t=>(this.orgVisitsDaysCache[s]=t,i(t))),(()=>i(0)))}i(this.orgVisitsByBrowserCache[s])}orgVisitsToday(t,e){if(!(t in this.orgVisitsTodayCache)){var i=this._onVisitsTodayQuerySuccess(this.orgVisitsTodayCache,t,"",e),s=this._query("orgs/".concat(t,"/user-visits/metrics?time_restrict=hour"),!0);return a.when(s).then(i,(()=>e({})))}e(this.orgVisitsTodayCache[t])}orgVisitsYear(t,e){if(!(t in this.orgVisitsYearCache)){var i=this._onVisitsYearQuerySuccess(this.orgVisitsYearCache,t,"",e),s=this._query("orgs/".concat(t,"/user-visits/metrics?time_restrict=month"),!0);return a.when(s).then(i,(()=>e({})))}e(this.orgVisitsYearCache[t])}orgBrowserVisitsByDateRange(t,e,i,s){var r="".concat(t,"_").concat(e,"_").concat(i);if(!(r in this.orgVisitsByDateRangeBrowserCache)){var n=this._query("orgs/".concat(t,"/user-visits/date-range/browsers?start_date=").concat(e,"&end_date=").concat(i));return a.when(n).then((t=>(this.orgVisitsDaysCache[r]=t,s(t))),(()=>s(0)))}s(this.orgVisitsByDateRangeBrowserCache[r])}orgVisitsByDateRange(t,e,i,s){var r="".concat(t,"_").concat(e,"_").concat(i);if(!(r in this.orgVisitsDateRangeCache)){var c=this._query("orgs/".concat(t,"/user-visits/metrics?time_restrict=date-range&start_date=").concat(e,"&end_date=").concat(i));return a.when(c).then((t=>{var a={visits:[],visitors:[]};return(t=this._filterVisitsByDate(t,n(e),n(i))).forEach((function(t,e){return a.visits[e]=t.count||0,a.visitors[e]=t.distinct||0})),this.orgVisitsDateRangeCache[r]=a,s(a)}),(()=>s({})))}s(this.orgVisitsDateRangeCache[r])}_onBulletinVisitsQuerySuccess(t,e,i,s,a){return r=>{var n=s,c=r.length;return r.slice(c-i,c+1).forEach(((t,e)=>n[e]=t.view_count)),t[e]=n,a(n)}}bulletinVisitsDays(t,e,i){var s="".concat(t,"_").concat(e);if(!(s in this.bulletinVisitsDaysCache)){var r=this._emptyDays(e),n=this._onBulletinVisitsQuerySuccess(this.bulletinVisitsDaysCache,s,e,r,i),c=this._query("courses/".concat(t,"/bulletins/histogram?time_restrict=day"));return a.when(c).then(n,(()=>i([])))}i(this.bulletinVisitsDaysCache[s])}bulletinVisitsToday(t,e){if(!(t in this.bulletinVisitsTodayCache)){var i=this._emptyDay(),s=this._onBulletinVisitsQuerySuccess(this.bulletinVisitsTodayCache,t,24,i,e),r=this._query("courses/".concat(t,"/bulletins/histogram?time_restrict=hour"));return a.when(r).then(s,(()=>e([])))}e(this.bulletinVisitsTodayCache[t])}bulletinVisitsYear(t,e){if(!(t in this.bulletinVisitsYearCache)){var i=this._emptyYear(),s=this._onBulletinVisitsQuerySuccess(this.bulletinVisitsYearCache,t,12,i,e),r=this._query("courses/".concat(t,"/bulletins/histogram?time_restrict=month"));return a.when(r).then(s,(()=>e([])))}e(this.bulletinVisitsYearCache[t])}bulletinVisitsCustomRange(t,e,i,s,r){var n="".concat(t,"_").concat(e,"_").concat(i);if(!(n in this.bulletinVisitsDateRangeCache)){var c=(new Date).getTimezoneOffset()/-60,o=this._query("courses/".concat(t,"/bulletins/custom-time-range?start=").concat(e,"&end=").concat(i,"&split=").concat(s,"&timezone_offset=").concat(c));return a.when(o).then((t=>(this.bulletinVisitsDateRangeCache[n]=t,r(t))),(()=>r([])))}r(this.bulletinVisitsDateRangeCache[n])}bulletinGroupByVisits(t,e,i){var r="".concat(t,"_").concat(e);if(!(r in this.bulletinVisitsCache)){var n=this._query("courses/".concat(t,"/bulletins/visit?group_by=").concat(e));return a.when(n).then((t=>{var e={};return s.map(t,(t=>e[t.bulletin_id]={view_count:t.data.view_count,user_distinct:t.data.user_distinct})),this.bulletinVisitsCache[r]=e,i(e)}),(()=>i([])))}i(this.bulletinVisitsCache[r])}bulletinVisitsStat(t,e,i){var s="".concat(t,"_").concat(e);if(!(s in this.bulletinVisitsStatCache)){var r=this._query("courses/".concat(t,"/bulletins/").concat(e,"/users/visits"));return a.when(r).then((t=>(this.bulletinVisitsStatCache[s]=t,i(t))),(()=>i([])))}i(this.bulletinVisitsStatCache[s])}_query(t,e){var i="".concat(this.url,"/api/").concat(t);return e&&this.enableMgsQueryCache&&(i="/anonymous-api/metric-cache/".concat(t)),a.ajax({type:"GET",url:i,dataType:"json"})}}window.statisticsSettings&&(window.stv=new d(window.statisticsSettings))}}]);