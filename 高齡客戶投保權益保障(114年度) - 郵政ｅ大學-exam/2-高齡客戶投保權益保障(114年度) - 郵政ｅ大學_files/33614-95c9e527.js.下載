(self.webpackChunklms=self.webpackChunklms||[]).push([[33614],{33614:function(e,i,t){var r=t(708468),s=t(361204),o=t(730381),n=t(904072),a=t(993776);function u(e,i){return function(e){if(Array.isArray(e))return e}(e)||function(e,i){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var t=[],r=!0,s=!1,o=void 0;try{for(var n,a=e[Symbol.iterator]();!(r=(n=a.next()).done)&&(t.push(n.value),!i||t.length!==i);r=!0);}catch(e){s=!0,o=e}finally{try{r||null==a.return||a.return()}finally{if(s)throw o}}return t}(e,i)||c(e,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e,i){var t;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(t=c(e))||i&&e&&"number"==typeof e.length){t&&(e=t);var r=0,s=function(){};return{s:s,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,n=!0,a=!1;return{s:function(){t=e[Symbol.iterator]()},n:function(){var e=t.next();return n=e.done,e},e:function(e){a=!0,o=e},f:function(){try{n||null==t.return||t.return()}finally{if(a)throw o}}}}function c(e,i){if(e){if("string"==typeof e)return d(e,i);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?d(e,i):void 0}}function d(e,i){(null==i||i>e.length)&&(i=e.length);for(var t=0,r=new Array(i);t<i;t++)r[t]=e[t];return r}t(491038),t(702707),t(140561),t(556977),t(132023),t(115306),t(454747);var v=t(117403).default;e.exports=["$http","activityApi","$q","Course","toastr","commonApi",function(e,i,t,c,d,m){var p={},f={},y={},_={},h=null,b=null,g=null,A=null,S=null,I=null,x=null,C=null,w=null,M=null,E={},k={},F=null,R=null,j=null,P=null,T=null,q=null,H={},L=function(e){var i=1;return r.each(e,(e=>(e.sort=i,i++))),e},D=function(e,i,t){var o=r.sortBy(t,"sort"),n=s.copy(o[e]);o.splice(e,1),o.splice(i,0,n);var a=1;return r.each(o,(function(e){return e.sort=a,a++})),o},O=function(){return p={},f=null},V=(e,i)=>(()=>{var t,s=[],o=l(i.modules);try{for(o.s();!(t=o.n()).done;){var n,a=t.value,u=l(a.directActivities);try{for(u.s();!(n=u.n()).done;){var c=n.value;c.prerequisites&&c.prerequisites.length>0&&r.remove(c.prerequisites,(i=>i.activity_id===e.id&&i.activity_type===e.type))}}catch(e){u.e(e)}finally{u.f()}s.push(a.syllabuses.map((i=>(()=>{var t,s=[],o=l(i.activities);try{for(o.s();!(t=o.n()).done;){var n=t.value;n.prerequisites&&n.prerequisites.length>0?s.push(r.remove(n.prerequisites,(i=>i.activity_id===e.id&&i.activity_type===e.type))):s.push(void 0)}}catch(e){o.e(e)}finally{o.f()}return s})())))}}catch(e){o.e(e)}finally{o.f()}return s})(),B="unpublished",U="scheduled";var Y={course:{},_course:null,fillActivitiesInModuleAndSyllabus:(e,i)=>r.map(i,(function(i){i.readType="learning_activity";var t,s=!1,o=l(e.course.activities);try{for(o.s();!(t=o.n()).done;){var n=t.value;n.id===i.id&&n.type===i.type&&(s=!0)}}catch(e){o.e(e)}finally{o.f()}if(!s){var a=e.getModule(i.module_id);if(e.course.activities.push(i),!a)return;if(a.activities.push(i),!i.syllabus_id)return void a.directActivities.push(i);var u=r.find(a.syllabuses,{id:i.syllabus_id});if(u)return u.activities.push(i)}})),fillExamsInModuleAndSyllabus(e,i,t){var s=e.getSyllabuses();return r.each(i,(function(i){var o,n=!1;i.type="exam",i.readType="exam_activity",i.has_make_up=(o=i.make_up_record)&&o.is_processing&&!o.has_submitted;var a,u=l(e.course.activities);try{for(u.s();!(a=u.n()).done;){var c=a.value;c.id===i.id&&c.type===i.type&&(n=!0)}}catch(e){u.e(e)}finally{u.f()}if(!n){var d;if(e.course.activities.push(i),"module"===i.referrer_type&&!t)return i.module_id=i.referrer_id,(d=r.find(e.course.modules,{id:i.referrer_id})).activities.push(i),d.directActivities.push(i);if("syllabus"===i.referrer_type){var v=r.find(s,{id:i.referrer_id});if(v)return d=e.getModule(v.module_id),i.module_id=d.id,i.syllabus_id=v.id,v.activities.push(i),d.activities.push(i)}}}))},fillLiveRecordsInModule:(e,i)=>r.map(i,(function(i){i.type="live_record";var t,r=!1,s=l(e.course.activities);try{for(s.s();!(t=s.n()).done;){var o=t.value;o.id===i.id&&o.type===i.type&&(r=!0)}}catch(e){s.e(e)}finally{s.f()}if(!r){var n=e.getModule(i.module_id);if(e.course.activities.push(i),!n)return;return n.activities.push(i),n.directActivities.push(i)}})),fillInClassInteractionsInModule(e,i){var t={select_student:"选人",race_answer:"抢答"};return r.each(i,(function(i){if(i.unique_key="".concat(i.type,"-").concat(i.id),!r.find(e.course.activities,{id:i.id,type:i.type})&&i.module_id){var s=e.getModule(i.module_id);if(e.course.activities.push(i),!s)return;return s.activities=s.activities||[],s.directActivities=s.directActivities||[],i.sort=r.max(s.activities,"sort")+1,i.title=t[i.type],s.activities.push(i),s.directActivities.push(i)}}))},fillRollCallInModule(e,i){var t={number_rollcall:"数字点名",qr_rollcall:"二维码点名"};return r.each(i,(function(i){if(i.type="".concat(i.source,"_rollcall"),i.unique_key="".concat(i.type,"-").concat(i.id),i.inclass_type="".concat(i.source,"-rollcall"),!r.find(e.course.activities,{id:i.id,type:i.type})){var s=e.getModule(i.module_id);if(e.course.activities.push(i),!s)return;return s.activities=s.activities||[],s.directActivities=s.directActivities||[],i.sort=r.max(s.activities,"sort")+1,i.title=t[i.type],"waiting"!==i.status&&(i.start_time=i.rollcall_time),s.activities.push(i),s.directActivities.push(i)}}))},fillClassroomsInModuleAndSyllabus(e,i,t){var s=e.getSyllabuses();return r.each(i,(function(i){i.readType="classroom_activity";var o,n=!1,a=l(e.course.activities);try{for(a.s();!(o=a.n()).done;){var u=o.value;u.id===i.id&&u.type===i.type&&(n=!0)}}catch(e){a.e(e)}finally{a.f()}if(!n){var c;if(e.course.activities.push(i),!i.module_id)return;if(i.syllabus_id){var d=r.find(s,{id:i.syllabus_id});if(d)return c=e.getModule(d.module_id),d.activities.push(i),c.activities.push(i)}else if(!t&&(c=r.find(e.course.modules,{id:i.module_id})))return c.directActivities.push(i),c.activities.push(i)}}))},initQuestionnaire(i){var r=k[i];if(r)return r.promise;k[i]=r=t.defer();return e.get("/api/questionnaires/".concat(i)).success((e=>r.resolve(e))).error(d.decorateError((()=>r.resolve([])))),r.promise},initCourseAndModules(){if(S)return S.promise;S=t.defer();var e=Y.initCourseInfo(),i=Y.initModules(),r=Y.initCourseTemplateSetting();return t.all([e,i,r]).then((function(){var e=Array.from(arguments.length<=0?void 0:arguments[0]),i=u(e,3),t=i[0],r=i[1],s=i[2];return t.modules=r,t.templateSetting=s,Y._course=new c(t),Y._course.sortModules(),Y._course.sortSyllabus(),S.resolve(t)})),S.promise},initCourseTimeTable(i){if(q)return q.promise;q=t.defer();return e.get("/api/courses/".concat(i,"/lesson-timetable")).success((e=>q.resolve(e.timetables))).error(d.decorateError((()=>q.resolve([])))),q.promise},setTimeTableProperty(e,i){e.timetables=i,i.length>0&&(o.locale(n("html").attr("lang")),e.duration="".concat(o(i[0].start_time).format("YYYY.MM.DD")," ").concat(o(i[0].start_time).format("HH:mm"),"-").concat(o(i[0].end_time).format("HH:mm")),e.teachingClasses=e.course_attributes.teaching_class_name.replace(/,/g," / "),e.location=i[0].room.room_name)},initModules(){if(g)return g.promise;g=t.defer();var i=n("#courseId").val();return e.get("/api/courses/".concat(i,"/modules")).success((e=>g.resolve(e.modules))).error(d.decorateError((()=>g.resolve([])))),g.promise},initCourseTemplateSetting(){if(A)return A.promise;if(A=t.defer(),"Student"===n("#userRole").val())A.resolve({});else{var i=n("#courseId").val();e.get("/api/course/".concat(i,"/template-setting")).success((e=>A.resolve(e))).error(d.decorateError((()=>A.resolve([]))))}return A.promise},initUserReadsRecords(i){var r=n("#courseId").val(),s=t.defer();return e.get("/api/course/".concat(r,"/users-reads?type=").concat(i)).success((e=>s.resolve(e))),s.promise},initCourseInfo(){var e=n("#courseId").val();if(b)return b.promise;b=t.defer();return i.course(e,"id,name,start_date,end_date,course_code,subject_code,credit,is_child,is_master,course_attributes(student_count, teaching_class_name,practice_hours,data),academic_year,semester,public_scope,learning_mode,teaching_mode,score_published,students_count,compulsory, syllabus_enabled,imported_from,course_type,audit_status,display_name,classroom_schedule,second_name,department(id,code,name), grade(id,name),klass(id,name),instructors(id,user_no,email,avatar_big_url,avatar_small_url,name,portfolio_url), org(is_enterprise_or_organization,is_transfer_arrears)",(function(e){return Y.course=e,e.activities=e.activities||[],b.resolve(e)}),(()=>b=null)),b.promise},initCourse(e,r){if(h)return h.promise;h=t.defer();var s=function(e){return Y.course=e,e.activities=e.activities||[],Y._course=new c(e),Y._course.sortModules(),Y._course.sortSyllabus(),h.resolve(Y.course)},o=n("#courseId").val(),a="id,name,sort,syllabuses(".concat("id,date,summary,syllabus_id,objective,comments,module_id",")"),u="id,name,department(code,name),grade(name),klass(name), instructors(id,avatar_big_url,name),modules(".concat(a,"), course_code,subject_code,course_attributes(student_count), public_scope,learning_mode,teaching_mode,score_published,syllabus_enabled,imported_from"),l=e||u;return r?i.anonymousCourse(o,l,s,(function(){})):i.course(o,l,s,(()=>h=null)),h.promise},getActivitiesByModuleIds(e,t,r){var s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return i.getActivitiesByModuleIds(e,t,r,s)},getCourseSyllabuses:()=>Y._course.getSyllabuses(),initActivities(i){if(M)return M.promise;M=t.defer();return e.get("/api/courses/".concat(i,"/activities")).success((e=>M.resolve(e.activities))).error(d.decorateError((()=>M.resolve([])))),M.promise},initActivitiesForActivityList(e,i){var t=this.initActivities(e.id),s=this,o=r.parseInt(n("#userId").data("id")),a=n("#courseId").val();stv.userCourseVisits(o,a,(function(i){e.course.modules.moduleReadTime=Math.floor(i.visitDuration/60)})),stv.userCourseVideosVisits(o,a,(function(o){return t.then((t=>(r.isEmpty(i)||(t=r.filter(t,(e=>!i.includes(e.type)))),t.forEach((e=>{if("online_video"===e.type){var i=o.dataOnlineVideos[0].find((i=>i.activity_id===e.id));i&&(e.readTime=Math.floor(i.data.play_duration/60))}})),s.fillActivitiesInModuleAndSyllabus(e,t,!0)))),t}))},initExamsForActivityList(e){if(I)return I.promise.then((i=>this.fillExamsInModuleAndSyllabus(e,i,!0))),I.promise;return I=t.defer(),i.examInCourse(e.id,(i=>(this.fillExamsInModuleAndSyllabus(e,i.exams),I.resolve(i.exams)))),I.promise},initLiveRecordsForActivityList(e){if(x)return x.promise.then((i=>this.fillLiveRecordsInModule(e,i))),x.promise;return x=t.defer(),i.liveRecordInCourse(e.id,(i=>(this.fillLiveRecordsInModule(e,i.live_records),x.resolve(i.live_records)))),x.promise},initInClassInteractionsForActivityList(e){C=t.defer();return i.inclassInteractionInCourse(e,(e=>C.resolve(e.interactions)),(()=>C.resolve([]))),C.promise},initRollCallsForActivityList(e){var r=t.defer();return i.baseRollcallInCourse(e,(e=>r.resolve(e.rollcalls))),r.promise},initExamsForActivityListOnlyRequest(e){var r=t.defer();return i.examInCourse(e,(e=>r.resolve(e.exams)),(()=>r.resolve([]))),r.promise},initLiveRecordsForActivityListOnlyRequest(e){var r=t.defer();return i.liveRecordInCourse(e,(e=>r.resolve(e.live_records)),(()=>r.resolve([]))),r.promise},initClassroomsForActivityList(e){if(w)return w.promise.then((i=>this.fillClassroomsInModuleAndSyllabus(e,i,!0))),w.promise;return w=t.defer(),i.classroomInCourse(e.id,(i=>(this.fillClassroomsInModuleAndSyllabus(e,i.classrooms),w.resolve(i.classrooms)))),w.promise},initClassroomsForActivityListOnlyRequest(e){var r=t.defer();return i.classroomInCourse(e,(e=>r.resolve(e.classrooms)),(()=>r.resolve([]))),r.promise},initCatalogActivityList(e){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(o)return o.promise.then((i=>(this.fillActivitiesInModuleAndSyllabus(e,i.learning_activities),this.fillExamsInModuleAndSyllabus(e,i.exams,!0),this.fillClassroomsInModuleAndSyllabus(e,i.classrooms,!0)))),o.promise;var s=i=>(this.fillActivitiesInModuleAndSyllabus(e,i.learning_activities),this.fillExamsInModuleAndSyllabus(e,i.exams),this.fillClassroomsInModuleAndSyllabus(e,i.classrooms),o.resolve(i)),o=t.defer();return r?i.catalogActivitiesInCourseForVisitor(e.id,s):i.catalogActivitiesInCourse(e.id,s),o.promise},initExams(e){var r=t.defer();return i.examInCourse(e,(e=>r.resolve(e.exams)),(e=>r.reject(e))),r.promise},initExamsSubmitted(e){var r=t.defer();return i.examsSubmitted(e,(e=>r.resolve(e.exam_ids))),t.all([r.promise,this.initExamScores(e)])},initExamsSubmissions(e){var r=t.defer();return i.examSubmissions(e,(e=>r.resolve(e))),r.promise},initExamScores(e){var r=t.defer();return i.examsScores(e,(e=>r.resolve(e.exam_scores)),(e=>r.reject(e))),r.promise},initClassroom(e){w=t.defer();return i.classroomInCourse(e,(e=>w.resolve(e.classrooms)),(e=>w.reject(e))),w.promise},initHomeworkWithPageInfo(e,r){if(p[r.page]&&!r.reloadPage)return p[r.page].promise;p[r.page]=t.defer();return i.homeworksInCourseWithPageInfo(e,r,(e=>p[r.page].resolve(e)),(()=>p[r.page].resolve(null))),p[r.page].promise},initGroupHomeworks(e){if(f[e])return f[e].promise;f[e]=t.defer();return i.groupHomeworksInGroupSet(e,(i=>f[e].resolve(i.homework_activities)),(()=>f[e].resolve(null))),f[e].promise},initGroupExams(e){if(y[e])return y[e].promise;y[e]=t.defer();return i.groupExamsInGroupSet(e,(i=>y[e].resolve(i.exams)),(()=>y[e].resolve(null))),y[e].promise},getGroupSets:(e,t,r)=>i.groupSetsInCourse(e,t,r),initClassroomScores(e){var r=t.defer();return i.classroomScores(e,(e=>r.resolve(e.classroom_scores)),(e=>r.reject(e))),r.promise},initForumActivity(e){var r=t.defer();return i.forumInCourse(e,(e=>r.resolve(e.forum_activities)),(e=>r.reject(e))),r.promise},initForumScores(e){var r=t.defer();return i.forumScores(e,(e=>r.resolve(e.forum_scores)),(e=>r.reject(e))),r.promise},initCourseVirtualExperimentActivity(e){var r=t.defer();return i.courseVirtualExperiments(e,(e=>r.resolve(e.virtual_experiments)),(e=>r.reject(e))),r.promise},initCourseVirtualExperimentScores(e){var r=t.defer();return i.courseVirtualExperimentsScores(e,(e=>r.resolve(e.virtual_experiments_scores)),(e=>r.reject(e))),r.promise},initWeblinkActivity(e){var r=t.defer();return i.weblinkInCourse(e,(e=>r.resolve(e.web_link_activities)),(e=>r.reject(e))),r.promise},initWeblinkScores(e){var r=t.defer();return i.weblinkScores(e,(e=>r.resolve(e.web_link_scores)),(e=>r.reject(e))),r.promise},initStudents(e){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(s)return s.promise;var s=t.defer();return i.getStudents(e,(e=>s.resolve(e.students)),r),s.promise},initWeblinkStudentScore(e){var r=t.defer();return i.weblinkStudentScores(e,(e=>r.resolve(e.web_link_scores)),(e=>r.reject(e))),r.promise},initVirtualExperimentScores(e){var r=t.defer();return i.virtualExperimentScores(e,(e=>r.resolve(e.virtual_experiment_scores)),(e=>r.reject(e))),r.promise},autoSave(i,s,o){var n=t.defer();return e.put("/api/course/activities/".concat(o,"/web_link_score"),{student_id:i,score:s}).success((function(e){return n.resolve(e),d.success(e.message)})).error((function(e,i){return n.reject(),400===i?(r.each(e.errors.score,(e=>d.error(e))),n.reject()):d.warning()})),n.promise},initQuestionnaireActivity(e){var r=t.defer();return i.questionnaireInCourse(e,(e=>r.resolve(e.questionnaires)),(e=>r.reject(e))),r.promise},initQuestionnaireScores(e){var r=t.defer();return i.questionnaireScores(e,(e=>r.resolve(e.questionnaire_scores)),(e=>r.reject(e))),r.promise},initInteractionActivity(e){var r=t.defer();return i.interactionInCourse(e,(e=>r.resolve(e.interactions)),(e=>r.reject(e))),r.promise},initInteractionScores(e){var r=t.defer();return i.interactionScores(e,(e=>r.resolve(e.interaction_scores)),(e=>r.reject(e))),r.promise},initActivitiesReadForUser(e){if(F)return F.promise;F=t.defer();return i.getActivitiesReadForUser(e,(e=>F.resolve(e.activity_reads))),F.promise},loadHomeworkSubmissionStatuses(e){if(_[e])return _[e].promise;_[e]=t.defer();return i.getHomeworkSubmissionStatus(e,(i=>_[e].resolve(i))),_[e].promise},loadHomeworkSubmissionsNum(e){var r=t.defer();return i.getHomeworkSubmissionsNum(e,(e=>r.resolve(e.homework_submission_nums))),r.promise},saveActivity(e,t,r,s){var o=function(e){return"homework"===e.type&&O(),r(e)};return t.id?i.updateActivity(t,o,s):i.addActivity(e,t,o,s)},deleteHomework:e=>i.deleteActivity(e,{},(()=>O()),(function(){})),batchDeleteHomeworks:e=>i.deleteActivities(e,{},(()=>O()),(function(){})),removeActivityFromCourse(e,i,t){var s=function(i){return!!i&&(i.id===e&&!["exam","classroom"].includes(i.type))};if(r.map(i.modules,(function(e){return r.remove(e.activities,s),r.remove(e.directActivities,s),r.map(e.syllabuses,(e=>r.remove(e.activities,s)))})),t&&t.keep_original){var o=r.find(i.activities,(i=>i.id===e&&!["exam","classroom"].includes(i.type)));return delete o.module_id,delete o.syllabus_id}return r.remove(i.activities,s)},deleteActivityFromCourse:(e,t,r,s,o)=>i.deleteActivity(e,r,d.decorateSuccess((function(){return Y.removeActivityFromCourse(e.id,t,r),V(e,t),s()})),d.decorateError(o)),deleteClassroom:(i,t,s,o,n)=>e.delete("/api/classrooms/".concat(i.id),{params:s}).success(d.decorateSuccess((function(){if(r.map(t.modules,(function(e){return r.remove(e.activities,{id:i.id,type:i.type}),r.remove(e.directActivities,{id:i.id,type:i.type}),r.map(e.syllabuses,(e=>r.remove(e.activities,{id:i.id,type:i.type})))})),s&&s.keep_original){var e=r.find(t.activities,{id:i.id,type:i.type});delete e.module_id,delete e.syllabus_id}else r.remove(t.activities,{id:i.id,type:i.type});return o()}))).error(d.decorateError(n)),deleteExam:(i,t,s,o,n)=>e.delete("/api/exams/".concat(i.id),{params:s}).success(d.decorateSuccess((function(){if(r.map(t.modules,(function(e){return r.remove(e.activities,{id:i.id,type:"exam"}),r.remove(e.directActivities,{id:i.id,type:"exam"}),r.map(e.syllabuses,(e=>r.remove(e.activities,{id:i.id,type:"exam"})))})),V(i,t),s&&s.keep_original){var e=r.find(t.activities,{id:i.id,type:"exam"});delete e.module_id,delete e.syllabus_id,e.referrer_type,e.referrer_id,t.id}else r.remove(t.activities,{id:i.id,type:"exam"});return o()}))).error(d.decorateError(n)),exchangeSyllabusActivities(e,t,r){if(t!==r){var o=D(t,r,e.activities);e.activities=s.copy(o);var n={id:e.id,activities:o};return i.updateSyllabusActivitiesSort(n,(function(){}),(function(){}))}},justExchangeInsiderModule(e,t,o,n,a){var u=r.sortBy((null==a?void 0:a.activities)||n.directActivities,"sort"),l=r.sortBy(o.fromActivities,"sort"),c=s.copy(l[e]);c.syllabus_id=(null==a?void 0:a.id)||0,u.splice(t,0,c),l.splice(e,1);var d,v=L(u),m=L(l),p=o.oldSyllabus?v:m,f=()=>{},y=()=>{};if(a&&o.oldSyllabus){d=v,a.activities=s.copy(d);var _={id:a.id,activities:d};return i.updateSyllabusActivitiesSort(_,f,y)}d=o.oldSyllabus?m:v,a?a.activities=s.copy(d):n.directActivities=s.copy(p);var h={id:a?a.id:o.oldSyllabus,activities:d},b={id:n.id,activities:p};return i.updateSyllabusActivitiesSort(h,f,y),i.updateModuleActivitiesSort(b,f,y),!0},updateActivitiesAfterExchangeSyllabus(e,i){var t=r.sortBy(e.activities,"sort");t.splice(i,1);var o=L(t);return e.activities=s.copy(o),!0},updateActivitiesAfterExchangeModule(e,i){var t=r.sortBy(e.directActivities,"sort");t.splice(i,1);var o=L(t);return e.directActivities=s.copy(o),!0},exchangeModuleActivities(e,t,r){if(t!==r){var o=D(t,r,e.directActivities);e.directActivities=s.copy(o);var n={id:e.id,activities:o};return i.updateModuleActivitiesSort(n,(function(){}),(function(){}))}},exchangeModuleOrSyllabus(e,t,o,n,a){var u=r.sortBy(o.fromActivities,"sort"),l=s.copy(u[e]);l.syllabus_id=(null==a?void 0:a.id)||0,u.splice(e,1);var c=r.sortBy((null==a?void 0:a.activities)||n.directActivities,"sort");c.splice(t,0,l);var d=L(c),v=L(u),m=o.oldSyllabus?void 0:v,p=o.oldSyllabus?v:void 0,f=a?void 0:d,y=a?d:void 0;a?a.activities=s.copy(y):n.directActivities=s.copy(f);var _={module:{fromActivities:m,toActivities:f,fromId:o.oldModule,toId:n.id},syllabus:{fromActivities:p,toActivities:y,fromId:o.oldSyllabus,toId:null==a?void 0:a.id}};return i.updateModuleOrSyllabusActivitiesSort(_,(()=>{}),(()=>{}))},loadActivity(e){var r=t.defer();return i.getActivity(e,(e=>r.resolve(e)),(()=>r.resolve(null))),r.promise},initActivitiesForStudentCompleteness(e){var r=t.defer();return i.getActivities(e,(e=>r.resolve(e.activities)),(()=>r.resolve([]))),r.promise},getActivitiesForStudentCompleteness(e){return R||(R=t.defer(),this.initActivitiesForStudentCompleteness(e).then((function(e){var i=s.copy(e);return r.each(i,(e=>e.readType="learning_activity")),R.resolve(i)}))),R.promise},getExamsForStudentCompleteness(i){if(j)return j.promise;j=t.defer();return e.get("/api/courses/".concat(i,"/exams?fields=id,type,sort,completion_criterion&no-intercept=true")).success((function(e){return r.each(e.exams,(e=>e.readType="exam_activity")),j.resolve(e.exams)})).error((()=>j.resolve([]))),j.promise},getAllActivitiesForStudentCompleteness(i){if(P)return P.promise;P=t.defer();return e.get("/api/course/".concat(i,"/my-completeness")).success((e=>P.resolve(e))).error((()=>P.resolve({}))),P.promise},updateStudentCompleteness(i,r){if(T)return T.promise;T=t.defer();return e.put("/api/course/".concat(i,"/student/").concat(r,"/completeness")).success((e=>T.resolve(e))).error((()=>T.resolve({}))),T.promise},getInstrouctsEnrolment(i){var r=t.defer();return e.get("/api/courses/".concat(i,"/educators")).success((e=>r.resolve(e.enrollments))),r.promise},logActivityRead(e,t,r,s){var o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];return i.logActivityRead(e,t||{},r||function(){},s||function(){},o)},logExamActivityRead(e,t,r,s){var o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];return i.logExamActivityRead(e,t||{},r||function(){},s||function(){},o)},getLeftScorePercentage(e){var r=t.defer();return i.getScorePercentages(e,(function(e){var i=new a(e.score_percentage_left);return r.resolve(new a(i.toFixed(1)))})),r.promise},getSubmissionNumber(e){var r=t.defer();return i.getSubmissionNumber(e,(e=>r.resolve(e.number))),r.promise},hasReviewedInterScore(e){var r=t.defer();return i.hasReviewedInterScore(e,(e=>r.resolve(e.has_reviewed))),r.promise},getHomeworkFirstSubmissionTime(e){var r=t.defer();return i.getHomeworkFirstSubmissionTime(e,(e=>r.resolve(e.first_submission_time))),r.promise},isInterReviewStarted(e){var r=t.defer();return i.isInterReviewStarted(e,(e=>r.resolve(e.is_inter_review_started))),r.promise},isIntraReviewStarted(e){var r=t.defer();return i.isIntraReviewStarted(e,(e=>r.resolve(e.is_intra_review_started))),r.promise},isHomeworkExpired(e){var r=t.defer();return i.isHomeworkExpired(e,(e=>r.resolve(e.is_expired))),r.promise},getCompletionCriteriaForType:(e,t,r,s)=>E[e]?E[e].promise:i.getCompletionCriteriaForType(e,t,r,s),getActivityCompletionCriteria:(e,t,r,s)=>i.getActivityCompletionCriteria(e,t,r,s),getActivityPrerequisites:(e,t,r)=>i.getActivityPrerequisites(e,t,r),removeAllDependants:(e,t)=>i.removeAllDependants(e,t,(function(){})),deleteActivityPrerequisite:(e,t,r)=>i.deleteActivityPrerequisite(e,t,r),getUnavailablePrerequisites:(e,t,r)=>i.getUnavailablePrerequisites(e,t,r),getActivityHasDependents:(e,t,r)=>i.getActivityHasDependents(e,t,r),getActivitiesHaveDependents:(e,t,r)=>i.getActivitiesHaveDependents(e,t,r),getActivityObeWeight:(e,t,r,s,o)=>i.getActivityObeWeight(e,t,r,s,o),checkUserIsCoreTeamLeader:e=>i.isCoreTeamLeader(e),getActivityUploadsLicenseInfo:(e,t,r)=>i.getActivityUploadsLicenseInfo(e,t,r),getNotLoadedModuleId(e){var i=[];return e.forEach((e=>{H[e]||i.push(e)})),i},setLoadedModuleId(e){e.forEach((e=>H[e]=!0))},setDefaultPublishInfoForScope(e){e.publish_type=B,e.publishStatusClass="publish-type-button unpublished",e.publishTypeText=v.t("activityPublishSetting.unpublished"),e.isPublishScheduled=!1},setPublishInfoForActivity(e){e&&(e.publishStatusClass=e.is_in_progress?"publish-type-button published":"publish-type-button unpublished",e.publishTypeText=function(e){return e.publish_type?v.t("activityPublishSetting.".concat(e.publish_type)):e.is_in_progress?v.t("activityPublishSetting.published"):v.t("activityPublishSetting.unpublished")}(e),e.isPublishScheduled=e.publish_type===U,e.publishScheduledDuration=function(e){var i="YYYY-MM-DD HH:mm:ss",t=o(e.start_time).format(i),r=e.end_time?o(e.end_time).format(i):v.t("alwaysAvaliable");return"".concat(v.t("activityPublishSetting.scheduledPublishTime"),": ").concat(t," ～ ").concat(r)}(e))},initPublishInfoForActivities(e){e.forEach((e=>{this.setPublishInfoForActivity(e)}))},initPublishInfo(e,i){(!(arguments.length>2&&void 0!==arguments[2])||arguments[2])&&this.setDefaultPublishInfoForScope(e),this.setPublishInfoForActivity(i)},logScormActivitiesRead:(e,t)=>i.logScormActivitiesRead(e,t,r.noop)};return Y}]}}]);