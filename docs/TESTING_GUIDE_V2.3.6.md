# 測試指南 - v2.3.6 版本驗證

**日期**: 2025-12-18
**版本**: v2.3.6
**測試目標**: 驗證 APIScanner 遷移和 HTTP 狀態碼統一化

---

## 📋 測試概述

本次版本更新了以下內容，需要進行功能驗證：
1. ✅ APIScanner 服務類 - 統一 API 掃描邏輯
2. ✅ HTTP 狀態碼統一化 - 支持所有 2xx 狀態碼
3. ✅ PEP 8 工具配置 - 代碼風格標準化

---

## 🎯 測試範圍

### 受影響的功能

#### 1. Option i - 智能推薦 (Hybrid Scan)
- **修改**: 使用 APIScanner 替換手動 API 掃描
- **影響**: API 課程列表獲取、課程 ID 匹配

#### 2. Hybrid Scan - MitmProxy 版本
- **修改**: 使用 APIScanner 替換手動 API 掃描
- **影響**: 批量掃描、時長發送

#### 3. Hybrid Scan - 批量模式
- **修改**: 使用 APIScanner 替換手動 API 掃描
- **影響**: 多課程處理、選單顯示

#### 4. 所有 API 調用
- **修改**: HTTP 狀態碼檢查使用 is_http_success()
- **影響**: HTTP 204 (No Content) 不再被誤判為失敗

---

## ✅ 功能測試清單

### Phase 1: 基礎 API 測試

#### 測試 1.1: APIScanner 初始化
```python
# 測試目標: 確認 APIScanner 可以正確初始化

# 步驟:
1. 啟動應用程式
2. 選擇任意需要 API 掃描的功能
3. 觀察是否有導入錯誤

# 預期結果:
- ✓ 沒有 ImportError
- ✓ 沒有 AttributeError
- ✓ APIScanner 正確創建
```

#### 測試 1.2: Session Cookie 提取
```python
# 測試目標: 確認可以從 WebDriver 提取 Session Cookie

# 步驟:
1. 啟動應用程式並登入
2. 選擇 Option i (智能推薦)
3. 觀察 "提取 Session Cookie" 階段

# 預期結果:
- ✓ 成功找到 Session Cookie
- ✓ 顯示 Cookie 名稱 (例如: V2-xxx)
- ✓ 沒有錯誤訊息
```

#### 測試 1.3: /api/my-courses 調用
```python
# 測試目標: 確認可以成功調用 /api/my-courses

# 步驟:
1. 繼續測試 1.2
2. 觀察 "調用 /api/my-courses API" 階段

# 預期結果:
- ✓ API 調用成功
- ✓ 顯示課程數量 (例如: "✓ 獲取成功，共 7 門課程")
- ✓ 課程列表不為空
```

#### 測試 1.4: 課程 ID 匹配
```python
# 測試目標: 確認 API 課程 ID 可以正確匹配 Web 課程名稱

# 步驟:
1. 繼續測試 1.3
2. 觀察 Web 掃描階段
3. 檢查每個課程是否成功匹配 API 課程 ID

# 預期結果:
- ✓ 每個課程顯示 "✓ 匹配到 API 課程 ID: XXX"
- ✓ 匹配的 ID 不為 None
- ✓ 沒有匹配失敗的課程
```

---

### Phase 2: Option i - 智能推薦測試

#### 測試 2.1: 完整流程測試
```
測試步驟:
1. 啟動應用程式
2. 輸入帳號密碼登入
3. 選擇 Option i (智能推薦)
4. 等待掃描完成
5. 選擇一個課程執行

預期結果:
階段 1/6 - 登入
- ✓ 成功載入登入頁面
- ✓ 成功輸入帳號密碼
- ✓ 成功通過驗證碼
- ✓ 登入成功

階段 2/6 - API 掃描
- ✓ 提取 Session Cookie 成功
- ✓ 提取用戶資訊成功
- ✓ 調用 /api/my-courses 成功
- ✓ 顯示課程數量

階段 3/6 - Web 掃描
- ✓ 進入「我的課程」
- ✓ 獲取主課程列表
- ✓ 每個課程成功匹配 API ID
- ✓ 提取第一個子課程/測驗

階段 4/6 - 準備執行
- ✓ API 初始化成功

階段 5/6 - 課程選單
- ✓ 顯示可執行項目
- ✓ 選項編號正確
- ✓ 通過條件顯示正確

階段 6/6 - 執行
- ✓ 訪問課程頁面成功
- ✓ 提取已閱讀時數成功
- ✓ 計算需要時數正確
- ✓ 發送時長成功
- ✓ 驗證時數增加
```

#### 測試 2.2: 錯誤處理測試
```
測試場景 A: 網路中斷
1. 在 API 掃描階段中斷網路
預期: 顯示 "✗ API 掃描失敗: xxx" 並優雅退出

測試場景 B: Session 過期
1. 使用過期的 Session Cookie
預期: 顯示 "✗ API 錯誤 (狀態碼: 401): xxx"

測試場景 C: 課程不存在
1. 選擇不存在的課程
預期: 顯示適當的錯誤訊息
```

---

### Phase 3: Hybrid Scan - MitmProxy 版本測試

#### 測試 3.1: 基本流程
```
測試步驟:
1. 啟動應用程式
2. 選擇 Hybrid Scan
3. 選擇 [1] 標準模式
4. 等待掃描和執行完成

預期結果:
- ✓ API 掃描成功（使用 APIScanner）
- ✓ Web 掃描成功
- ✓ MitmProxy 攔截成功
- ✓ 時長發送成功
- ✓ 結果儲存成功
```

---

### Phase 4: Hybrid Scan - 批量模式測試

#### 測試 4.1: 批量掃描
```
測試步驟:
1. 啟動應用程式
2. 選擇 Hybrid Scan
3. 選擇 [2] 批量模式
4. 輸入 'a' 執行所有課程

預期結果:
階段 1/6 - 登入
- ✓ 登入成功

階段 2/6 - API 掃描
- ✓ 使用 APIScanner 掃描成功
- ✓ 課程列表獲取成功

階段 3/6 - Web 掃描
- ✓ 每個課程成功匹配 API ID
- ✓ 提取子課程成功

階段 4/6 - 準備執行
- ✓ API 初始化成功

階段 5/6 - 課程選單
- ✓ 顯示所有課程
- ✓ 可執行項目顯示正確

階段 6/6 - 批量執行
- ✓ 依序處理每個課程
- ✓ 每個課程時長發送成功
- ✓ 結果記錄正確
```

---

### Phase 5: HTTP 狀態碼測試

#### 測試 5.1: HTTP 200 (OK)
```
測試目標: 確認 HTTP 200 仍然被正確處理

測試方法:
1. 執行任意 API 調用功能
2. 觀察返回 HTTP 200 的 API 調用

預期結果:
- ✓ API 調用成功
- ✓ 數據正確解析
- ✓ 沒有錯誤訊息
```

#### 測試 5.2: HTTP 204 (No Content)
```
測試目標: 確認 HTTP 204 不再被誤判為失敗

測試方法:
1. 執行時長發送功能
2. 觀察返回 HTTP 204 的 API 調用

預期結果:
- ✓ API 調用被視為成功
- ✓ 沒有 "API 請求失敗" 錯誤
- ✓ 程式繼續正常執行
```

#### 測試 5.3: HTTP 401 (Unauthorized)
```
測試目標: 確認錯誤狀態碼仍然被正確處理

測試方法:
1. 使用過期的 Session 調用 API

預期結果:
- ✓ 顯示 "認證失敗" 錯誤
- ✓ 提示重新登入
- ✓ 不會繼續執行
```

---

### Phase 6: 回歸測試

#### 測試 6.1: 舊功能驗證
```
確認以下功能仍然正常運作:

- [ ] 登入功能
- [ ] 驗證碼處理
- [ ] 課程列表顯示
- [ ] 子課程點擊
- [ ] 時長計算
- [ ] MitmProxy 攔截
- [ ] 結果儲存
- [ ] 錯誤處理
```

---

## 🐛 已知問題檢查

### 批量模式已修復的 Bug

確認以下問題已修復：

#### Bug 1: AttributeError - get_program_info()
```
測試: 執行批量模式
確認: 不再出現 "object has no attribute 'get_program_info'" 錯誤
```

#### Bug 2: 子課程點擊方法錯誤
```
測試: 執行批量模式
確認: 不再出現 "object has no attribute 'click_subcourse_by_name'" 錯誤
```

#### Bug 3: 通過條件提取時機錯誤
```
測試: 執行批量模式
確認: 成功提取通過條件，不再出現 "無法找到 module ID" 錯誤
```

#### Bug 4: HTTP 204 誤判
```
測試: 發送時長
確認: HTTP 204 不再被視為失敗
```

---

## 📊 測試記錄表

### 測試環境
```
作業系統: Windows / Linux / macOS
Python 版本: ___________
測試日期: ___________
測試人員: ___________
```

### 測試結果

| 測試項目 | 狀態 | 備註 |
|---------|------|------|
| APIScanner 初始化 | ⬜ 通過 / ⬜ 失敗 | |
| Session Cookie 提取 | ⬜ 通過 / ⬜ 失敗 | |
| /api/my-courses 調用 | ⬜ 通過 / ⬜ 失敗 | |
| 課程 ID 匹配 | ⬜ 通過 / ⬜ 失敗 | |
| Option i 完整流程 | ⬜ 通過 / ⬜ 失敗 | |
| Hybrid Scan (標準) | ⬜ 通過 / ⬜ 失敗 | |
| Hybrid Scan (批量) | ⬜ 通過 / ⬜ 失敗 | |
| HTTP 200 處理 | ⬜ 通過 / ⬜ 失敗 | |
| HTTP 204 處理 | ⬜ 通過 / ⬜ 失敗 | |
| HTTP 401 處理 | ⬜ 通過 / ⬜ 失敗 | |

### 發現的問題

```
問題 1:
描述: ___________________________________________
重現步驟: ___________________________________________
預期結果: ___________________________________________
實際結果: ___________________________________________
嚴重程度: ⬜ 嚴重 / ⬜ 中等 / ⬜ 輕微

問題 2:
描述: ___________________________________________
重現步驟: ___________________________________________
預期結果: ___________________________________________
實際結果: ___________________________________________
嚴重程度: ⬜ 嚴重 / ⬜ 中等 / ⬜ 輕微
```

---

## 🔍 調試技巧

### 啟用詳細日誌

如果遇到問題，可以啟用詳細日誌：

```python
# 在 menu.py 頂部添加
import logging
logging.basicConfig(level=logging.DEBUG)
```

### 檢查 API 響應

```python
# 在 APIScanner.scan_my_courses() 中添加
print(f"API Response: {response.status_code}")
print(f"API Data: {response.text[:200]}")
```

### 檢查錯誤詳情

```python
# 捕獲異常時打印完整堆疊
import traceback
traceback.print_exc()
```

---

## 📞 問題回報

如果發現問題，請記錄以下信息：

1. **環境信息**
   - Python 版本
   - 作業系統
   - 相關套件版本

2. **重現步驟**
   - 詳細的操作步驟
   - 使用的選項和輸入

3. **錯誤訊息**
   - 完整的錯誤堆疊
   - 相關的日誌輸出

4. **預期 vs 實際**
   - 預期發生什麼
   - 實際發生了什麼

---

## ✅ 測試完成檢查清單

測試完成後，確認以下項目：

- [ ] 所有核心功能測試通過
- [ ] 沒有發現嚴重問題
- [ ] 已知 Bug 已修復
- [ ] HTTP 狀態碼處理正確
- [ ] APIScanner 運作正常
- [ ] 錯誤處理適當
- [ ] 性能沒有明顯下降
- [ ] 代碼格式符合 PEP 8（如已執行格式化）

---

**測試版本**: v2.3.6
**創建日期**: 2025-12-18
**最後更新**: 2025-12-18
