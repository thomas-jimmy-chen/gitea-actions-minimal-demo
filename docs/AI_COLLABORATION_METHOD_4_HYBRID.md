```
        ▐▛███▜▌
       ▝▜█████▛▘
         ▘▘ ▝▝
    Powered by Claude
```

# AI 協作工作流程方法 4：混合漸進式開發

**方法名稱**: Hybrid Gradual Development (HGD)
**適用情境**: 部分需求已明確，部分仍在探索
**文檔版本**: 1.0
**建立日期**: 2025-12-31

---

## 1. 方法概述

實務上，專案很少是「全部明確」或「全部不明確」。更常見的情況是：

- **某些模組**需求已經穩定 → 可以用規格驅動
- **某些模組**還在摸索中 → 繼續用迭代式

本方法允許**同一專案內，不同模組採用不同開發方式**，並隨時間漸進轉換。

---

## 2. 核心概念

```
┌─────────────────────────────────────────────────────────────────────┐
│                      混合漸進式開發概念圖                             │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  專案                                                               │
│  ┌─────────────────────────────────────────────────────────────┐    │
│  │                                                             │    │
│  │   ┌───────────────┐   ┌───────────────┐   ┌─────────────┐   │    │
│  │   │   模組 A      │   │   模組 B      │   │   模組 C    │   │    │
│  │   │   ─────────   │   │   ─────────   │   │   ───────   │   │    │
│  │   │   📋 規格驅動  │   │   🔄 迭代式   │   │   🔄 迭代式 │   │    │
│  │   │   (已穩定)    │   │   (探索中)    │   │   (新功能)  │   │    │
│  │   └───────────────┘   └───────────────┘   └─────────────┘   │    │
│  │                                                             │    │
│  │   ┌───────────────┐   ┌───────────────┐                     │    │
│  │   │   模組 D      │   │   模組 E      │                     │    │
│  │   │   ─────────   │   │   ─────────   │                     │    │
│  │   │   📋 規格驅動  │   │   🔄→📋 轉換中│                     │    │
│  │   │   (已穩定)    │   │   (漸進轉換)  │                     │    │
│  │   └───────────────┘   └───────────────┘                     │    │
│  │                                                             │    │
│  └─────────────────────────────────────────────────────────────┘    │
│                                                                     │
│  特點：                                                             │
│  • 每個模組可以有自己的開發節奏                                       │
│  • 穩定的先轉換，不穩定的繼續迭代                                     │
│  • 隨時間推移，越來越多模組轉為規格驅動                               │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 3. 模組狀態分類

### 3.1 狀態定義

| 狀態 | 符號 | 說明 | 開發方式 |
|------|------|------|----------|
| 探索中 | 🔄 | 需求不明確，持續變動 | 迭代式 |
| 轉換中 | 🔄→📋 | 需求漸趨穩定，開始正式化 | 混合 |
| 已穩定 | 📋 | 需求明確，有正式規格 | 規格驅動 |
| 凍結 | 🔒 | 不再變動，僅維護 | 規格驅動 |

### 3.2 狀態轉換條件

```
                    需求穩定
        🔄 探索中 ─────────────► 🔄→📋 轉換中
                                      │
                                      │ 規格完成
                                      ▼
                                 📋 已穩定
                                      │
                                      │ 功能完整
                                      ▼
                                 🔒 凍結
```

**轉換條件檢查**:

| 從 | 到 | 條件 |
|----|-----|------|
| 🔄 | 🔄→📋 | 連續 2+ 次迭代無大改動 |
| 🔄→📋 | 📋 | 規格文檔已完成並驗證 |
| 📋 | 🔒 | 功能完整且無計劃變更 |

---

## 4. 工作流程

### 4.1 每週/每次開發前的盤點

```markdown
## 模組狀態盤點 - [日期]

| 模組 | 狀態 | 本次計劃 | 備註 |
|------|------|----------|------|
| 認證模組 | 📋 已穩定 | 依規格修 Bug | - |
| 報表模組 | 🔄 探索中 | 新增圖表功能 | 用戶還在確認需求 |
| 通知模組 | 🔄→📋 轉換中 | 撰寫 API 規格 | 核心功能已穩定 |
| 資料匯出 | 🔄 探索中 | 先做 CSV 看看 | 不確定要支援哪些格式 |
```

### 4.2 針對不同狀態的開發方式

#### 🔄 探索中模組

```
你：報表模組我想加圖表，但不確定要什麼類型

AI：好，我們用迭代方式來探索：

    第一版先做最簡單的：
    - 長條圖（顯示數量比較）

    你看到效果後告訴我：
    A) 這樣夠了
    B) 還需要折線圖
    C) 其他類型

    [實作簡單版本]
```

#### 🔄→📋 轉換中模組

```
你：通知模組差不多定型了，開始寫規格吧

AI：好的，根據目前實作，我整理出：

    ## 通知模組規格 (草稿)

    ### 功能需求
    - FR-N01: 系統可發送 Email 通知
    - FR-N02: 系統可發送站內通知
    - FR-N03: 用戶可設定通知偏好

    ### API 端點
    - POST /api/notifications/send
    - GET /api/notifications/list
    - PUT /api/notifications/preferences

    這些正確嗎？有遺漏嗎？

    確認後我會產出完整的 OpenAPI 規格。
```

#### 📋 已穩定模組

```
你：認證模組有個 Bug，登入後沒有正確設 Cookie

AI：讓我檢查規格：

    根據 docs/specs/auth.yaml：
    - POST /auth/login 應該回傳 Set-Cookie header
    - Cookie 名稱: session_token
    - 有效期: 24 小時

    我來檢查實作是否符合規格...

    [依規格修復 Bug]
```

---

## 5. 模組狀態追蹤表

建議在專案中維護一個狀態追蹤文件：

```markdown
# 模組開發狀態追蹤

**專案**: [專案名稱]
**最後更新**: [日期]

## 狀態總覽

| 狀態 | 數量 | 佔比 |
|------|------|------|
| 🔄 探索中 | 3 | 30% |
| 🔄→📋 轉換中 | 2 | 20% |
| 📋 已穩定 | 4 | 40% |
| 🔒 凍結 | 1 | 10% |

## 詳細清單

### 🔄 探索中 (3)

| 模組 | 負責人 | 預計轉換時間 | 備註 |
|------|--------|-------------|------|
| 報表模組 | - | 未定 | 用戶需求持續變動 |
| 資料匯出 | - | 2 週後 | 待確認格式 |
| 儀表板 | - | 未定 | 新功能 |

### 🔄→📋 轉換中 (2)

| 模組 | 負責人 | 規格完成度 | 預計完成 |
|------|--------|-----------|----------|
| 通知模組 | - | 60% | 本週 |
| 搜尋功能 | - | 30% | 下週 |

### 📋 已穩定 (4)

| 模組 | 規格文檔 | 測試覆蓋 |
|------|----------|----------|
| 認證模組 | docs/specs/auth.yaml | 85% |
| 用戶管理 | docs/specs/users.yaml | 78% |
| 權限控制 | docs/specs/permissions.yaml | 82% |
| 日誌系統 | docs/specs/logging.yaml | 90% |

### 🔒 凍結 (1)

| 模組 | 凍結日期 | 原因 |
|------|----------|------|
| 舊版 API | 2025-01-15 | 已棄用，僅維護 |
```

---

## 6. 優點與挑戰

### 6.1 優點

| 優點 | 說明 |
|------|------|
| **靈活性高** | 不用等全部確定才開始正式化 |
| **風險分散** | 穩定的先固定，不穩定的繼續探索 |
| **漸進改善** | 專案品質隨時間自然提升 |
| **實務貼近** | 符合真實專案的混亂本質 |

### 6.2 挑戰

| 挑戰 | 解決方案 |
|------|----------|
| **狀態追蹤複雜** | 維護狀態追蹤文件 |
| **模組間依賴** | 先穩定被依賴的模組 |
| **團隊認知不一** | 明確標示每個模組的狀態 |
| **規格與代碼不同步** | 轉換完成前不要過度規格化 |

---

## 7. 與 AI 協作的對話範本

### 開始時盤點

```
你：我們來看一下目前各模組的狀態

AI：好的，讓我幫你盤點：

    根據目前的實作和討論歷史：

    📋 已穩定（可用規格驅動）:
    - 認證模組 - 3 週沒改動
    - 用戶管理 - 功能完整

    🔄 探索中（繼續迭代）:
    - 報表模組 - 上週還在改需求
    - 資料匯出 - 新功能，還沒確定

    🔄→📋 建議開始轉換:
    - 通知模組 - 核心穩定，細節可以邊做邊補規格

    這樣分類正確嗎？
```

### 決定單一模組開發方式

```
你：通知模組要怎麼處理？

AI：通知模組目前是「轉換中」狀態，建議：

    已確定的部分（用規格驅動）:
    ✓ Email 發送 - 需求明確
    ✓ 站內通知 - 需求明確

    還在探索的部分（繼續迭代）:
    ? 推播通知 - 不確定要不要做
    ? 通知模板 - 用戶還沒給範例

    建議做法：
    1. 先為 Email 和站內通知寫規格
    2. 推播和模板繼續用迭代方式探索

    要開始寫規格嗎？
```

### 部分規格化

```
你：好，先寫 Email 和站內通知的規格

AI：[產出部分規格]

    ## 通知模組規格 (部分)

    ### 已規格化
    - FR-N01: Email 通知 ✅
    - FR-N02: 站內通知 ✅

    ### 待規格化 (仍在探索)
    - 推播通知 🔄
    - 通知模板 🔄

    已規格化的部分，後續開發會依規格進行。
    未規格化的部分，我們繼續用迭代方式。
```

---

## 8. 實際案例

### 案例：EEBot 專案

```
EEBot 專案模組狀態

📋 已穩定:
├── 登入模組 (login_page.py)
├── Cookie 管理 (cookie_manager.py)
└── 配置載入 (config_loader.py)

🔄→📋 轉換中:
├── API 掃描器 (api_scanner.py) - 核心穩定，細節待補
└── 時長發送 (visit_duration_api.py) - 規格撰寫中

🔄 探索中:
├── 考試自動答題 - 策略還在調整
├── 批量模式 - 用戶反饋後持續改進
└── CAPTCHA OCR - 新功能，準確率待驗證

開發策略:
- 登入相關：有 Bug 時依規格修復
- API 掃描：邊寫規格邊重構
- 考試答題：繼續迭代，收集更多題型
```

---

## 9. 規格邊界統一 (Specification Boundary Unification)

當專案發展到一定程度，可能需要**統一各模組的規格標準**。這是完全可行的，而且是自然的演進過程。

### 9.1 何時需要統一規格邊界？

| 觸發條件 | 說明 |
|----------|------|
| 模組間介面不一致 | 不同模組的 API 風格、錯誤碼、回傳格式不同 |
| 團隊擴大 | 新成員需要一致的規範來快速上手 |
| 整合困難 | 模組間串接時發現規格衝突 |
| 品質要求提升 | 需要統一的測試標準、文檔格式 |
| 外部合規 | 需要符合某些標準（如 OpenAPI 3.0） |

### 9.2 統一範圍選擇

```
┌─────────────────────────────────────────────────────────────────────┐
│                    規格統一範圍選項                                   │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  Level 1: 介面層統一 (最小範圍)                                      │
│  ─────────────────────────────                                      │
│  • API 回傳格式統一 (如: { success, data, error })                  │
│  • 錯誤碼規範統一 (如: E001, E002...)                               │
│  • HTTP 狀態碼使用規範                                              │
│                                                                     │
│  Level 2: 規格文檔統一 (中等範圍)                                    │
│  ─────────────────────────────                                      │
│  • 所有 📋 模組使用相同的規格模板                                    │
│  • 統一的邊界值定義格式                                              │
│  • 統一的測試案例格式                                                │
│                                                                     │
│  Level 3: 架構層統一 (最大範圍)                                      │
│  ─────────────────────────────                                      │
│  • 統一的模組結構                                                    │
│  • 統一的依賴注入方式                                                │
│  • 統一的錯誤處理機制                                                │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

### 9.3 統一流程

```
步驟 1: 盤點現有規格
────────────────────
• 列出所有 📋 已穩定模組的規格
• 識別差異點

步驟 2: 定義統一標準
────────────────────
• 選擇最佳實踐作為基準
• 或設計新的統一標準
• 與團隊/用戶確認

步驟 3: 漸進式對齊
────────────────────
• 不需要一次改完
• 優先處理高頻使用的模組
• 新模組直接採用新標準

步驟 4: 驗證與文檔
────────────────────
• 確認各模組符合統一標準
• 更新規格文檔
• 建立規格檢查機制
```

### 9.4 與 AI 協作的對話範本

```
你：我想統一各模組的 API 回傳格式

AI：好的，讓我先盤點現有格式：

    模組 A (認證):
    { "token": "xxx", "expires": 3600 }

    模組 B (用戶):
    { "status": "ok", "user": {...} }

    模組 C (通知):
    { "success": true, "data": [...] }

    建議統一格式：
    {
      "success": boolean,
      "data": any,
      "error": { "code": string, "message": string } | null
    }

    要我逐一修改各模組嗎？
    還是先從新模組開始採用？

你：先從認證模組開始改

AI：好的，我來修改認證模組：

    修改前:
    { "token": "xxx", "expires": 3600 }

    修改後:
    {
      "success": true,
      "data": { "token": "xxx", "expires": 3600 },
      "error": null
    }

    [更新代碼]
    [更新規格文檔]

    認證模組已對齊統一格式。
    下一個處理哪個模組？
```

### 9.5 注意事項

| 注意事項 | 說明 |
|----------|------|
| **向後相容** | 若有外部使用者，考慮版本號或過渡期 |
| **漸進式改動** | 不要一次改太多，容易出錯 |
| **測試覆蓋** | 統一後要驗證功能正常 |
| **文檔同步** | 規格文檔要同步更新 |
| **🔄 模組暫緩** | 仍在探索中的模組可以先不統一 |

---

## 10. 小結

```
┌─────────────────────────────────────────────────────────────────┐
│                                                                 │
│   「不是全部轉換，而是該轉的先轉，不該轉的繼續探索」              │
│                                                                 │
│                                                                 │
│        🔄 探索中                                                │
│           │                                                     │
│           │ 局部穩定                                            │
│           ▼                                                     │
│        🔄→📋 轉換中 ←── 同一模組可以部分規格化                   │
│           │                                                     │
│           │ 規格完成                                            │
│           ▼                                                     │
│        📋 已穩定                                                │
│                                                                 │
│                                                                 │
│   核心原則：                                                     │
│   • 穩定的部分 → 規格驅動（可預測、可維護）                       │
│   • 不穩定的部分 → 迭代探索（保持靈活）                          │
│   • 隨時間推移 → 越來越多部分轉為規格驅動                        │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

這個方法的核心精神：**務實**。

不強求一步到位，而是讓專案自然演進到更結構化的狀態。

---

## 11. 相關文檔

- [方法 1：結構化規格驅動開發](./AI_COLLABORATION_METHOD_1_STRUCTURED.md)
- [方法 2：迭代式探索開發](./AI_COLLABORATION_METHOD_2_ITERATIVE.md)
- [方法 3：迭代到結構化過渡](./AI_COLLABORATION_METHOD_3_TRANSITION.md)

---

**文檔建立者**: Claude Code (Opus 4.5)
**方法論基礎**: Pragmatic Development + Modular Transition + Continuous Improvement
