# EEBot - Claude Code CLI äº¤æ¥æ–‡æª” (ç¬¬ 2A æ®µ)

> **åˆ†æ®µè³‡è¨Š**: æœ¬æ–‡æª”å…± 3 æ®µ
> - ğŸ“„ **ç•¶å‰**: ç¬¬ 2A æ®µ - Windows ä¿®å¾©ã€API é©—è­‰ã€è‡ªå‹•ç­”é¡Œã€æ™ºèƒ½æ¨¡å¼
> - â¡ï¸ **ä¸‹ä¸€æ®µ**: [CLAUDE_CODE_HANDOVER-2B.md](./CLAUDE_CODE_HANDOVER-2B.md) - GUI é–‹ç™¼ã€å¹³å°é·ç§»ã€Burp Suite åˆ†æ
> - â¬…ï¸ **ä¸Šä¸€æ®µ**: [CLAUDE_CODE_HANDOVER-1.md](./CLAUDE_CODE_HANDOVER-1.md) - åŸºç¤æ¶æ§‹èˆ‡ä½¿ç”¨æŒ‡å—
> - ğŸ“‘ **å®Œæ•´ç´¢å¼•**: [è¿”å›ç´¢å¼•](./CLAUDE_CODE_HANDOVER.md)

---

## ğŸ“– æœ¬æ®µå…§å®¹

- [âœ… å·²å®Œæˆï¼šWindows å…¼å®¹æ€§ä¿®å¾©](#å·²å®Œæˆwindows-å…¼å®¹æ€§ä¿®å¾©-2025-12-06-v208) ğŸ‰ **LATEST**
- [âœ… å·²é©—è­‰ï¼šèª²ç¨‹é€šéæ¢ä»¶æå–æ–¹æ¡ˆ](#å·²é©—è­‰èª²ç¨‹é€šéæ¢ä»¶æå–æ–¹æ¡ˆ-2025-12-05-å¯¦é©—å®Œæˆ)
- [âœ… å·²é©—è­‰ï¼šAPI èª²ç¨‹æƒææ¨¡å¼](#å·²é©—è­‰api-èª²ç¨‹æƒææ¨¡å¼-2025-12-05-å¯¦é©—å®Œæˆ)
- [ğŸš€ è¨ˆç•«åŠŸèƒ½ï¼šAPI ç›´æ¥èª¿ç”¨æ¨¡å¼](#è¨ˆç•«åŠŸèƒ½api-ç›´æ¥èª¿ç”¨æ¨¡å¼-2025-12-04-ææ¡ˆ)
- [å·²å®ŒæˆåŠŸèƒ½ï¼šè‡ªå‹•ç­”é¡Œç³»çµ±](#å·²å®ŒæˆåŠŸèƒ½è‡ªå‹•ç­”é¡Œç³»çµ±-phase-2)
- [æ™ºèƒ½æ¨¡å¼ï¼šæŒ‰èª²ç¨‹å•Ÿç”¨è‡ªå‹•ç­”é¡Œ](#æ™ºèƒ½æ¨¡å¼æŒ‰èª²ç¨‹å•Ÿç”¨è‡ªå‹•ç­”é¡Œ-2025-11-15-æ›´æ–°)

---

## âœ… å·²å®Œæˆï¼šWindows å…¼å®¹æ€§ä¿®å¾© (2025-12-06 v2.0.8)

> **ç‹€æ…‹**: âœ… **å®Œæˆ - æ‰€æœ‰ Windows å•é¡Œå·²è§£æ±º**
> **ç‰ˆæœ¬**: 2.0.8
> **å®Œæˆæ—¥æœŸ**: 2025-12-06
> **æ¸¬è©¦ç’°å¢ƒ**: Windows 10/11 + Python 3.13.5

### æ¦‚è¿°

**ç›®æ¨™**: è§£æ±º EEBot åœ¨ Windows ç’°å¢ƒä¸‹çš„æ‰€æœ‰å…¼å®¹æ€§å•é¡Œ

**ä¿®å¾©çµæœ**:
- âœ… **Stealth.min.js æˆåŠŸä¸‹è¼‰**
- âœ… **MitmProxy æ­£å¸¸å•Ÿå‹•ä¸¦ç›£è½ç«¯å£**
- âœ… **éœé»˜æ¨¡å¼å®Œç¾é‹ä½œ**ï¼ˆç„¡ HTTP è«‹æ±‚æ—¥èªŒï¼‰
- âœ… **Chrome æ—¥èªŒå·²æŠ‘åˆ¶**

---

### ä¿®å¾©çš„å•é¡Œ

#### å•é¡Œ 1: Stealth.min.js ä¸‹è¼‰å¤±æ•—

**ç¾è±¡**:
```
[ERROR] Failed to extract stealth mode file: [WinError 2] ç³»çµ±æ‰¾ä¸åˆ°æŒ‡å®šçš„æª”æ¡ˆã€‚
```

**æ ¹æœ¬åŸå› **:
- Windows ä¸‹ `subprocess.run(['npx', ...])` ç„¡æ³•æ‰¾åˆ° `npx.cmd`

**è§£æ±ºæ–¹æ¡ˆ**:
```python
# src/core/driver_manager.py (110-120)
# src/utils/stealth_extractor.py (40-52)

import platform

use_shell = platform.system() == 'Windows'

subprocess.run(
    ['npx', 'extract-stealth-evasions'],
    shell=use_shell,  # Windows ä¸‹ä½¿ç”¨ shell
    timeout=60
)
```

**é—œéµ**: Windows éœ€è¦ `shell=True` ä¾†åŸ·è¡Œ .cmd æ–‡ä»¶

---

#### å•é¡Œ 2: MitmProxy ç„¡æ³•å•Ÿå‹•ï¼ˆé‡å¤§æ¶æ§‹è®Šæ›´ï¼‰

**ç¾è±¡**:
```
net::ERR_PROXY_CONNECTION_FAILED
[WARN] Network monitoring may not be ready (port not listening)
```

**æ ¹æœ¬åŸå› **:
- Windows + Python 3.13 ç’°å¢ƒä¸‹
- `multiprocessing.Process` + `asyncio` äº‹ä»¶å¾ªç’°ç„¡æ³•æ­£ç¢ºå•Ÿå‹•
- Windows ä½¿ç”¨ spawn æ¨¡å¼ï¼Œasyncio å¾ªç’°ç„¡æ³•å‚³é

**è§£æ±ºæ–¹æ¡ˆ**: multiprocessing â†’ threading

```python
# src/core/proxy_manager.py

# v2.0.1 (åŸç‰ˆ - Windows ä¸‹å¤±æ•—)
from multiprocessing import Process
self.process = Process(target=self._run)

# v2.0.8 (æ–°ç‰ˆ - Windows å…¼å®¹)
import threading
self.thread = threading.Thread(target=self._run, daemon=True)
```

**é¡å¤–æ”¹é€²**:
- æ·»åŠ ç«¯å£å¥åº·æª¢æŸ¥ `_check_port_listening()`
- å¢åŠ åˆå§‹ç­‰å¾…æ™‚é–“ï¼ˆ1s â†’ 3sï¼‰
- ä¿ç•™åŸå§‹ä»£ç¢¼ç‚ºè©³ç´°è¨»è§£
- å‰µå»ºå‚™ä»½: `proxy_manager.py.multiprocessing.bak`

---

#### å•é¡Œ 3: éœé»˜æ¨¡å¼ç„¡æ•ˆï¼ˆå¤šæ¬¡è¿­ä»£ï¼‰

**ç¾è±¡**:
```
127.0.0.1:xxx: GET https://elearn.post.gov.tw/...
127.0.0.1:xxx: POST https://accounts.google.com/...
[å¤§é‡ HTTP è«‹æ±‚æ—¥èªŒ...]
```

**è¿­ä»£éç¨‹**:

| ç‰ˆæœ¬ | æ–¹æ³• | çµæœ | å¤±æ•—åŸå›  |
|------|------|------|---------|
| v2.0.2 | Python Logging | âŒ | DumpMaster ç›´æ¥å¯« stdout |
| v2.0.3 | MitmOptions åƒæ•¸ | âŒ | KeyErrorï¼ˆç‰ˆæœ¬ä¸æ”¯æ´ï¼‰ |
| v2.0.4 | ä½¿ç”¨ Master é¡ | âŒ | ç„¡ ProxyServer addon |
| v2.0.5 | ç·šç¨‹é‡å®šå‘ stdout | âŒ | sys.stdout æ˜¯å…¨å±€çš„ |
| v2.0.6 | ç§»é™¤è¼¸å‡º addons | âœ… | **æˆåŠŸï¼** |

**æˆåŠŸæ–¹æ¡ˆ**: ç§»é™¤ DumpMaster çš„ TermLog å’Œ Dumper addons

```python
# src/core/proxy_manager.py (_config æ–¹æ³•)

master = DumpMaster(opts)

if self.silent:
    # ç§»é™¤ TermLog addonï¼ˆçµ‚ç«¯æ—¥èªŒï¼‰
    for addon in master.addons.chain:
        if type(addon).__name__ == 'TermLog':
            master.addons.remove(addon)
            break

    # ç§»é™¤ Dumper addonï¼ˆæµé‡è½‰å„²ï¼‰
    for addon in master.addons.chain:
        if type(addon).__name__ == 'Dumper':
            master.addons.remove(addon)
            break
```

**é—œéµç™¼ç¾**:
- DumpMaster æœ‰ 36 å€‹ addons
- TermLog (ç¬¬ 1 å€‹) å’Œ Dumper (ç¬¬ 33 å€‹) è² è²¬è¼¸å‡º
- Proxyserver (ç¬¬ 17 å€‹) æ˜¯å¿…è¦çš„ï¼ˆç›£è½ç«¯å£ï¼‰
- ç§»é™¤è¼¸å‡º addons ä¸å½±éŸ¿åŠŸèƒ½

---

#### å•é¡Œ 4: Chrome DevTools è¨Šæ¯

**æ–°å¢åŠŸèƒ½**: Chrome éœé»˜æ¨¡å¼

```python
# src/core/driver_manager.py (80-88)

if silent_mode:
    opts.add_argument('--log-level=3')     # åªé¡¯ç¤º FATAL éŒ¯èª¤
    opts.add_argument('--disable-logging')  # ç¦ç”¨æ—¥èªŒ
    opts.add_experimental_option('excludeSwitches',
        ['enable-automation', 'enable-logging'])
```

**æŠ‘åˆ¶çš„è¨Šæ¯**:
- `DevTools listening on ws://...`
- Chrome å…§éƒ¨éŒ¯èª¤è¨Šæ¯
- TensorFlow è¨Šæ¯

---

### ä¿®æ”¹ç¸½çµ

**ä¿®æ”¹çš„æª”æ¡ˆ** (3):
| æª”æ¡ˆ | è®Šæ›´ | è¡Œæ•¸ |
|------|------|------|
| `src/core/proxy_manager.py` | é‡å¤§é‡æ§‹ | threading + addons |
| `src/core/driver_manager.py` | Bug ä¿®å¾© + åŠŸèƒ½å¢å¼· | Windows subprocess + Chrome éœé»˜ |
| `src/utils/stealth_extractor.py` | Bug ä¿®å¾© | Windows subprocess |

**æ–°å¢çš„æª”æ¡ˆ** (2):
- `src/core/proxy_manager.py.multiprocessing.bak` - v2.0.1 å‚™ä»½
- `docs/DAILY_WORK_LOG_20251206_WINDOWS_COMPATIBILITY.md` - è©³ç´°å·¥ä½œæ—¥èªŒ

**åˆªé™¤çš„æª”æ¡ˆ** (1):
- `nul` - v2.0.5 æ¸¬è©¦æ™‚èª¤å‰µå»º

---

### æŠ€è¡“è¦é»

#### 1. Windows Subprocess è™•ç†
```python
# Windows éœ€è¦ shell=True ä¾†æ‰¾åˆ° .cmd æ–‡ä»¶
import platform
use_shell = platform.system() == 'Windows'
subprocess.run(['npx', 'command'], shell=use_shell)
```

#### 2. Threading vs Multiprocessing

| ç‰¹æ€§ | threading | multiprocessing |
|------|-----------|----------------|
| **å…¨å±€ç‹€æ…‹** | å…±äº« | ç¨ç«‹ |
| **Windows å…¼å®¹** | âœ… è‰¯å¥½ | âš ï¸ spawn æ¨¡å¼å•é¡Œ |
| **asyncio æ”¯æ´** | âœ… è‰¯å¥½ | âš ï¸ éœ€ç‰¹æ®Šè™•ç† |

#### 3. MitmProxy Addon æ¶æ§‹
```
Master (åŸºç¤é¡ï¼Œ0 addons)
  â””â”€â”€ DumpMaster (36 addons)
       â”œâ”€â”€ TermLog (1) â† çµ‚ç«¯æ—¥èªŒï¼ˆå¯ç§»é™¤ï¼‰
       â”œâ”€â”€ Proxyserver (17) â† ä»£ç†æœå‹™å™¨ï¼ˆå¿…è¦ï¼‰
       â””â”€â”€ Dumper (33) â† æµé‡è½‰å„²ï¼ˆå¯ç§»é™¤ï¼‰
```

#### 4. Threading ä¸­çš„å…¨å±€è®Šæ•¸é™·é˜±
```python
# âŒ éŒ¯èª¤ï¼šsys.stdout æ˜¯å…¨å±€çš„
def thread_func():
    sys.stdout = open('file.txt', 'w')  # å½±éŸ¿æ‰€æœ‰ç·šç¨‹ï¼

# âœ… æ­£ç¢ºï¼šä½¿ç”¨ addon æ©Ÿåˆ¶
master.addons.remove(output_addon)  # åªå½±éŸ¿ç•¶å‰å¯¦ä¾‹
```

---

### æ¸¬è©¦ç‹€æ…‹

**å·²é©—è­‰** âœ…:
- [x] Stealth.min.js ä¸‹è¼‰æˆåŠŸ
- [x] MitmProxy ç«¯å£ç›£è½æˆåŠŸ
- [x] éœé»˜æ¨¡å¼ç„¡ HTTP æ—¥èªŒ
- [x] Chrome æ—¥èªŒå·²æŠ‘åˆ¶
- [x] ä¸»ç·šç¨‹è¼¸å‡ºæ­£å¸¸

**å¾…æ¸¬è©¦** â³:
- [ ] å®Œæ•´èª²ç¨‹åŸ·è¡Œ
- [ ] è¨ªå•æ™‚é•·æ””æˆªåŠŸèƒ½
- [ ] è‡ªå‹•ç­”é¡ŒåŠŸèƒ½
- [ ] Linux/macOS å…¼å®¹æ€§

---

### ç‰ˆæœ¬æ¼”é€²

```
v2.0.1 (multiprocessing)
  â”œâ”€ Windows å…¼å®¹æ€§å•é¡Œ
  â””â”€ asyncio äº‹ä»¶å¾ªç’°å•é¡Œ
       â†“
v2.0.2 (threading åŸºç¤)
  â”œâ”€ ä¿®å¾© Windows å•Ÿå‹•
  â””â”€ æ·»åŠ ç«¯å£å¥åº·æª¢æŸ¥
       â†“
v2.0.3 (MitmOptions å˜—è©¦) âŒ
       â†“
v2.0.4 (Master é¡å˜—è©¦) âŒ
       â†“
v2.0.5 (stdout é‡å®šå‘å˜—è©¦) âŒ
       â†“
v2.0.6 (ç§»é™¤ addons) âœ…
  â”œâ”€ ç§»é™¤ TermLog + Dumper
  â”œâ”€ ä¿ç•™æ‰€æœ‰å…¶ä»–åŠŸèƒ½
  â””â”€ å®Œç¾è§£æ±ºæ‰€æœ‰å•é¡Œ
```

---

### ç›¸é—œæ–‡æª”

- **è©³ç´°å·¥ä½œæ—¥èªŒ**: [DAILY_WORK_LOG_20251206_WINDOWS_COMPATIBILITY.md](./DAILY_WORK_LOG_20251206_WINDOWS_COMPATIBILITY.md)
- **CHANGELOG**: è¦‹ [CHANGELOG.md](../CHANGELOG.md) v2.0.8
- **åŸå§‹å‚™ä»½**: `src/core/proxy_manager.py.multiprocessing.bak`

---

### AI æ¥æ‰‹æŒ‡å—

**é‡è¦æé†’**:
1. **ä¿ç•™è¨»è§£**: `proxy_manager.py` ä¸­çš„ç‰ˆæœ¬æ­·å²è¨»è§£éå¸¸è©³ç´°ï¼Œè«‹å‹¿åˆªé™¤
2. **å‚™ä»½æ–‡ä»¶**: `proxy_manager.py.multiprocessing.bak` æ˜¯åŸå§‹ç‰ˆæœ¬ï¼Œè«‹å‹¿åˆªé™¤
3. **Windows ç‰¹æ€§**: ä¿®æ”¹ subprocess ç›¸é—œä»£ç¢¼æ™‚ï¼Œè¨˜å¾—æª¢æŸ¥ Windows å…¼å®¹æ€§
4. **threading æ³¨æ„**: ä¸è¦åœ¨ç·šç¨‹ä¸­ä¿®æ”¹å…¨å±€è®Šæ•¸ï¼ˆå¦‚ sys.stdoutï¼‰

**æœªä¾†æ”¹é€²**:
- Linux/macOS ç’°å¢ƒæ¸¬è©¦
- å®Œæ•´åŠŸèƒ½æ¸¬è©¦ï¼ˆèª²ç¨‹åŸ·è¡Œã€è¨ªå•æ™‚é•·ã€è‡ªå‹•ç­”é¡Œï¼‰
- æ€§èƒ½æ¸¬è©¦èˆ‡å„ªåŒ–

---

## âœ… å·²é©—è­‰ï¼šèª²ç¨‹é€šéæ¢ä»¶æå–æ–¹æ¡ˆ (2025-12-05 å¯¦é©—å®Œæˆ)

> **ç‹€æ…‹**: âœ… **é©—è­‰å®Œæˆ - æ–¹æ¡ˆ A å¯è¡Œ**
> **ç‰ˆæœ¬**: 2.2.0 (æ··åˆåŸ·è¡Œæ¨¡å¼)
> **å¯¦é©—æ—¥æœŸ**: 2025-12-05
> **æˆåŠŸç‡**: 100% (9/9 èª²ç¨‹å–®å…ƒ) âœ…

### æ¦‚è¿°

**ç›®æ¨™**: é©—è­‰ç²å–èª²ç¨‹é€šéæ¢ä»¶ï¼ˆè§€çœ‹æ™‚é•·ã€æ¸¬é©—æˆç¸¾ï¼‰çš„å¯è¡Œæ–¹æ¡ˆ

**å¯¦é©—çµæœ**:
- âŒ API ä¸æä¾›é€šéæ¢ä»¶è³‡æ–™
- âœ… **XPath æå– 100% æˆåŠŸ**
- âœ… **æ–¹æ¡ˆ Aï¼ˆæ··åˆæƒæï¼‰ç¢ºå®šå¯è¡Œ**

**æŠ€è¡“ç´°ç¯€**:
- **XPath**: `//*[@id="module-{module_id}"]/div[1]/div[1]/span`
- **ä½ç½®**: èª²ç¨‹è¨ˆç•«è©³æƒ…é ï¼ˆé€²å…¥èª²ç¨‹è¨ˆç•«å¾Œï¼‰
- **æ ¼å¼**: `é€šéæ¢ä»¶ç‚ºç´¯ç©è§€çœ‹æ™‚é•·{X}åˆ†é˜ä»¥ä¸Šä¸”æ•™æç‹€æ…‹ç‚ºå·²å®Œæˆ`

**çµ±è¨ˆæ•¸æ“š**:
- è§€çœ‹æ™‚é•·: å¹³å‡ **146.4 åˆ†é˜**ï¼ˆç¯„åœ 75-250 åˆ†ï¼‰
- æ¸¬é©—æˆç¸¾: å¹³å‡ **72.5 åˆ†**ï¼ˆç¯„åœ 60-100 åˆ†ï¼‰

---

### å¯¦é©—éç¨‹

#### æ¸¬è©¦è…³æœ¬ï¼ˆä½æ–¼ `scripts/course_requirements_experiment/`ï¼‰

| è…³æœ¬ | åŠŸèƒ½ | ç‹€æ…‹ |
|------|------|------|
| `test_course_details_api.py` | API ç«¯é»æ¢ç´¢ | âœ… å®Œæˆ (ç„¡é€šéæ¢ä»¶) |
| `test_pass_requirements_extraction.py` | XPath æå–æ¸¬è©¦ | âœ… å®Œæˆ (100% æˆåŠŸ) |

#### æ¸¬è©¦ 1: API ç«¯é»æ¢ç´¢

**æ¸¬è©¦ç«¯é»**: 7 å€‹å¯èƒ½çš„ API ç«¯é»
- `GET /api/courses/{id}`
- `GET /api/courses/{id}/details`
- `GET /api/courses/{id}/modules`
- `GET /api/courses/{id}/requirements`
- `GET /api/courses/{id}/info`
- `GET /api/my-courses/{id}`
- `GET /api/course/{id}`

**ç™¼ç¾**:
- âœ… æ‰¾åˆ° 2 å€‹æœ‰æ•ˆç«¯é»ï¼š
  - `/api/courses/{id}` - èª²ç¨‹åŸºæœ¬è³‡è¨Šï¼ˆ28 å€‹æ¬„ä½ï¼‰
  - `/api/courses/{id}/modules` - èª²ç¨‹æ¨¡çµ„åˆ—è¡¨
- âŒ **ç„¡ä»»ä½•ç«¯é»åŒ…å«é€šéæ¢ä»¶**ï¼ˆrequired_duration, required_scoreï¼‰

**çµè«–**: å¿…é ˆä½¿ç”¨ Selenium å¾é é¢æå–é€šéæ¢ä»¶

#### æ¸¬è©¦ 2: XPath æå–å¯é æ€§é©—è­‰ ğŸ”‘ **é—œéµæ¸¬è©¦**

**æ¸¬è©¦ç¯„åœ**:
- èª²ç¨‹è¨ˆç•«æ•¸: 18 å€‹
- èª²ç¨‹å–®å…ƒæ•¸: 9 å€‹ï¼ˆæ¸¬è©¦å¸³è™Ÿï¼‰
- æå–æˆåŠŸ: 9 å€‹
- **æˆåŠŸç‡**: **100.0%** âœ…

**æ–‡å­—æ ¼å¼åˆ†æ**ï¼ˆ8 ç¨®ç¨ç‰¹æ ¼å¼ï¼‰:
```
1. é€šéæ¢ä»¶ç‚ºç´¯ç©è§€çœ‹æ™‚é•·100åˆ†é˜ä»¥ä¸Šä¸”æ•™æç‹€æ…‹ç‚ºå·²å®Œæˆ (2æ¬¡)
2. é€šéæ¢ä»¶ç‚ºç´¯ç©è§€çœ‹æ™‚é•·100åˆ†é˜ä»¥ä¸Šã€æ•™æç‹€æ…‹ç‚ºå·²å®ŒæˆåŠæ¸¬é©—æˆç¸¾é”100åˆ† (1æ¬¡)
3. é€šéæ¢ä»¶ç‚ºç´¯ç©è§€çœ‹æ™‚é•·250åˆ†é˜ä»¥ä¸Šã€æ‰€æœ‰æ•™æç‹€æ…‹ç‚ºå·²å®Œæˆä¸”æ¸¬é©—æˆç¸¾é”60åˆ†ä»¥ä¸Š (1æ¬¡)
4. é€šéæ¢ä»¶ç‚ºç´¯ç©è§€çœ‹æ™‚é•·75åˆ†é˜ä»¥ä¸Šã€æ•™æç‹€æ…‹ç‚ºå·²å®ŒæˆåŠæ¸¬é©—æˆç¸¾é”70åˆ†ä»¥ä¸Š (1æ¬¡)
5. é€šéæ¢ä»¶ç‚ºç´¯ç©è§€çœ‹æ™‚é•·200åˆ†é˜ä»¥ä¸Šä¸”æ‰€æœ‰æ•™æç‹€æ…‹ç‚ºå·²å®Œæˆ (1æ¬¡)
6. é€šéæ¢ä»¶ç‚ºç´¯ç©è§€çœ‹æ™‚é•·200åˆ†é˜ä»¥ä¸Šä¸”æ•™æç‹€æ…‹ç‚ºå·²å®Œæˆ (1æ¬¡)
7. é€šéæ¢ä»¶ç‚ºæ¸¬é©—æˆç¸¾é”60åˆ†ä»¥ä¸Š (1æ¬¡)
8. åƒè€ƒè³‡æ–™ (1æ¬¡)
```

**Regex æå–è¦å‰‡**:
```python
# æå–è§€çœ‹æ™‚é•·
duration_match = re.search(r'è§€çœ‹æ™‚é•·(\d+)åˆ†é˜', text)
duration_minutes = int(duration_match.group(1)) if duration_match else None

# æå–æ¸¬é©—æˆç¸¾
score_match = re.search(r'æ¸¬é©—æˆç¸¾é”(\d+)åˆ†', text)
exam_score = int(score_match.group(1)) if score_match else None
```

**çµ±è¨ˆçµæœ**:
- è§€çœ‹æ™‚é•·æ¨£æœ¬æ•¸: 7
  - æœ€å°å€¼: 75 åˆ†é˜
  - æœ€å¤§å€¼: 250 åˆ†é˜
  - å¹³å‡å€¼: 146.4 åˆ†é˜
  - åˆ†ä½ˆ: 100åˆ†(3å€‹)ã€200åˆ†(2å€‹)ã€250åˆ†(1å€‹)ã€75åˆ†(1å€‹)

- æ¸¬é©—æˆç¸¾æ¨£æœ¬æ•¸: 4
  - æœ€å°å€¼: 60 åˆ†
  - æœ€å¤§å€¼: 100 åˆ†
  - å¹³å‡å€¼: 72.5 åˆ†
  - åˆ†ä½ˆ: 60åˆ†(2å€‹)ã€100åˆ†(1å€‹)ã€70åˆ†(1å€‹)

---

### æ–¹æ¡ˆ Aï¼šæ··åˆæƒææ¨¡å¼ï¼ˆæ¨è–¦ï¼‰

#### æµç¨‹è¨­è¨ˆ

```
1. Selenium ç™»å…¥
   â†“
2. å‰å¾€èª²ç¨‹åˆ—è¡¨é  (/my-courses)
   â†“
3. æ‰¹æ¬¡æå–é€šéæ¢ä»¶
   â”œâ”€ é€å€‹é€²å…¥èª²ç¨‹è¨ˆç•« (Selenium + æ™ºèƒ½é»æ“Š)
   â”œâ”€ æå–æ‰€æœ‰ module é€šéæ¢ä»¶ (XPath)
   â””â”€ è¿”å›èª²ç¨‹åˆ—è¡¨
   â†“
4. ä½¿ç”¨ API æäº¤è§€çœ‹æ™‚é•· (requests)
   â”œâ”€ POST /statistics/api/user-visits
   â””â”€ å¿«é€Ÿæäº¤ï¼ˆç„¡éœ€é é¢æ“ä½œï¼‰
   â†“
5. è€ƒè©¦ç’°ç¯€ä½¿ç”¨ Selenium è‡ªå‹•ç­”é¡Œ
```

#### æ™ºèƒ½é»æ“Šæ©Ÿåˆ¶

**å®šä½ç­–ç•¥**:
```python
# ç²¾ç¢º XPath å®šä½èª²ç¨‹è¨ˆç•«é€£çµ
xpath = f'//a[text()="{program_name}"]'
program_links = driver.find_elements(By.XPATH, xpath)

# è™•ç†é‡è¤‡èª²ç¨‹ï¼ˆå¦‚ï¼š114å¹´åº¦ vs 113å¹´åº¦ï¼‰
if len(program_links) > 1:
    program_link = program_links[0]  # ä½¿ç”¨ç¬¬ä¸€å€‹åŒ¹é…
```

**é»æ“Šç­–ç•¥**ï¼ˆè‡ªå‹•å‚™æ´ï¼‰:
```python
# 1. æ»¾å‹•åˆ°å…ƒç´ ä½ç½®
driver.execute_script(
    "arguments[0].scrollIntoView({block: 'center'});",
    program_link
)

# 2. å˜—è©¦æ™®é€šé»æ“Š
try:
    program_link.click()
except Exception:
    # 3. é»æ“Šå¤±æ•—æ™‚è‡ªå‹•æ”¹ç”¨ JS é»æ“Š
    driver.execute_script("arguments[0].click();", program_link)
```

#### æ€§èƒ½å„ªå‹¢

| é …ç›® | å‚³çµ± Web Scan | æ··åˆæƒææ¨¡å¼ | æå‡ |
|------|--------------|-------------|------|
| é€šéæ¢ä»¶æå– | é€å€‹é€²å…¥ | æ‰¹æ¬¡æå– | å¿« 3-5x |
| è§€çœ‹æ™‚é•·æäº¤ | é é¢æ“ä½œ | API èª¿ç”¨ | å¿« 10-20x |
| è€ƒè©¦ç­”é¡Œ | Selenium | Selenium | ç›¸åŒ |
| **æ•´é«”æ€§èƒ½** | åŸºæº– | **å¿« 5-10x** | âš¡ |

---

### ä¸‹ä¸€æ­¥ï¼šæ–°åŠŸèƒ½å¯¦ä½œè¨ˆç•«

#### æ–°åŠŸèƒ½ï¼šæ··åˆåŸ·è¡Œæ¨¡å¼ï¼ˆv2.2.0ï¼‰

**æ ¸å¿ƒæ¨¡çµ„** (å¾…å¯¦ä½œ):

1. **PassRequirementsExtractor** - é€šéæ¢ä»¶æå–å™¨
   ```python
   class PassRequirementsExtractor:
       """æ‰¹æ¬¡æå–æ‰€æœ‰èª²ç¨‹è¨ˆç•«çš„é€šéæ¢ä»¶"""

       def extract_all_requirements(self) -> Dict[str, Dict]:
           """
           è¿”å›æ ¼å¼:
           {
               "program_id_1": {
                   "modules": {
                       "module_id_1": {
                           "duration_minutes": 100,
                           "exam_score": 80
                       }
                   }
               }
           }
           """
   ```

2. **DurationModeSelector** - æ™‚é•·æ¨¡å¼é¸æ“‡å™¨
   ```python
   class DurationModeSelector:
       """æ ¹æ“šé…ç½®é¸æ“‡è§€çœ‹æ™‚é•·"""

       MODE_FIXED = "fixed"     # å›ºå®šå€¼ï¼ˆé…ç½®æª”ï¼‰
       MODE_REQUIRED = "required"  # èª²ç¨‹è¦æ±‚å€¼
       MODE_AUTO = "auto"       # è¦æ±‚å€¼ + buffer

       def get_duration(self, course_id: str) -> int:
           """è¿”å›èª²ç¨‹çš„ç›®æ¨™è§€çœ‹æ™‚é•·ï¼ˆç§’ï¼‰"""
   ```

3. **VisitDurationClient** - è¨ªå•æ™‚é•· API å®¢æˆ¶ç«¯
   ```python
   class VisitDurationClient:
       """æäº¤è§€çœ‹æ™‚é•·åˆ°ä¼ºæœå™¨"""

       def submit_duration(
           self,
           course_id: int,
           duration_seconds: int,
           user_info: Dict
       ) -> bool:
           """
           POST /statistics/api/user-visits
           æäº¤è§€çœ‹æ™‚é•·è¨˜éŒ„
           """
   ```

4. **HybridExecutionScenario** - æ··åˆåŸ·è¡Œå ´æ™¯
   ```python
   class HybridExecutionScenario:
       """æ•´åˆ Selenium + API çš„æ··åˆåŸ·è¡Œå ´æ™¯"""

       def execute(self):
           # 1. æå–é€šéæ¢ä»¶
           # 2. API æäº¤æ™‚é•·
           # 3. Selenium è™•ç†è€ƒè©¦
           # 4. è‡ªå‹•åŒ¹é…é¡Œåº«
   ```

**é…ç½®é …** (`config/eebot.cfg`):
```ini
[hybrid_mode]
# æ™‚é•·æ¨¡å¼: fixed | required | auto
duration_mode = required

# å›ºå®šæ™‚é•·ï¼ˆç•¶ duration_mode = fixedï¼‰
fixed_duration_minutes = 120

# æ™‚é•·ç·©è¡ï¼ˆç•¶ duration_mode = autoï¼‰
duration_buffer_minutes = 10

# æ˜¯å¦å¿«å–é€šéæ¢ä»¶
cache_requirements = true
```

**é è¨ˆé–‹ç™¼æ™‚é–“**: 11 å·¥ä½œæ—¥

**å„ªå…ˆç´š**: ğŸ”¥ **ç¬¬ä¸€å„ªå…ˆ**

---

## âœ… å·²é©—è­‰ï¼šAPI èª²ç¨‹æƒææ¨¡å¼ (2025-12-05 å¯¦é©—å®Œæˆ)

> **ç‹€æ…‹**: âœ… **é©—è­‰å®Œæˆ - å»ºè­°å¯¦ä½œ**
> **ç‰ˆæœ¬**: 2.1.0 (èª²ç¨‹æƒææ¨¡çµ„)
> **å¯¦é©—æ—¥æœŸ**: 2025-12-05
> **é¢¨éšªè©•ç´š**: ğŸŸ¢ **ç¶ ç‡ˆ - å®‰å…¨**

### æ¦‚è¿°

**ç›®æ¨™**: é©—è­‰æ˜¯å¦å¯ä»¥ç›´æ¥èª¿ç”¨ API ç²å–èª²ç¨‹åˆ—è¡¨ï¼Œå–ä»£å‚³çµ± Selenium Web Scan

**çµè«–**: âœ… **å®Œå…¨å¯è¡Œ** - ä¼ºæœå™¨ç„¡ååµæ¸¬æ©Ÿåˆ¶ï¼Œå¯å®‰å…¨ä½¿ç”¨ API ç›´æ¥èª¿ç”¨

**é æœŸæ•ˆç›Š**:
- ğŸš€ æ€§èƒ½æå‡ **4-7x**ï¼ˆæ•´é«”ï¼‰/ **15-30x**ï¼ˆæƒæéšæ®µï¼‰
- ğŸ’° è³‡æºæ¶ˆè€—é™ä½ **80%**
- âš¡ åŸ·è¡Œæ™‚é–“å¾åˆ†é˜ç´šåˆ°ç§’ç´š
- ğŸ¯ æ”¯æ´æ‰¹æ¬¡è™•ç†

---

### å¯¦é©—éç¨‹

#### æ¸¬è©¦è…³æœ¬ï¼ˆä½æ–¼ `scripts/api_verification/`ï¼‰

| è…³æœ¬ | åŠŸèƒ½ | ç‹€æ…‹ |
|------|------|------|
| `test_my_courses_api.py` | API çµæ§‹é©—è­‰ | âœ… å®Œæˆ |
| `test_api_security.py` | ååµæ¸¬é¢¨éšªè©•ä¼° | âœ… å®Œæˆ |
| `compare_web_vs_api.py` | è³‡æ–™ä¸€è‡´æ€§æ¯”å° | âœ… å®Œæˆ |

#### æ¸¬è©¦ 1: API çµæ§‹é©—è­‰

**API ç«¯é»**: `GET /api/my-courses`

**ç™¼ç¾**:
- âœ… API å›æ‡‰æ ¼å¼ç‚º JSON
- âœ… åŒ…å« 18 å€‹èª²ç¨‹ï¼ˆæ¸¬è©¦å¸³è™Ÿï¼‰
- âš ï¸ ç‚º**æ‰å¹³çµæ§‹**ï¼ˆæƒ…å¢ƒ Cï¼‰ï¼Œç„¡ä¸»èª²ç¨‹/å­èª²ç¨‹éšå±¤

**API å›æ‡‰ç¯„ä¾‹**:
```json
{
  "courses": [
    {
      "id": 465,
      "name": "æ€§åˆ¥å¹³ç­‰å·¥ä½œæ³•ã€æ€§é¨·æ“¾é˜²æ²»æ³•åŠç›¸é—œå­æ³•ä¿®æ³•é‡é»èˆ‡å¯¦å‹™æ¡ˆä¾‹(114å¹´åº¦)",
      "course_code": "901011114",
      "course_type": 1,
      "credit": "2.0",
      "start_date": "2025-03-01",
      "end_date": "2025-12-31",
      "is_graduated": true,
      "compulsory": true,
      "course_attributes": {
        "published": true,
        "student_count": 25481
      }
    }
  ]
}
```

**API æä¾›çš„é¡å¤–æ¬„ä½**ï¼ˆWeb Scan æ²’æœ‰ï¼‰:
- `course_code` - èª²ç¨‹ä»£ç¢¼
- `course_type` - èª²ç¨‹é¡å‹
- `credit` - å­¸åˆ†
- `start_date` / `end_date` - æ—¥æœŸç¯„åœ
- `is_graduated` - æ˜¯å¦å·²å®Œæˆ
- `compulsory` - æ˜¯å¦å¿…ä¿®
- `student_count` - å­¸ç”Ÿäººæ•¸

#### æ¸¬è©¦ 2: ååµæ¸¬é¢¨éšªè©•ä¼° ğŸ”‘ **é—œéµæ¸¬è©¦**

**æ¸¬è©¦å ´æ™¯**:

| å ´æ™¯ | æè¿° | çµæœ |
|------|------|------|
| Scenario 1 | åŸºæº–æ¸¬è©¦ï¼ˆå®Œæ•´ Cookie + Headersï¼‰ | âœ… æˆåŠŸ (2.18s) |
| Scenario 2 | ç´” API èª¿ç”¨ï¼ˆç°¡åŒ– Headersï¼‰ | âœ… æˆåŠŸ (0.50s) |
| Scenario 3 | é«˜é »è«‹æ±‚ï¼ˆ10æ¬¡/åˆ†é˜ï¼‰ | âœ… **10/10 å…¨éƒ¨æˆåŠŸ** |
| Scenario 4 | æœ€å°åŒ– Headersï¼ˆåƒ… Cookieï¼‰ | âœ… æˆåŠŸ (0.51s) |

**é—œéµç™¼ç¾**:
- âœ… **ç„¡ç€è¦½å™¨æŒ‡ç´‹æª¢æ¸¬**
- âœ… **ç„¡é »ç‡é™åˆ¶**ï¼ˆé€£çºŒ 10 æ¬¡è«‹æ±‚å…¨éƒ¨æˆåŠŸï¼‰
- âœ… **æ¥å—ç°¡åŒ– Headers**
- âœ… **ç„¡ IP ç¶å®šé©—è­‰**

**é¢¨éšªè©•ç´š**: ğŸŸ¢ **ç¶ ç‡ˆ - ä½é¢¨éšª**

**çµè«–**: ä¼ºæœå™¨å° API èª¿ç”¨**æ²’æœ‰æ˜é¡¯çš„ååµæ¸¬æ©Ÿåˆ¶**ï¼Œå¯å®‰å…¨ä½¿ç”¨ API Direct Mode

#### æ¸¬è©¦ 3: è³‡æ–™ä¸€è‡´æ€§æ¯”å°

**åŒ¹é…çµæœ**:
- ç•¶å‰å¸³è™Ÿ: **7/7 èª²ç¨‹åŒ¹é… = 100%** âœ…
- åŒ¹é…ç­–ç•¥: `course_id` (Web) == `id` (API)

**æ¬„ä½å°æ‡‰**:

| Web Scan | API Scan | å°æ‡‰é—œä¿‚ |
|----------|----------|---------|
| `course_id` | `id` | âœ… å®Œå…¨å°æ‡‰ |
| `program_name` + `lesson_name` | `name` | âš ï¸ API åªæœ‰å–®ä¸€åç¨± |
| - | `course_code` ç­‰ | âœ¨ API ç¨æœ‰æ¬„ä½ |

---

### æ¨è–¦å¯¦ä½œæ–¹æ¡ˆ

#### æ–¹æ¡ˆï¼šAPI Direct Mode

**æµç¨‹**:
```
1. Selenium ç™»å…¥ â†’ æå– Session Cookie â†’ é—œé–‰ç€è¦½å™¨
2. requests èª¿ç”¨ API â†’ ç²å–èª²ç¨‹åˆ—è¡¨
3. ç¯©é¸æœªå®Œæˆèª²ç¨‹ â†’ ç”Ÿæˆ schedule.json
4. åŸ·è¡Œèª²ç¨‹å­¸ç¿’ï¼ˆç¾æœ‰æµç¨‹ï¼‰
```

**æ ¸å¿ƒç¨‹å¼ç¢¼** (`src/api/course_fetcher.py`):
```python
class CourseFetcher:
    """API èª²ç¨‹è³‡æ–™ç²å–å™¨"""

    def fetch_all_courses(self) -> List[Dict]:
        """ç²å–æ‰€æœ‰èª²ç¨‹"""
        api_url = f"{self.base_url}/api/my-courses"
        response = requests.get(
            api_url,
            cookies=self.cookies,
            headers=headers,
            verify=False
        )
        return response.json().get('courses', [])

    def filter_active_courses(self, courses):
        """ç¯©é¸æœªå®Œæˆèª²ç¨‹"""
        return [c for c in courses if not c.get('is_graduated')]
```

**æ•´åˆé»**: `menu.py` - æ–°å¢ã€ŒAPI èª²ç¨‹æƒæã€é¸é …

---

### æ€§èƒ½å°æ¯”

| æŒ‡æ¨™ | Web Scan | API Mode | æ”¹å–„ |
|------|----------|----------|------|
| ç™»å…¥æ™‚é–“ | 20-30s | 20-30s | - |
| æƒææ™‚é–“ | 60-120s | **2-5s** | ğŸŸ¢ **15-30x â†‘** |
| ç¸½æ™‚é–“ | 80-150s | **22-35s** | ğŸŸ¢ **4-7x â†‘** |
| è³‡æºæ¶ˆè€— | é«˜ï¼ˆChrome å¸¸é§ï¼‰ | ä½ï¼ˆåƒ…ç™»å…¥æ™‚ï¼‰ | ğŸŸ¢ **80% â†“** |

---

### å¯¦ä½œè·¯ç·šåœ–

**Phase 1**: åŸå‹é–‹ç™¼ï¼ˆ1-2 å¤©ï¼‰
- [ ] å‰µå»º `src/api/course_fetcher.py`
- [ ] æ•´åˆåˆ° `menu.py`
- [ ] å–®å…ƒæ¸¬è©¦

**Phase 2**: æ•´åˆæ¸¬è©¦ï¼ˆ1 å¤©ï¼‰
- [ ] å¤šå¸³è™Ÿæ¸¬è©¦
- [ ] éŒ¯èª¤è™•ç†æ¸¬è©¦
- [ ] æ€§èƒ½é©—è­‰

**Phase 3**: ç”Ÿç”¢éƒ¨ç½²ï¼ˆ1 å¤©ï¼‰
- [ ] æ–‡æª”æ›´æ–°
- [ ] ç›£æ§è¨­ç½®
- [ ] æ­£å¼å•Ÿç”¨

---

### ç›¸é—œæ–‡æª”

- ğŸ“„ [API çµæ§‹åˆ†æå ±å‘Š](../scripts/api_verification/results/api_structure_analysis.md)
- ğŸ“„ [å®‰å…¨æ€§è©•ä¼°å ±å‘Š](../scripts/api_verification/results/security_assessment.md)
- ğŸ“„ [è³‡æ–™æ¯”å°å ±å‘Š](../scripts/api_verification/results/comparison_report.md)
- ğŸ“„ [æœ€çµ‚æ•´åˆå»ºè­°å ±å‘Š](../scripts/api_verification/results/final_integration_report.md)

---

## ğŸš€ è¨ˆç•«åŠŸèƒ½ï¼šAPI ç›´æ¥èª¿ç”¨æ¨¡å¼ (2025-12-04 ææ¡ˆ)

> **ç‹€æ…‹**: ğŸ“‹ **ææ¡ˆéšæ®µ** - å¾…æ‰¹å‡†
> **ç‰ˆæœ¬**: 2.1.0 (è¨ˆç•«ä¸­)
> **ææ¡ˆæ—¥æœŸ**: 2025-12-04
> **é ä¼°å·¥æ™‚**: 12-18 å°æ™‚

### æ¦‚è¿°

**æ ¸å¿ƒç›®æ¨™**: ç„¡éœ€é€²å…¥èª²ç¨‹å³å¯ç›´æ¥èª¿ç”¨ API æäº¤æ™‚é•·ï¼Œå¤§å¹…æå‡åŸ·è¡Œæ•ˆç‡ï¼ˆ10-15 å€ï¼‰

**æŠ€è¡“çªç ´**: é€é Burp Suite åˆ†æç™¼ç¾ API ç«¯é»å­˜åœ¨ 6 é … CRITICAL ç´šåˆ¥å®‰å…¨æ¼æ´ï¼Œå¯ç›´æ¥å½é€ è«‹æ±‚

---

### ç‚ºä»€éº¼éœ€è¦é€™å€‹æ¨¡å¼ï¼Ÿ

**ç•¶å‰å•é¡Œ**:
- âŒ Selenium å¿…é ˆè¼‰å…¥å®Œæ•´é é¢ï¼ˆæ…¢ï¼Œ~30 ç§’/èª²ç¨‹ï¼‰
- âŒ æ¯å€‹èª²ç¨‹éƒ½éœ€è¦é€²å…¥ï¼ˆé‡è¤‡æ“ä½œï¼‰
- âŒ è³‡æºæ¶ˆè€—å¤§ï¼ˆè¨˜æ†¶é«” 500MB+ï¼ŒCPU 40%ï¼‰
- âŒ ç„¡æ³•æ‰¹é‡è™•ç†ï¼ˆå—é™æ–¼ç€è¦½å™¨ï¼‰

**è§£æ±ºæ–¹æ¡ˆ** (æ··åˆæ¨¡å¼):
- âœ… Selenium ç™»å…¥ï¼ˆä¿æŒéš±åŒ¿æ€§ï¼‰
- âœ… æå–ç”¨æˆ¶è³‡è¨Š + Session Cookie
- âœ… é—œé–‰ç€è¦½å™¨ï¼ˆé‡‹æ”¾è³‡æºï¼‰
- âœ… API æ‰¹é‡æäº¤ï¼ˆå¿«ï¼Œ~2 ç§’/èª²ç¨‹ï¼‰

---

### æŠ€è¡“å¯è¡Œæ€§åˆ†æ

#### API ç«¯é»

```
POST https://elearn.post.gov.tw/statistics/api/user-visits
Content-Type: application/json
å›æ‡‰: 204 No Content
```

#### å®‰å…¨æ¼æ´ï¼ˆ6 é … CRITICALï¼‰

| # | æ¼æ´ | é¢¨éšªç­‰ç´š | å¯è¡Œæ€§ | èªªæ˜ |
|---|------|---------|--------|------|
| 1 | visit_duration ç„¡é©—è­‰ | ğŸ”´ CRITICAL | EASY | å¯ä»»æ„ä¿®æ”¹æ™‚é•·å€¼ |
| 2 | visit_start_from ç„¡é©—è­‰ | ğŸ”´ CRITICAL | EASY | å¯å½é€ æ­·å²æ™‚é–“ |
| 3 | ç„¡è«‹æ±‚ç°½åæ©Ÿåˆ¶ (HMAC) | ğŸ”´ CRITICAL | EASY | å¯å½é€ å®Œæ•´è«‹æ±‚ |
| 4 | ç„¡å»é‡æª¢æ¸¬ | ğŸŸ  HIGH | EASY | å¯é‡è¤‡æäº¤è«‹æ±‚ |
| 5 | ç„¡é€Ÿç‡é™åˆ¶ | ğŸŸ¡ MEDIUM | EASY | å¯å¤§é‡ç™¼é€è«‹æ±‚ |
| 6 | ç„¡ IP ç¶å®šé©—è­‰ | ğŸŸ¡ MEDIUM | MEDIUM | å¯è·¨è£ç½®å½é€  |

**æŠ€è¡“çµè«–**: âœ… **å®Œå…¨å¯è¡Œ** - ä¼ºæœå™¨ç„¡é©—è­‰æ©Ÿåˆ¶ï¼Œå¯ç›´æ¥èª¿ç”¨ API

---

### API è«‹æ±‚çµæ§‹

#### å¿…å¡«æ¬„ä½ï¼ˆ13 å€‹ï¼‰

```json
{
  "user_id": "19688",
  "org_id": "1",
  "visit_duration": 1483,           // â­ æ™‚é•·ï¼ˆç§’ï¼‰
  "is_teacher": false,
  "browser": "chrome",
  "user_agent": "Mozilla/5.0...",
  "visit_start_from": "2025/12/02T13:35:26",  // â­ é–‹å§‹æ™‚é–“
  "org_name": "éƒµæ”¿ï½…å¤§å­¸",
  "user_no": "522673",
  "user_name": "é™³å‰é³´",
  "dep_id": "156",
  "dep_name": "æ–°èˆˆæŠ•éè‚¡",
  "dep_code": "0040001013"
}
```

#### å¯é¸æ¬„ä½ï¼ˆ6 å€‹ï¼‰- é€²å…¥èª²ç¨‹æ™‚æ‰éœ€è¦

```json
{
  "course_id": "465",
  "course_code": "465_C",
  "course_name": "è³‡é€šå®‰å…¨æ•™è‚²è¨“ç·´",
  "activity_id": "1234",
  "activity_type": "video",
  "master_course_id": "465"
}
```

**é—œéµç™¼ç¾**: ä¸é€²å…¥èª²ç¨‹æ™‚ï¼Œåªéœ€ 13 å€‹å¿…å¡«æ¬„ä½å³å¯æäº¤

---

### æ··åˆæ¨¡å¼æ¶æ§‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Phase 1: Selenium ç™»å…¥     â”‚
â”‚  â€¢ å•Ÿå‹• WebDriver            â”‚
â”‚  â€¢ è¼‰å…¥ç™»å…¥é é¢              â”‚
â”‚  â€¢ è‡ªå‹•å¡«å…¥å¸³å¯† + é©—è­‰ç¢¼     â”‚
â”‚  â€¢ ç™»å…¥æˆåŠŸ                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Phase 2: æå–è³‡è¨Š           â”‚
â”‚  â€¢ åŸ·è¡Œ JavaScript æå–      â”‚
â”‚    - user_id, org_id        â”‚
â”‚    - user_no, user_name     â”‚
â”‚    - dep_id, dep_name       â”‚
â”‚    - dep_code, org_name     â”‚
â”‚  â€¢ æå– Session Cookie       â”‚
â”‚  â€¢ é©—è­‰è³‡è¨Šå®Œæ•´æ€§            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Phase 3: é—œé–‰ç€è¦½å™¨         â”‚
â”‚  â€¢ driver.quit()             â”‚
â”‚  â€¢ é‡‹æ”¾è³‡æºï¼ˆè¨˜æ†¶é«”ã€CPUï¼‰   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Phase 4: API æ‰¹é‡æäº¤       â”‚
â”‚  FOR EACH èª²ç¨‹:              â”‚
â”‚    â€¢ æ§‹å»º API payload        â”‚
â”‚    â€¢ é »ç‡é™åˆ¶æª¢æŸ¥            â”‚
â”‚    â€¢ éš¨æ©Ÿå»¶é²                â”‚
â”‚    â€¢ POST /api/user-visits   â”‚
â”‚    â€¢ é©—è­‰å›æ‡‰ (204)          â”‚
â”‚    â€¢ è¨˜éŒ„çµæœ                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### æ•ˆèƒ½å°æ¯”

| æŒ‡æ¨™ | Selenium æ¨¡å¼ | æ··åˆæ¨¡å¼ | æ”¹å–„å¹…åº¦ |
|------|--------------|---------|---------|
| **å–®èª²ç¨‹è™•ç†æ™‚é–“** | ~30 ç§’ | ~2 ç§’ | ğŸŸ¢ **93% â†“** |
| **10 èª²ç¨‹è™•ç†æ™‚é–“** | ~5 åˆ†é˜ | ~20 ç§’ | ğŸŸ¢ **93% â†“** |
| **è¨˜æ†¶é«”æ¶ˆè€—** | ~500 MB | ~50 MB | ğŸŸ¢ **90% â†“** |
| **CPU ä½¿ç”¨ç‡** | ~40% | ~5% | ğŸŸ¢ **87.5% â†“** |
| **æ‰¹é‡è™•ç†èƒ½åŠ›** | å—é™ | å„ªç•° | ğŸŸ¢ **10x â†‘** |

---

### æ ¸å¿ƒæŠ€è¡“çµ„ä»¶

#### 1. VisitDurationClient

**æª”æ¡ˆ**: `src/api/client/visit_duration_client.py`

**åŠŸèƒ½**:
- API è«‹æ±‚æ§‹å»º
- æ™‚é•·ç›´æ¥æäº¤
- è‡ªå‹•ç”Ÿæˆæ™‚é–“æˆ³è¨˜
- è‡ªå‹•è™•ç† User-Agent

**æ ¸å¿ƒæ–¹æ³•**:
```python
client = VisitDurationClient(session_cookie, user_info)

# æäº¤æ™‚é•·
client.submit_visit_duration(
    visit_duration=9100,      # ç§’
    course_id="465",          # å¯é¸
    course_name="è³‡é€šå®‰å…¨"    # å¯é¸
)
```

---

#### 2. UserInfoExtractor

**æª”æ¡ˆ**: `src/api/client/user_info_extractor.py`

**åŠŸèƒ½**:
- å¾é é¢æå–ç”¨æˆ¶è³‡è¨Šï¼ˆ13 å€‹å¿…å¡«æ¬„ä½ï¼‰
- æå– Session Cookie
- å¤šç­–ç•¥æå–ï¼ˆJavaScriptã€localStorageã€DOMï¼‰

**æ ¸å¿ƒæ–¹æ³•**:
```python
extractor = UserInfoExtractor(driver)

# æå–ç”¨æˆ¶è³‡è¨Š
user_info = extractor.extract_from_page()
# å›å‚³: {user_id, org_id, user_no, ...}

# æå– Session Cookie
session_cookie = extractor.extract_session_cookie()
```

---

#### 3. SessionManager

**æª”æ¡ˆ**: `src/core/session_manager.py`

**åŠŸèƒ½**:
- Session éæœŸæª¢æ¸¬ï¼ˆé è¨­ 1 å°æ™‚ï¼‰
- è‡ªå‹•åˆ·æ–°æ©Ÿåˆ¶
- Cookie æŒä¹…åŒ–

---

#### 4. RateLimiter

**æª”æ¡ˆ**: `src/utils/rate_limiter.py`

**åŠŸèƒ½**:
- æ¯åˆ†é˜è«‹æ±‚æ¬¡æ•¸é™åˆ¶ï¼ˆé è¨­ 10 æ¬¡ï¼‰
- è‡ªå‹•ç­‰å¾…æ©Ÿåˆ¶
- æ»‘å‹•è¦–çª—æ¼”ç®—æ³•

---

#### 5. PacketLogger

**æª”æ¡ˆ**: `src/api/interceptors/packet_logger.py`

**åŠŸèƒ½**:
- MitmProxy å°åŒ…è¢«å‹•æ•ç²
- å®Œæ•´ request/response è¨˜éŒ„
- JSON æ ¼å¼å„²å­˜

---

### é…ç½®è®Šæ›´

#### æ–°å¢é…ç½®å€å¡Š

**æª”æ¡ˆ**: `config/eebot.cfg`

```ini
# ============================================
# åŸ·è¡Œæ¨¡å¼é…ç½®
# ============================================
[MODE]
# selenium: å®Œæ•´ Selenium æ¨¡å¼ï¼ˆç¾æœ‰ï¼‰
# hybrid: æ··åˆæ¨¡å¼ï¼ˆæ¨è–¦ï¼‰â­
# api_only: ç´” API æ¨¡å¼ï¼ˆå¯¦é©—æ€§ï¼‰
execution_mode = hybrid

# ============================================
# API æ¨¡å¼é…ç½®
# ============================================
[API_MODE]
# Session åˆ·æ–°é–“éš”ï¼ˆç§’ï¼‰
session_refresh_interval = 3600

# æ¯åˆ†é˜è«‹æ±‚æ¬¡æ•¸é™åˆ¶
requests_per_minute = 10

# æ¨¡æ“¬çœŸå¯¦è¡Œç‚º
simulate_real_behavior = y

# éš¨æ©Ÿå»¶é²ç¯„åœï¼ˆç§’ï¼‰
random_delay_min = 1.0
random_delay_max = 3.0

# æ™‚é•·æ³¢å‹•ç¯„åœï¼ˆç§’ï¼‰
duration_variation = 60

# ============================================
# å°åŒ…æ•ç²é…ç½®
# ============================================
[PACKET_CAPTURE]
# å•Ÿç”¨å°åŒ…è¨˜éŒ„
enable_packet_logging = n

# å°åŒ…å„²å­˜ç›®éŒ„
packet_output_dir = captured_packets

# è¨˜éŒ„è©³ç´°ç¨‹åº¦ï¼ˆminimal / fullï¼‰
log_level = full
```

---

### é¢¨éšªè©•ä¼°èˆ‡ç·©è§£

#### é¢¨éšªçŸ©é™£

| é¢¨éšª | æ©Ÿç‡ | å½±éŸ¿ | ç­‰ç´š | ç·©è§£æªæ–½ |
|------|------|------|------|---------|
| Session éæœŸ | ğŸŸ¡ ä¸­ | ğŸ”´ é«˜ | ğŸŸ  HIGH | Session ç®¡ç†å™¨è‡ªå‹•åˆ·æ–° |
| ç•°å¸¸æª¢æ¸¬è§¸ç™¼ | ğŸŸ¡ ä¸­ | ğŸ”´ é«˜ | ğŸŸ  HIGH | é »ç‡æ§åˆ¶ + éš¨æ©Ÿå»¶é² |
| API çµæ§‹è®Šæ›´ | ğŸŸ¢ ä½ | ğŸŸ¡ ä¸­ | ğŸŸ¡ MEDIUM | ç‰ˆæœ¬æª¢æ¸¬ + è‡ªå‹•é©é… |
| IP å°é– | ğŸŸ¢ ä½ | ğŸ”´ é«˜ | ğŸŸ¡ MEDIUM | é™ä½é »ç‡ + çœŸå¯¦è¡Œç‚ºæ¨¡æ“¬ |

#### ç·©è§£ç­–ç•¥

1. **Session ç®¡ç†**: è‡ªå‹•æª¢æ¸¬éæœŸä¸¦åˆ·æ–°ï¼ˆæ¯å°æ™‚ï¼‰
2. **é »ç‡æ§åˆ¶**: é™åˆ¶æ¯åˆ†é˜ 10 æ¬¡è«‹æ±‚
3. **éš¨æ©Ÿå»¶é²**: 1.0-3.0 ç§’éš¨æ©Ÿå»¶é²
4. **æ™‚é•·æ³¢å‹•**: é¿å…å›ºå®šå€¼è§¸ç™¼æª¢æ¸¬ï¼ˆÂ±60 ç§’ï¼‰
5. **çœŸå¯¦è¡Œç‚ºæ¨¡æ“¬**: æ¨¡æ“¬çœŸå¯¦ç”¨æˆ¶æ“ä½œæ¨¡å¼

---

### å¯¦æ–½è¨ˆç•«

#### Phase 1: åŸå‹é©—è­‰ï¼ˆ2-3 å°æ™‚ï¼‰

**ç›®æ¨™**: é©—è­‰ API ç›´æ¥èª¿ç”¨å¯è¡Œæ€§

**ä»»å‹™**:
- [ ] å¯¦ä½œ `VisitDurationClient` é¡åˆ¥
- [ ] å¯¦ä½œ `UserInfoExtractor` é¡åˆ¥
- [ ] ç·¨å¯«æ¸¬è©¦è…³æœ¬
- [ ] é©—è­‰ API å›æ‡‰ï¼ˆ204 No Contentï¼‰
- [ ] é©—è­‰å¿…å¡«æ¬„ä½å®Œæ•´æ€§

**æˆåŠŸæ¨™æº–**:
- âœ… API èª¿ç”¨æˆåŠŸ
- âœ… ä¼ºæœå™¨æ¥æ”¶ä¸¦è¨˜éŒ„æ™‚é•·
- âœ… Session Cookie æœ‰æ•ˆ
- âœ… ç”¨æˆ¶è³‡è¨Šæå–å®Œæ•´

---

#### Phase 2: æ··åˆæ¨¡å¼æ•´åˆï¼ˆ4-6 å°æ™‚ï¼‰

**ç›®æ¨™**: æ•´åˆ Selenium + API æ··åˆæµç¨‹

**ä»»å‹™**:
- [ ] ä¿®æ”¹ `main.py` æ”¯æ´æ··åˆæ¨¡å¼
- [ ] å¯¦ä½œ `SessionManager` é¡åˆ¥
- [ ] å¯¦ä½œ `RateLimiter` é¡åˆ¥
- [ ] æ–°å¢é…ç½®é¸é …ï¼ˆ`config/eebot.cfg`ï¼‰
- [ ] å®Œæ•´æµç¨‹æ¸¬è©¦

---

#### Phase 3: MitmProxy å°åŒ…æ•ç²ï¼ˆ2-3 å°æ™‚ï¼‰

**ç›®æ¨™**: å¯¦ä½œå°åŒ…æ•ç²åŠŸèƒ½

**ä»»å‹™**:
- [ ] å¯¦ä½œ `PacketLogger` æ””æˆªå™¨
- [ ] å¯¦ä½œ `PacketCaptureTool` ä¸»å‹•æ•ç²
- [ ] æ–°å¢å°åŒ…åˆ†æå·¥å…·
- [ ] æ¸¬è©¦æ•ç²åŠŸèƒ½

---

#### Phase 4: æ¸¬è©¦èˆ‡å„ªåŒ–ï¼ˆ3-4 å°æ™‚ï¼‰

**ç›®æ¨™**: å®Œæ•´æ¸¬è©¦èˆ‡æ€§èƒ½å„ªåŒ–

**æ¸¬è©¦æ¸…å–®**:
- [ ] åŠŸèƒ½æ¸¬è©¦ï¼ˆæ‰€æœ‰æ¨¡å¼ï¼‰
- [ ] Session éæœŸæ¸¬è©¦
- [ ] é »ç‡é™åˆ¶æ¸¬è©¦
- [ ] ç•°å¸¸è™•ç†æ¸¬è©¦
- [ ] å£“åŠ›æ¸¬è©¦
- [ ] æ€§èƒ½å„ªåŒ–

---

#### Phase 5: æ–‡æª”èˆ‡äº¤æ¥ï¼ˆ1-2 å°æ™‚ï¼‰

**ç›®æ¨™**: å®Œæ•´æ–‡æª”èˆ‡ä½¿ç”¨æŒ‡å—

**ä»»å‹™**:
- [ ] æ›´æ–° `README.md`
- [ ] æ›´æ–° `CLAUDE_CODE_HANDOVER-2.md`ï¼ˆæœ¬æ–‡æª”ï¼‰
- [ ] æ›´æ–° `CHANGELOG.md`
- [ ] ç·¨å¯« `API_DIRECT_MODE_GUIDE.md`
- [ ] ç·¨å¯« `TROUBLESHOOTING_API_MODE.md`

---

#### ç¸½è¨ˆæ™‚é–“ä¼°ç®—

| Phase | ä»»å‹™ | é è¨ˆæ™‚é–“ | ç‹€æ…‹ |
|-------|------|---------|------|
| Phase 1 | åŸå‹é©—è­‰ | 2-3 å°æ™‚ | â¸ï¸ å¾…æ‰¹å‡† |
| Phase 2 | æ··åˆæ¨¡å¼æ•´åˆ | 4-6 å°æ™‚ | â¸ï¸ å¾…æ‰¹å‡† |
| Phase 3 | å°åŒ…æ•ç²åŠŸèƒ½ | 2-3 å°æ™‚ | â¸ï¸ å¾…æ‰¹å‡† |
| Phase 4 | æ¸¬è©¦èˆ‡å„ªåŒ– | 3-4 å°æ™‚ | â¸ï¸ å¾…æ‰¹å‡† |
| Phase 5 | æ–‡æª”èˆ‡äº¤æ¥ | 1-2 å°æ™‚ | â¸ï¸ å¾…æ‰¹å‡† |
| **ç¸½è¨ˆ** | | **12-18 å°æ™‚** | |

---

### æˆåŠŸæ¨™æº–

#### Phase 1ï¼ˆåŸå‹é©—è­‰ï¼‰
- âœ… API èª¿ç”¨æˆåŠŸï¼ˆå›æ‡‰ 204 No Contentï¼‰
- âœ… ä¼ºæœå™¨æ¥æ”¶ä¸¦è¨˜éŒ„æ™‚é•·
- âœ… Session Cookie æœ‰æ•ˆ
- âœ… ç”¨æˆ¶è³‡è¨Šæå–å®Œæ•´

#### æ•´é«”
- âœ… æ··åˆæ¨¡å¼å®Œæ•´é‹è¡Œ
- âœ… æ•ˆèƒ½æå‡ 10 å€ä»¥ä¸Š
- âœ… éš±åŒ¿æ€§ä¿æŒæœ€é«˜ç­‰ç´š
- âœ… é¢¨éšªæ§åˆ¶åœ¨å¯æ¥å—ç¯„åœ
- âœ… æ–‡æª”å®Œæ•´æ¸…æ™°

---

### ç›¸é—œæ–‡æª”

1. **REFACTORING_PROPOSAL_API_DIRECT_MODE.md** â­ NEW
   - å®Œæ•´é‡æ§‹ææ¡ˆï¼ˆ1,500+ è¡Œï¼‰
   - 3 ç¨®æ–¹æ¡ˆæ¯”è¼ƒåˆ†æ
   - å®Œæ•´ç¨‹å¼ç¢¼ç¯„ä¾‹
   - é¢¨éšªè©•ä¼°èˆ‡ç·©è§£ç­–ç•¥

2. **DAILY_WORK_LOG_20251204_API_DIRECT_MODE.md** â­ NEW
   - å®Œæ•´å·¥ä½œè¨˜éŒ„ï¼ˆ800+ è¡Œï¼‰
   - æŠ€è¡“ç´°ç¯€èˆ‡æµç¨‹åœ–
   - å¯¦æ–½è¨ˆç•«èˆ‡æ™‚é–“ä¼°ç®—

3. **API_DIRECT_MODE_QUICK_REFERENCE.md** â­ NEW
   - 5 åˆ†é˜å¿«é€Ÿåƒè€ƒæ‰‹å†Š
   - æ ¸å¿ƒæ¦‚å¿µèˆ‡ä½¿ç”¨æ–¹å¼
   - å¸¸è¦‹å•é¡Œ FAQ

4. **TEST2_QUICK_REFERENCE.md**
   - API ç«¯é»å¿«é€Ÿåƒè€ƒ
   - æ¬„ä½æ¸…å–®
   - MitmProxy ä»£ç¢¼ç¯„ä¾‹

5. **USER_VISITS_FIELD_MAPPING.json**
   - 19 å€‹æ¬„ä½å®Œæ•´å®šç¾©ï¼ˆJSON æ ¼å¼ï¼‰

---

### ä¸‹ä¸€æ­¥è¡Œå‹•

**å¾…ç”¨æˆ¶æ±ºç­–**:
1. âœ… æ˜¯å¦æ¡ç”¨æ··åˆæ¨¡å¼é‡æ§‹ï¼Ÿ
2. âœ… åŸ·è¡Œå„ªå…ˆç´šï¼Ÿï¼ˆé«˜/ä¸­/ä½ï¼‰
3. âœ… é æœŸå®Œæˆæ™‚é–“ï¼Ÿ

**ç«‹å³å¯åŸ·è¡Œ**ï¼ˆç²å¾—æ‰¹å‡†å¾Œï¼‰:
- Phase 1: åŸå‹é©—è­‰ï¼ˆ2-3 å°æ™‚ï¼‰
- é©—è­‰ API ç›´æ¥èª¿ç”¨å¯è¡Œæ€§
- æ¸¬è©¦ Session èˆ‡ç”¨æˆ¶è³‡è¨Šæå–

---

## ğŸ¯ å·²å®ŒæˆåŠŸèƒ½ï¼šè‡ªå‹•ç­”é¡Œç³»çµ± (Phase 2)

> **ç‹€æ…‹**: âœ… **å·²å¯¦ä½œå®Œæˆ** (2025-11-15)
> **ç‰ˆæœ¬**: 2.0.2+auto-answer
> **å¯¦ä½œè€…**: wizard03 (with Claude Code CLI)
> **ç›®å‰é€²åº¦**: å®Œæ•´çš„è‡ªå‹•ç­”é¡Œç³»çµ±ï¼Œå«æ™ºèƒ½åŒ¹é…å¼•æ“

### åŠŸèƒ½æ¦‚è¿°

è‡ªå‹•ç­”é¡Œç³»çµ±å°‡é€éæ¯”å°è€ƒè©¦é é¢é¡Œç›®èˆ‡é¡Œåº«ç­”æ¡ˆï¼Œå¯¦ç¾è‡ªå‹•ç­”é¡ŒåŠŸèƒ½ã€‚

### é¡Œåº«è³‡æ–™

**ä½ç½®**: `éƒµæ”¿Eå¤§å­¸114å¹´é¡Œåº«/`

**çµ±è¨ˆè³‡æ–™**:
- ç¸½é¡Œæ•¸ï¼š**1,766 é¡Œ**
- ç¸½å¤§å°ï¼š**5.3 MB**
- åˆ†é¡æ•¸ï¼š**23 å€‹ä¸»é¡Œ**
- æ ¼å¼ï¼š**JSON æª”æ¡ˆ**

**ç¯„ä¾‹åˆ†é¡**:
```
çª—å£ç·šä¸Šæ¸¬é©—ï¼ˆ390é¡Œï¼‰
éƒµå‹™çª—å£(114å¹´åº¦)ï¼ˆ188é¡Œï¼‰
æ³•ä»¤éµå¾ªï¼é˜²åˆ¶æ´—éŒ¢ï¼ˆ262é¡Œï¼‰
è³‡é€šå®‰å…¨ï¼ˆ30é¡Œï¼‰
é«˜é½¡æŠ•ä¿ï¼ˆ10é¡Œï¼‰
... å…± 23 å€‹åˆ†é¡
```

---

### è€ƒè©¦é é¢å…ƒç´ åˆ†æ

#### é¡Œç›®å…ƒç´ 
```html
<li class="subject">
    <span class="subject-description">é¡Œç›®å…§å®¹</span>
</li>
```

**å®šä½æ–¹å¼**: `.subject-description` æˆ– `//span[@class='subject-description']`

#### é¸é …å…ƒç´ 

**å–®é¸é¡Œ (Radio)**:
```html
<input type="radio" ng-model="subject.answeredOption" />
<div class="option-content"><span>é¸é …å…§å®¹</span></div>
```

**è¤‡é¸é¡Œ (Checkbox)**:
```html
<input type="checkbox" ng-model="option.checked" />
<div class="option-content"><span>é¸é …å…§å®¹</span></div>
```

**å®šä½æ–¹å¼**: `.option-content`, `input[type="radio"]`, `input[type="checkbox"]`

#### äº¤å·æŒ‰éˆ•
```html
<a class="button button-green" ng-click="calUnsavedSubjects()">äº¤å·</a>
<button ng-click="submitAnswer(...)">ç¢ºå®š</button>
```

**é‡è¦**: è€ƒè©¦æ¡ç”¨**æ•´é é¡¯ç¤º**æ¨¡å¼ï¼ˆæ‰€æœ‰é¡Œç›®åœ¨åŒä¸€é ï¼‰ï¼Œéåˆ†é æ¨¡å¼ã€‚

---

### è³‡æ–™åº«æ–¹æ¡ˆè©•ä¼°

#### æ¨è–¦æ–¹æ¡ˆï¼šæ··åˆæ¨¡å¼ (SQLite + JSON)

| æ–¹æ¡ˆ | é©ç”¨æ€§ | é€Ÿåº¦ | éƒ¨ç½²é›£åº¦ | æ¨è–¦åº¦ |
|------|-------|------|---------|--------|
| **SQLite** | â­â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­â­ (é›¶é…ç½®) | **âœ… å¼·çƒˆæ¨è–¦** |
| JSON | â­â­â­â­â­ | â­â­â­ | â­â­â­â­â­ (ç¾æˆ) | âœ… é©åˆ MVP |
| MySQL | â­â­ | â­â­â­â­â­ | â­â­ (éœ€å®‰è£) | âŒ æ®ºé›ç”¨ç‰›åˆ€ |

**ç‚ºä½•é¸æ“‡ SQLiteï¼Ÿ**
- âœ… é›¶é…ç½®ï¼ˆPython å…§å»º `sqlite3`ï¼‰
- âœ… æª”æ¡ˆå¼ï¼ˆå–®ä¸€ `.db` æª”æ¡ˆï¼‰
- âœ… æŸ¥è©¢é€Ÿåº¦å¿«ï¼ˆæ¯«ç§’ç´šï¼‰
- âœ… æ”¯æ´å…¨æ–‡æª¢ç´¢ï¼ˆFTS5ï¼‰
- âœ… é©åˆ 5.3MB è³‡æ–™é‡

**åˆ†éšæ®µç­–ç•¥**:
```
éšæ®µ 1 (MVP)ï¼šç›´æ¥ä½¿ç”¨ç¾æœ‰ JSON æª”æ¡ˆ
éšæ®µ 2 (å„ªåŒ–)ï¼šé¦–æ¬¡å•Ÿå‹•è‡ªå‹•å»ºç«‹ SQLite
éšæ®µ 3 (æ­£å¼)ï¼šä½¿ç”¨ SQLiteï¼Œä¿ç•™ JSON ä½œå‚™ä»½
```

---

### æ–°å¢æª”æ¡ˆæ¶æ§‹ï¼ˆç¬¦åˆ POM æ¨¡å¼ï¼‰

```
eebot/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”œâ”€â”€ exam_detail_page.py        # ç¾æœ‰ï¼ˆå‹¿æ”¹ï¼‰
â”‚   â”‚   â””â”€â”€ exam_answer_page.py        # ã€æ–°å¢ã€‘ç­”é¡Œé é¢
â”‚   â”‚
â”‚   â”œâ”€â”€ scenarios/
â”‚   â”‚   â”œâ”€â”€ exam_learning.py           # ç¾æœ‰ï¼ˆå‹¿æ”¹ï¼‰
â”‚   â”‚   â””â”€â”€ exam_auto_answer.py        # ã€æ–°å¢ã€‘è‡ªå‹•ç­”é¡Œå ´æ™¯
â”‚   â”‚
â”‚   â”œâ”€â”€ services/                      # ã€æ–°å¢ã€‘æ¥­å‹™é‚è¼¯å±¤
â”‚   â”‚   â”œâ”€â”€ question_bank.py           # é¡Œåº«æŸ¥è©¢æœå‹™
â”‚   â”‚   â””â”€â”€ answer_matcher.py          # ç­”æ¡ˆåŒ¹é…å¼•æ“
â”‚   â”‚
â”‚   â””â”€â”€ models/                        # ã€æ–°å¢ã€‘è³‡æ–™æ¨¡å‹
â”‚       â””â”€â”€ question.py                # é¡Œç›®/é¸é …è³‡æ–™é¡åˆ¥
â”‚
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ courses.json                   # ç¾æœ‰
â”‚   â””â”€â”€ questions.db                   # ã€æ–°å¢ã€‘SQLite è³‡æ–™åº«
â”‚
â””â”€â”€ éƒµæ”¿Eå¤§å­¸114å¹´é¡Œåº«/
    â””â”€â”€ *.json                         # ç¾æœ‰ï¼ˆä¿ç•™ä½œå‚™ä»½ï¼‰
```

---

### æ ¸å¿ƒæ¨¡çµ„è¨­è¨ˆ

#### ExamAnswerPageï¼ˆç­”é¡Œé é¢ç‰©ä»¶ï¼‰
```python
class ExamAnswerPage(BasePage):
    def get_all_questions()              # å–å¾—æ‰€æœ‰é¡Œç›®å…ƒç´ 
    def get_question_text(question_elem) # å–å¾—é¡Œç›®æ–‡å­—
    def get_options(question_elem)       # å–å¾—é¡Œç›®é¸é …
    def get_option_text(option_elem)     # å–å¾—é¸é …æ–‡å­—
    def click_option(option_elem)        # é»æ“Šé¸é …
    def submit_exam()                    # æäº¤è€ƒè©¦
```

#### QuestionBankServiceï¼ˆé¡Œåº«æœå‹™ï¼‰
```python
class QuestionBankService:
    def __init__(mode='sqlite', **kwargs)
    def find_answer(question_text) -> Optional[Dict]
    # è¿”å›ï¼š{question_id, type, correct_options[]}
```

#### AnswerMatcherï¼ˆç­”æ¡ˆåŒ¹é…å¼•æ“ï¼‰
```python
class AnswerMatcher:
    @staticmethod
    def normalize_text(text)             # æ¨™æº–åŒ–æ–‡å­—
    def find_best_match(web_q, db_qs)    # æ¨¡ç³ŠåŒ¹é…
    # å¤šå±¤ç´šå›é€€ï¼š
    # 1. ç²¾ç¢ºåŒ¹é…ï¼ˆæœ€å¿«ï¼‰
    # 2. åŒ…å«åŒ¹é…
    # 3. ç›¸ä¼¼åº¦åŒ¹é…ï¼ˆSequenceMatcherï¼‰
```

---

### åŒ¹é…ç­–ç•¥

#### æŒ‘æˆ°ï¼šç¶²é é¡Œç›® vs é¡Œåº«é¡Œç›®å·®ç•°

| å·®ç•°é¡å‹ | ç¯„ä¾‹ | è§£æ±ºæ–¹æ¡ˆ |
|---------|------|---------|
| HTML æ¨™ç±¤ | `<p>é¡Œç›®</p>` vs `é¡Œç›®` | BeautifulSoup å»é™¤ |
| ç©ºç™½å­—å…ƒ | å¤šç©ºæ ¼ vs å–®ç©ºæ ¼ | æ­£è¦åŒ– |
| æ¨™é»ç¬¦è™Ÿ | å…¨å½¢ vs åŠå½¢ | çµ±ä¸€è½‰æ› |

#### åŒ¹é…ä¿¡å¿ƒé–€æª»

**è¨­å®š**: 0.85ï¼ˆ85% ç›¸ä¼¼åº¦ï¼‰ä»¥é¿å…èª¤é…

---

### SQLite è³‡æ–™è¡¨è¨­è¨ˆ

```sql
-- é¡Œç›®è¡¨
CREATE TABLE questions (
    id INTEGER PRIMARY KEY,
    category TEXT NOT NULL,
    description TEXT NOT NULL,
    description_text TEXT,              -- ç´”æ–‡å­—ç‰ˆï¼ˆç”¨æ–¼åŒ¹é…ï¼‰
    type TEXT NOT NULL,                 -- single_selection/multiple_selection
    difficulty_level TEXT,
    answer_explanation TEXT
);

-- é¸é …è¡¨
CREATE TABLE options (
    id INTEGER PRIMARY KEY,
    question_id INTEGER NOT NULL,
    content TEXT NOT NULL,
    content_text TEXT,                  -- ç´”æ–‡å­—ç‰ˆ
    is_answer BOOLEAN NOT NULL,         -- æ­£ç¢ºç­”æ¡ˆæ¨™è¨˜
    sort INTEGER,
    FOREIGN KEY (question_id) REFERENCES questions(id)
);

-- å…¨æ–‡æª¢ç´¢ç´¢å¼•ï¼ˆé—œéµï¼ï¼‰
CREATE VIRTUAL TABLE questions_fts USING fts5(
    description_text,
    content='questions',
    content_rowid='id'
);
```

---

### å¯¦ä½œéšæ®µè¦åŠƒ

#### éšæ®µ 1ï¼šMVPï¼ˆæœ€å°å¯è¡Œç”¢å“ï¼‰
**ç›®æ¨™**: é©—è­‰è‡ªå‹•ç­”é¡Œå¯è¡Œæ€§

- âœ… ä½¿ç”¨ç¾æœ‰ JSON æª”æ¡ˆ
- âœ… å¯¦ä½œ `QuestionBankService`ï¼ˆJSON æ¨¡å¼ï¼‰
- âœ… å¯¦ä½œåŸºç¤ `AnswerMatcher`
- âœ… å¯¦ä½œ `ExamAnswerPage`
- âœ… æ•´åˆè‡³ `ExamLearningScenario`

**é ä¼°æ™‚é–“**: 2-3 å°æ™‚

#### éšæ®µ 2ï¼šå„ªåŒ–åŒ¹é…æº–ç¢ºåº¦
**ç›®æ¨™**: æå‡åŒ¹é…ç‡

- âœ… æ”¹é€²ç›¸ä¼¼åº¦æ¼”ç®—æ³•
- âœ… è™•ç† HTML æ¸…ç†é‚è¼¯
- âœ… æ–°å¢åŒ¹é…æ—¥èªŒ

**é ä¼°æ™‚é–“**: 2-3 å°æ™‚

#### éšæ®µ 3ï¼šé·ç§»è‡³ SQLite
**ç›®æ¨™**: æ•ˆèƒ½å„ªåŒ–

- âœ… æ’°å¯« JSON â†’ SQLite é·ç§»è…³æœ¬
- âœ… å»ºç«‹ FTS5 å…¨æ–‡æª¢ç´¢ç´¢å¼•
- âœ… å¯¦ä½œ `QuestionBankService`ï¼ˆSQLite æ¨¡å¼ï¼‰

**é ä¼°æ™‚é–“**: 1-2 å°æ™‚

#### éšæ®µ 4ï¼šç”Ÿç”¢å°±ç·’
**ç›®æ¨™**: ç©©å¥èˆ‡å¯ç¶­è­·

- âœ… æ··åˆæ¨¡å¼ï¼ˆé¦–æ¬¡å•Ÿå‹•è‡ªå‹•å»ºç«‹ SQLiteï¼‰
- âœ… è‡ªå‹•åµæ¸¬é¡Œåº«æ›´æ–°
- âœ… å¤±æ•—æ™‚æˆªåœ–é™¤éŒ¯
- âœ… ç”Ÿæˆç­”é¡Œæº–ç¢ºç‡å ±å‘Š

**é ä¼°æ™‚é–“**: 2-3 å°æ™‚

---

### é…ç½®é¸é …ï¼ˆè¦åŠƒï¼‰

#### eebot.cfg æ–°å¢é …ç›®
```ini
# ç¾æœ‰é…ç½®...
user_name=your_username
password=your_password

# æ–°å¢ï¼šè‡ªå‹•ç­”é¡Œé…ç½®
enable_auto_answer=y                     # å•Ÿç”¨è‡ªå‹•ç­”é¡Œ
question_bank_mode=sqlite                # 'sqlite' æˆ– 'json'
question_bank_path=data/questions.db
answer_confidence_threshold=0.85         # æœ€ä½ç›¸ä¼¼åº¦é–€æª»
auto_submit_exam=y                       # è‡ªå‹•æäº¤è€ƒè©¦
screenshot_on_mismatch=y                 # ç„¡æ³•åŒ¹é…æ™‚æˆªåœ–
```

---

### é¢¨éšªè©•ä¼°

| é¢¨éšª | æè¿° | ç·©è§£ç­–ç•¥ |
|------|------|---------|
| **åŒ¹é…å¤±æ•—** | ç¶²é é¡Œç›®èˆ‡é¡Œåº«ä¸ä¸€è‡´ | å¤šå±¤ç´šå›é€€ + ä¿¡å¿ƒé–€æª» |
| **å‹•æ…‹è¼‰å…¥** | AngularJS æ¸²æŸ“å»¶é² | å¢åŠ  WebDriverWait |
| **æª¢æ¸¬é¢¨éšª** | ç¶²ç«™å¯èƒ½åµæ¸¬è‡ªå‹•åŒ– | å·²ä½¿ç”¨ Stealth JS |
| **é¡Œåº«éæœŸ** | é¡Œåº«èˆ‡è€ƒè©¦ä¸åŒæ­¥ | è¨˜éŒ„å¤±æ•—æ¡ˆä¾‹ |

---

### æˆåŠŸæ¨™æº–

**MVP æˆåŠŸ**:
- [ ] æˆåŠŸåŒ¹é… â‰¥80% é¡Œç›®
- [ ] è‡ªå‹•é»æ“Šæ­£ç¢ºé¸é …ï¼ˆå–®é¸ï¼‰
- [ ] è‡ªå‹•é»æ“Šæ­£ç¢ºé¸é …ï¼ˆè¤‡é¸ï¼‰
- [ ] è‡ªå‹•æäº¤è€ƒè©¦

**æ­£å¼ç‰ˆæˆåŠŸ**:
- [ ] åŒ¹é…ç‡ â‰¥95%
- [ ] SQLite æŸ¥è©¢ <10ms/é¡Œ
- [ ] é›¶èª¤ç­”ï¼ˆç„¡èª¤åˆ¤ï¼‰
- [ ] å„ªé›…è™•ç†æœªåŒ¹é…é¡Œç›®

---

### âœ… å¯¦ä½œå®Œæˆç¸½çµ (2025-11-15)

**å¯¦ä½œç‹€æ…‹**: âœ… æ‰€æœ‰è¦åŠƒåŠŸèƒ½å·²å®Œæ•´å¯¦ä½œ

**æ–°å¢æª”æ¡ˆ**:
```
src/models/
â”œâ”€â”€ __init__.py
â””â”€â”€ question.py                  # è³‡æ–™æ¨¡å‹

src/services/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ question_bank.py             # é¡Œåº«æœå‹™
â””â”€â”€ answer_matcher.py            # åŒ¹é…å¼•æ“

src/pages/
â””â”€â”€ exam_answer_page.py          # ç­”é¡Œé é¢

src/scenarios/
â””â”€â”€ exam_auto_answer.py          # è‡ªå‹•ç­”é¡Œå ´æ™¯
```

**ä¿®æ”¹æª”æ¡ˆ**:
- `config/eebot.cfg` - æ–°å¢ AUTO_ANSWER é…ç½®å€å¡Š
- `main.py` - æ•´åˆè‡ªå‹•ç­”é¡Œå ´æ™¯
- `requirements.txt` - æ–°å¢ beautifulsoup4 ä¾è³´

**ä½¿ç”¨æ–¹å¼**:
```bash
# 1. å®‰è£ä¾è³´
pip install beautifulsoup4

# 2. è¨­å®šæ’ç¨‹
python menu.py

# 3. åŸ·è¡Œè‡ªå‹•ç­”é¡Œï¼ˆenable_auto_answer=yï¼‰
python main.py
```

**æ ¸å¿ƒåŠŸèƒ½**:
- âœ… è‡ªå‹•åµæ¸¬é¡Œç›®æ•¸é‡èˆ‡é¡Œå‹
- âœ… å¤šå±¤ç´šåŒ¹é…æ¼”ç®—æ³• (85% é–€æª»)
- âœ… å–®é¸/è¤‡é¸é¡Œè‡ªå‹•ä½œç­”
- âœ… æœªåŒ¹é…é¡Œç›®æˆªåœ–è¨˜éŒ„
- âœ… ç­”é¡Œçµ±è¨ˆå ±å‘Š
- âœ… ä½¿ç”¨è€…ç¢ºèªäº¤å·æ©Ÿåˆ¶

---

**å¯¦ä½œç‰ˆæœ¬**: 2.0.2+auto-answer
**å¯¦ä½œè€…**: wizard03 (with Claude Code CLI - Sonnet 4.5)
**å¯¦ä½œæ—¥æœŸ**: 2025-11-15
**ç‹€æ…‹**: âœ… **å·²å®Œæˆä¸¦å¯ä½¿ç”¨**

**è©³ç´°è®Šæ›´è¨˜éŒ„**: è«‹åƒè€ƒ `CHANGELOG.md` ç‰ˆæœ¬ 2.0.2+auto-answer
**æŠ€è¡“ç´°ç¯€**: è«‹åƒè€ƒ `docs/AI_ASSISTANT_GUIDE.md` Phase 2 ç« ç¯€

---

## ğŸš€ æ™ºèƒ½æ¨¡å¼ï¼šæŒ‰èª²ç¨‹å•Ÿç”¨è‡ªå‹•ç­”é¡Œ (2025-11-15 æ›´æ–°)

> **é‡å¤§è®Šæ›´**: è‡ªå‹•ç­”é¡Œé‚è¼¯å¾å…¨å±€å•Ÿç”¨æ”¹ç‚ºæŒ‰èª²ç¨‹å•Ÿç”¨

### è®Šæ›´æ¦‚è¿°

**èˆŠé‚è¼¯** (v2.0.2+auto-answer):
- å…¨å±€ `enable_auto_answer` è¨­å®šæ–¼ `config/eebot.cfg`
- æ‰€æœ‰è€ƒè©¦çµ±ä¸€å•Ÿç”¨æˆ–åœç”¨è‡ªå‹•ç­”é¡Œ
- éœ€ä¿®æ”¹é…ç½®æª”æ‰èƒ½åˆ‡æ›æ¨¡å¼

**æ–°é‚è¼¯** (v2.0.2+auto-answer Smart Mode):
- æ¯å€‹è€ƒè©¦ç¨ç«‹è¨­å®š `enable_auto_answer` æ–¼ `data/courses.json`
- ä¸åŒè€ƒè©¦å¯é¸æ“‡ä¸åŒæ¨¡å¼ï¼ˆè‡ªå‹•/æ‰‹å‹•ï¼‰
- è‡ªå‹•åµæ¸¬è€ƒå·å€é é¢å¾Œæ‰å•Ÿå‹•
- æ‡¶åŠ è¼‰æ©Ÿåˆ¶ï¼ˆåƒ…åœ¨éœ€è¦æ™‚è¼‰å…¥é¡Œåº«ï¼‰

### é…ç½®è®Šæ›´

#### 1. èª²ç¨‹é…ç½® (courses.json)

**æ–°å¢ `enable_auto_answer` æ¬„ä½**:

```json
{
  "program_name": "é«˜é½¡å®¢æˆ¶æŠ•ä¿æ¬Šç›Šä¿éšœ(114å¹´åº¦)",
  "exam_name": "é«˜é½¡æ¸¬é©—(100åˆ†åŠæ ¼)",
  "course_type": "exam",
  "enable_auto_answer": true,    // æ–°å¢ï¼šå•Ÿç”¨æ­¤è€ƒè©¦çš„è‡ªå‹•ç­”é¡Œ
  "delay": 7.0,
  "description": "é«˜é½¡æ¸¬é©— - è‡ªå‹•ç­”é¡Œ"
}
```

**æœªè¨­å®šå‰‡é è¨­ç‚ºæ‰‹å‹•æ¨¡å¼**:

```json
{
  "program_name": "å…¶ä»–è€ƒè©¦(114å¹´åº¦)",
  "exam_name": "å…¶ä»–æ¸¬é©—",
  "course_type": "exam",
  // æœªè¨­å®š enable_auto_answer â†’ æ‰‹å‹•æ¨¡å¼
  "delay": 7.0,
  "description": "éœ€æ‰‹å‹•å®Œæˆ"
}
```

#### 2. ç³»çµ±é…ç½® (eebot.cfg)

**æ¨è–¦è¨­å®š**: æ”¹ç”¨ `file_mapping` æ¨¡å¼

```ini
[AUTO_ANSWER]
enable_auto_answer = y                          # ä¿ç•™ï¼ˆèˆŠç‰ˆç›¸å®¹ï¼‰
question_bank_mode = file_mapping               # å¾ 'total_bank' æ”¹ç‚ºæ­¤
question_bank_path = éƒµæ”¿Eå¤§å­¸114å¹´é¡Œåº«/ç¸½é¡Œåº«.json
answer_confidence_threshold = 0.85
auto_submit_exam = n
screenshot_on_mismatch = y
skip_unmatched_questions = y
screenshot_dir = screenshots/unmatched
```

### å·¥ä½œæµç¨‹è®Šæ›´

#### èˆŠæµç¨‹ï¼ˆå…¨å±€æ¨¡å¼ï¼‰
```
1. ç·¨è¼¯ config/eebot.cfg â†’ è¨­å®š enable_auto_answer=y
2. åŸ·è¡Œ python menu.py â†’ é¸æ“‡è€ƒè©¦
3. åŸ·è¡Œ python main.py â†’ æ‰€æœ‰è€ƒè©¦è‡ªå‹•ç­”é¡Œ
4. å¦‚éœ€åœç”¨ï¼Œå†ç·¨è¼¯ config/eebot.cfg
```

#### æ–°æµç¨‹ï¼ˆæ™ºèƒ½æ¨¡å¼ï¼‰
```
1. ç·¨è¼¯ data/courses.json â†’ ç‚ºç‰¹å®šè€ƒè©¦åŠ å…¥ "enable_auto_answer": true
2. åŸ·è¡Œ python menu.py â†’ é¸æ“‡è€ƒè©¦
3. åŸ·è¡Œ python main.py â†’ åªæœ‰æ¨™è¨˜çš„è€ƒè©¦è‡ªå‹•ç­”é¡Œ
4. ç³»çµ±è‡ªå‹•åµæ¸¬è€ƒå·å€å¾Œæ‰å•Ÿå‹•
```

### æŠ€è¡“å¯¦ä½œç´°ç¯€

#### 1. è€ƒå·å€é é¢åµæ¸¬

**æ–°å¢æ–¹æ³•**: `_is_in_exam_answer_page()` æ–¼ `ExamLearningScenario`

```python
def _is_in_exam_answer_page(self) -> bool:
    """åµæ¸¬æ˜¯å¦é€²å…¥è€ƒå·å€é é¢"""
    try:
        driver = self.driver_manager.get_driver()
        WebDriverWait(driver, 5).until(
            EC.presence_of_element_located((By.CSS_SELECTOR, "li.subject"))
        )
        questions = driver.find_elements(By.CSS_SELECTOR, "li.subject")
        if len(questions) > 0:
            print(f'  âœ… åµæ¸¬åˆ°è€ƒå·å€é é¢ï¼ˆå…± {len(questions)} é¡Œï¼‰')
            return True
        return False
    except Exception as e:
        print(f'  âš ï¸  è€ƒå·å€æª¢æ¸¬å¤±æ•—: {e}')
        return False
```

**ç›®çš„**: é˜²æ­¢åœ¨éŒ¯èª¤é é¢å•Ÿå‹•è‡ªå‹•ç­”é¡Œ

#### 2. æ‡¶åŠ è¼‰æ©Ÿåˆ¶

**èˆŠæ–¹å¼**: ç‚ºæ‰€æœ‰è€ƒè©¦è¼‰å…¥é¡Œåº«å’ŒåŒ¹é…å™¨

**æ–°æ–¹å¼**: åƒ…åœ¨éœ€è¦æ™‚æ‰åˆå§‹åŒ–

```python
class ExamLearningScenario:
    def __init__(self, config, keep_browser_on_error=False):
        # ... ç¾æœ‰ä»£ç¢¼ ...
        self.exam_answer_page = ExamAnswerPage(driver)
        self.question_bank = None      # æ‡¶åŠ è¼‰
        self.answer_matcher = None     # æ‡¶åŠ è¼‰

    def _auto_answer_current_exam(self, exam):
        """åƒ…åœ¨éœ€è¦æ™‚åˆå§‹åŒ–é¡Œåº«"""
        if self.question_bank is None:
            print('[åˆå§‹åŒ–] è¼‰å…¥é¡Œåº«...')
            self.question_bank = QuestionBankService(self.config)
            question_count = self.question_bank.load_question_bank(
                exam.get('program_name')
            )

        if self.answer_matcher is None:
            print('[åˆå§‹åŒ–] è¼‰å…¥ç­”æ¡ˆåŒ¹é…å™¨...')
            self.answer_matcher = AnswerMatcher(self.config)
```

**å„ªé»**:
- ç¯€çœè¨˜æ†¶é«”ï¼ˆæ‰‹å‹•è€ƒè©¦ä¸è¼‰å…¥ï¼‰
- åŠ å¿«å•Ÿå‹•é€Ÿåº¦
- åªè¼‰å…¥ç›¸é—œé¡Œåº«ï¼ˆfile_mapping æ¨¡å¼ï¼‰

#### 3. æ¢ä»¶å•Ÿå‹•é‚è¼¯

**æ–°æµç¨‹** (æ–¼ `_process_exam()` ä¸­):

```python
def _process_exam(self, exam: Dict[str, any]):
    # ... ç¾æœ‰è€ƒè©¦æµç¨‹ï¼ˆç™»å…¥ã€å°èˆªã€é»æ“Šè€ƒè©¦ï¼‰...

    # æ–°å¢ï¼šæª¢æŸ¥è©²è€ƒè©¦æ˜¯å¦å•Ÿç”¨è‡ªå‹•ç­”é¡Œ
    enable_auto_answer = exam.get('enable_auto_answer', False)

    if enable_auto_answer and self._is_in_exam_answer_page():
        print('ã€è‡ªå‹•ç­”é¡Œæ¨¡å¼å•Ÿå‹•ã€‘')
        self._auto_answer_current_exam(exam)
    else:
        print('è«‹æ‰‹å‹•å®Œæˆè€ƒè©¦')
        input('å®Œæˆå¾ŒæŒ‰ Enter ç¹¼çºŒ...')
```

**æ±ºç­–æ¨¹**:
```
æ˜¯å¦ enable_auto_answer=true?
  â”œâ”€ å¦ â†’ æ‰‹å‹•æ¨¡å¼ï¼ˆç­‰å¾…ä½¿ç”¨è€…ï¼‰
  â””â”€ æ˜¯ â†’ æª¢æŸ¥æ˜¯å¦åœ¨è€ƒå·å€é é¢
      â”œâ”€ å¦ â†’ æ‰‹å‹•æ¨¡å¼ï¼ˆé é¢éŒ¯èª¤ï¼‰
      â””â”€ æ˜¯ â†’ è‡ªå‹•ç­”é¡Œæ¨¡å¼ï¼ˆå•Ÿå‹•ï¼‰
```

### ä¸»ç¨‹å¼ç°¡åŒ–

**èˆŠæ–¹å¼**: å…©å€‹åˆ†é›¢çš„å ´æ™¯

```python
# èˆŠä»£ç¢¼ï¼ˆå·²ç§»é™¤ï¼‰
if enable_auto_answer:
    exam_scenario = ExamAutoAnswerScenario(...)
else:
    exam_scenario = ExamLearningScenario(...)
```

**æ–°æ–¹å¼**: çµ±ä¸€å ´æ™¯

```python
# æ–°ä»£ç¢¼ï¼ˆç°¡åŒ–ï¼‰
exam_scenario = ExamLearningScenario(config, keep_browser_on_error)
exam_scenario.execute(exams)
# æ¯å€‹è€ƒè©¦å…§éƒ¨è‡ªè¡Œæ±ºå®šæ¨¡å¼
```

**å„ªé»**:
- å–®ä¸€ç€è¦½å™¨æœƒè©±è™•ç†æ‰€æœ‰è€ƒè©¦
- ç„¡éœ€åœ¨è€ƒè©¦é–“é‡å•Ÿç€è¦½å™¨
- main.py ä»£ç¢¼æ›´ç°¡æ½”

### é‡è¦ Bug ä¿®å¾© (2025-11-15)

#### 1. UTF-8 BOM ç·¨ç¢¼
**å•é¡Œ**: JSON æª”æ¡ˆå«æœ‰ UTF-8 BOM æ¨™è¨˜
**è§£æ±º**: æ‰€æœ‰ JSON è®€å–æ”¹ç”¨ `encoding='utf-8-sig'`

**å½±éŸ¿æª”æ¡ˆ**:
- `src/services/question_bank.py` (2 è™•)
- `main.py` (1 è™•)
- `menu.py` (3 è™•)

#### 2. åˆ†é çµæ§‹è§£æ
**å•é¡Œ**: é¡Œåº«æª”æ¡ˆä½¿ç”¨ `[{"subjects": [...]}]` åˆ†é çµæ§‹
**è§£æ±º**: `_load_specific_bank()` æ–°å¢åˆ†é åµæ¸¬è™•ç†

```python
if isinstance(data[0], dict) and 'subjects' in data[0]:
    # åˆ†é çµæ§‹
    for page in data:
        if 'subjects' in page:
            for subject in page['subjects']:
                # è™•ç†é¡Œç›®
```

#### 3. å…ƒç´ äº’å‹•å•é¡Œ
**å•é¡Œ**: äº¤å·æŒ‰éˆ•ç„¡æ³•é»æ“Š (element not interactable)
**è§£æ±º**: ä½¿ç”¨ JavaScript é»æ“Š + ç²¾ç¢º XPath

```python
# æ›´æ–°å®šä½å™¨ (exam_answer_page.py)
SUBMIT_BUTTON = (By.XPATH, "/html/body/div[3]/div[4]/div[3]/div[9]/div/div/div[3]/div/div[3]/a")
CONFIRM_BUTTON = (By.XPATH, "//*[@id='submit-exam-confirmation-popup']/div/div[3]/div/button[1]")

# JavaScript é»æ“Š
self.driver.execute_script("arguments[0].click();", submit_btn)
time.sleep(3)
```

#### 4. QuestionBankService åˆå§‹åŒ–
**å•é¡Œ**: ä½¿ç”¨éŒ¯èª¤åƒæ•¸ `mode=...`, `total_bank_path=...`
**è§£æ±º**: æ­£ç¢ºåˆå§‹åŒ–æ–¹å¼

```python
self.question_bank = QuestionBankService(self.config)
question_count = self.question_bank.load_question_bank(exam.get('program_name'))
```

#### 5. æ–¹æ³•åç¨±ä¸ä¸€è‡´
**å•é¡Œ**: `get_all_questions()` ç­‰æ–¹æ³•ä¸å­˜åœ¨
**è§£æ±º**: çµ±ä¸€å‘½å

```python
# æ­£ç¢ºçš„æ–¹æ³•åç¨± (ExamAnswerPage)
detect_questions()             # é get_all_questions()
extract_question_text()        # é get_question_text()
extract_options()              # é get_options()
submit_exam_with_confirmation() # é submit_exam()
```

#### 6. å›å‚³å‹åˆ¥è™•ç†
**å•é¡Œ**: `find_best_match()` å›å‚³ tuple é dict
**è§£æ±º**: æ­£ç¢ºçš„ tuple è§£åŒ…

```python
match_result = self.answer_matcher.find_best_match(question_text, questions)
if match_result is None:
    # è™•ç†ç„¡åŒ¹é…
else:
    db_question, confidence = match_result  # tuple è§£åŒ…
```

### æ¸¬è©¦çµæœ

**æ¸¬è©¦èª²ç¨‹**: é«˜é½¡å®¢æˆ¶æŠ•ä¿æ¬Šç›Šä¿éšœè€ƒè©¦

| é …ç›® | çµæœ |
|-----|------|
| é¡Œåº«è¼‰å…¥ | 10 é¡Œ |
| åŒ¹é…æˆåŠŸ | 10/10 (100%) |
| åŒ¹é…ä¿¡å¿ƒåº¦ | 95-100% |
| è‡ªå‹•ä½œç­” | âœ… å…¨éƒ¨æ­£ç¢º |
| è€ƒè©¦æäº¤ | âœ… æˆåŠŸ |

### ä½¿ç”¨ç¯„ä¾‹

#### ç¯„ä¾‹ 1: ç‚ºç‰¹å®šè€ƒè©¦å•Ÿç”¨è‡ªå‹•ç­”é¡Œ

**æ­¥é©Ÿ 1**: ç·¨è¼¯ `data/courses.json`

```json
{
  "description": "èª²ç¨‹è³‡æ–™é…ç½®æª”",
  "version": "1.0",
  "courses": [
    {
      "program_name": "é«˜é½¡å®¢æˆ¶æŠ•ä¿æ¬Šç›Šä¿éšœ(114å¹´åº¦)",
      "exam_name": "é«˜é½¡æ¸¬é©—(100åˆ†åŠæ ¼)",
      "course_type": "exam",
      "enable_auto_answer": true,    // å•Ÿç”¨æ­¤è€ƒè©¦
      "delay": 7.0,
      "description": "é«˜é½¡æ¸¬é©— - è‡ªå‹•ç­”é¡Œ"
    },
    {
      "program_name": "è³‡é€šå®‰å…¨æ¸¬é©—(114å¹´åº¦)",
      "exam_name": "è³‡é€šå®‰å…¨æ¸¬é©—",
      "course_type": "exam",
      "enable_auto_answer": true,    // å•Ÿç”¨æ­¤è€ƒè©¦
      "delay": 7.0,
      "description": "è³‡é€šå®‰å…¨æ¸¬é©— - è‡ªå‹•ç­”é¡Œ"
    },
    {
      "program_name": "å…¶ä»–è€ƒè©¦(114å¹´åº¦)",
      "exam_name": "å…¶ä»–æ¸¬é©—",
      "course_type": "exam",
      // æœªè¨­å®š â†’ æ‰‹å‹•æ¨¡å¼
      "delay": 7.0,
      "description": "å…¶ä»–æ¸¬é©— - æ‰‹å‹•å®Œæˆ"
    }
  ]
}
```

**æ­¥é©Ÿ 2**: æ’ç¨‹èˆ‡åŸ·è¡Œ

```bash
python menu.py
# é¸æ“‡ä¸‰å€‹è€ƒè©¦

python main.py
# è€ƒè©¦ 1 (é«˜é½¡æ¸¬é©—): è‡ªå‹•ç­”é¡Œ âœ…
# è€ƒè©¦ 2 (è³‡é€šå®‰å…¨æ¸¬é©—): è‡ªå‹•ç­”é¡Œ âœ…
# è€ƒè©¦ 3 (å…¶ä»–æ¸¬é©—): æ‰‹å‹•æ¨¡å¼ â¸ï¸
```

#### ç¯„ä¾‹ 2: æ··åˆèª²ç¨‹èˆ‡è€ƒè©¦æ’ç¨‹

```bash
python menu.py
# é¸æ“‡:
# [1] èª²ç¨‹ A (ä¸€èˆ¬èª²ç¨‹)
# [2] èª²ç¨‹ B (ä¸€èˆ¬èª²ç¨‹)
# [3] è€ƒè©¦ A (enable_auto_answer: true)
# [4] è€ƒè©¦ B (enable_auto_answer: false)

python main.py
# åŸ·è¡Œé †åº:
# 1. èª²ç¨‹ A â†’ è‡ªå‹•å®Œæˆ âœ…
# 2. èª²ç¨‹ B â†’ è‡ªå‹•å®Œæˆ âœ…
# 3. è€ƒè©¦ A â†’ è‡ªå‹•ç­”é¡Œ âœ…
# 4. è€ƒè©¦ B â†’ æ‰‹å‹•æ¨¡å¼ â¸ï¸
```

### å‘å¾Œç›¸å®¹æ€§

**ç›¸å®¹æ€§èªªæ˜**:
- âœ… æœªè¨­å®š `enable_auto_answer` çš„è€ƒè©¦é è¨­ç‚ºæ‰‹å‹•æ¨¡å¼
- âœ… åŸæœ‰æ‰‹å‹•è€ƒè©¦æµç¨‹å®Œå…¨ä¿ç•™
- âœ… æ‰€æœ‰èª²ç¨‹å­¸ç¿’åŠŸèƒ½ä¸å—å½±éŸ¿
- âœ… é…ç½®æª” `enable_auto_answer` ä¿ç•™ä½†ä½œç”¨æ”¹è®Š

**ç ´å£æ€§è®Šæ›´**:
- âŒ å…¨å±€ `enable_auto_answer` ä¸å†æ§åˆ¶æ‰€æœ‰è€ƒè©¦
- âŒ å¿…é ˆç‚ºæ¯å€‹è€ƒè©¦æ˜ç¢ºè¨­å®šé…ç½®
- âŒ `ExamAutoAnswerScenario` é¡åˆ¥å·²ç§»é™¤ï¼ˆåŠŸèƒ½æ•´åˆè‡³ `ExamLearningScenario`ï¼‰

### é·ç§»æŒ‡å—

**å¦‚æœä½ æ­£åœ¨ä½¿ç”¨å…¨å±€ `enable_auto_answer`**:

1. ä¿ç•™ `enable_auto_answer=y` æ–¼ `config/eebot.cfg`ï¼ˆå‘å¾Œç›¸å®¹ï¼‰
2. ç‚ºéœ€è¦è‡ªå‹•ç­”é¡Œçš„è€ƒè©¦åŠ å…¥ `"enable_auto_answer": true`
3. å°‡ `question_bank_mode` æ”¹ç‚º `file_mapping` æå‡æº–ç¢ºåº¦
4. ç§»é™¤èˆŠçš„ `ExamAutoAnswerScenario` åŒ¯å…¥ï¼ˆå¦‚æœæœ‰ï¼‰

### æœ€ä½³å¯¦è¸

#### 1. å…ˆæ‰‹å‹•æ¸¬è©¦
```json
{
  "enable_auto_answer": false,  // æˆ–çœç•¥æ­¤æ¬„ä½
  "description": "å…ˆæ‰‹å‹•æ¸¬è©¦"
}
```

#### 2. ç¢ºèªé¡Œåº«å°æ‡‰
æª¢æŸ¥ `src/services/question_bank.py` ä¸­çš„ program name å°æ‡‰:

```python
QUESTION_BANK_MAPPING = {
    "é«˜é½¡å®¢æˆ¶æŠ•ä¿æ¬Šç›Šä¿éšœ(114å¹´åº¦)": "é«˜é½¡æŠ•ä¿ï¼ˆ10é¡Œï¼‰.json",
    "è³‡é€šå®‰å…¨æ¸¬é©—(114å¹´åº¦)": "è³‡é€šå®‰å…¨ï¼ˆ30é¡Œï¼‰.json",
    "å£½éšªæ¥­å‹™å“¡åœ¨è·è¨“ç·´å­¸ç¨‹èª²ç¨‹åŠæ¸¬é©—(114å¹´åº¦)": "å£½éšªæ¥­å‹™å“¡åœ¨è·è¨“ç·´ï¼ˆ30é¡Œï¼‰.json",
    # æ ¹æ“šéœ€æ±‚æ–°å¢æ›´å¤šå°æ‡‰
}
```

#### 3. ç›£æ§åŒ¹é…æˆåŠŸç‡
è§€å¯Ÿçµ‚ç«¯è¼¸å‡º:
```
[åŒ¹é…] ç¬¬ 1 é¡Œ: é¡Œç›®å…§å®¹
  âœ… åŒ¹é…æˆåŠŸï¼ˆä¿¡å¿ƒ: 100.00%ï¼‰
  âœ… æ­£ç¢ºç­”æ¡ˆ: ['é¸é …1', 'é¸é …2']
```

#### 4. æª¢è¦–å¤±æ•—æˆªåœ–
æœªåŒ¹é…é¡Œç›®å„²å­˜æ–¼ `screenshots/unmatched/`:
```
question_5_20251115_143022.png
question_5_20251115_143022.txt  // å«é¡Œç›®æ–‡å­—
```

### å•é¡Œæ’æŸ¥

#### å•é¡Œ 1: è‡ªå‹•ç­”é¡Œæœªå•Ÿå‹•

**æª¢æŸ¥**:
1. `courses.json` ä¸­æ˜¯å¦è¨­å®š `"enable_auto_answer": true`ï¼Ÿ
2. æ˜¯å¦æˆåŠŸé€²å…¥è€ƒå·å€é é¢ï¼Ÿ
3. æŸ¥çœ‹çµ‚ç«¯æ˜¯å¦æœ‰é é¢åµæ¸¬è¨Šæ¯

**é™¤éŒ¯è¼¸å‡º**:
```
âœ… åµæ¸¬åˆ°è€ƒå·å€é é¢ï¼ˆå…± 10 é¡Œï¼‰
ã€è‡ªå‹•ç­”é¡Œæ¨¡å¼å•Ÿå‹•ã€‘
[åˆå§‹åŒ–] è¼‰å…¥é¡Œåº«...
```

#### å•é¡Œ 2: é¡Œç›®ç„¡æ³•åŒ¹é…

**æª¢æŸ¥**:
1. `question_bank_mode` æ˜¯å¦æ­£ç¢ºè¨­å®šï¼Ÿ
2. program name æ˜¯å¦ç²¾ç¢ºå°æ‡‰é¡Œåº«å°æ‡‰è¡¨ï¼Ÿ
3. ä¿¡å¿ƒé–€æª»æ˜¯å¦éé«˜ï¼ˆé è¨­ 0.85ï¼‰

**é™¤éŒ¯è¼¸å‡º**:
```
[è¼‰å…¥] é¡Œåº«æª”æ¡ˆ: éƒµæ”¿Eå¤§å­¸114å¹´é¡Œåº«/é«˜é½¡æŠ•ä¿ï¼ˆ10é¡Œï¼‰.json
[æˆåŠŸ] è¼‰å…¥é¡Œåº«: 10 é¡Œ
```

#### å•é¡Œ 3: äº¤å·æŒ‰éˆ•ç„¡æ³•ä½¿ç”¨

**æª¢æŸ¥**:
1. `exam_answer_page.py` ä¸­çš„ XPath å®šä½å™¨
2. é»æ“Šé–“çš„ç­‰å¾…æ™‚é–“ï¼ˆé è¨­ 3 ç§’ï¼‰
3. JavaScript åŸ·è¡Œæ˜¯å¦å•Ÿç”¨

**è§£æ±ºæ–¹æ¡ˆ**: å®šä½å™¨å·²æ›´æ–°ç‚ºä½¿ç”¨è€…æä¾›çš„ç²¾ç¢º XPath

#### å•é¡Œ 4: ç¬¬äºŒå€‹è€ƒè©¦ 0% åŒ¹é…ç‡ (åš´é‡ Bug - å·²ä¿®å¾©)

**ç—‡ç‹€**:
- ç¬¬ä¸€å€‹è€ƒè©¦: 100% åŒ¹é…ç‡ âœ…
- ç¬¬äºŒå€‹è€ƒè©¦: 0% åŒ¹é…ç‡ âŒ
- æ‰€æœ‰é¡Œç›®é¡¯ç¤ºã€Œç„¡æ³•åŒ¹é…ã€

**æ ¹æœ¬åŸå› **:
`src/scenarios/exam_learning.py:261` çš„æ‡¶è¼‰å…¥é‚è¼¯éŒ¯èª¤ï¼Œå°è‡´å¤šå€‹è€ƒè©¦å…±ç”¨åŒä¸€å€‹é¡Œåº«å¯¦ä¾‹ã€‚

**å•é¡Œæ©Ÿåˆ¶**:
```python
# âŒ éŒ¯èª¤ä»£ç¢¼ï¼ˆä¿®å¾©å‰ï¼‰
if self.question_bank is None:
    self.question_bank = QuestionBankService(self.config)
    question_count = self.question_bank.load_question_bank(exam.get('program_name'))
```

1. è€ƒè©¦ 1 è¼‰å…¥é¡Œåº« Aï¼ˆä¾‹å¦‚ï¼šé«˜é½¡æŠ•ä¿ 10 é¡Œï¼‰
2. `self.question_bank` ä¸å†æ˜¯ `None`
3. è€ƒè©¦ 2 è·³éåˆå§‹åŒ–
4. è€ƒè©¦ 2 å˜—è©¦ç”¨éŒ¯èª¤çš„é¡Œåº« A åŒ¹é…é¡Œåº« B çš„é¡Œç›®
5. çµæœï¼š0% åŒ¹é…ç‡

**ä¿®å¾©æ–¹æ¡ˆ** (v2.0.2+auto-answer.1):
```python
# âœ… ä¿®å¾©å¾Œä»£ç¢¼
# ç‚ºæ¯å€‹è€ƒè©¦é‡æ–°è¼‰å…¥å°æ‡‰é¡Œåº«
self.question_bank = QuestionBankService(self.config)
program_name = exam.get('program_name')
question_count = self.question_bank.load_question_bank(program_name)
```

**é—œéµæ”¹è®Š**:
- âœ… ç§»é™¤ `if self.question_bank is None` æª¢æŸ¥
- âœ… æ¯å€‹è€ƒè©¦éƒ½å‰µå»ºæ–°çš„ `QuestionBankService` å¯¦ä¾‹
- âœ… æ¯å€‹è€ƒè©¦éƒ½è¼‰å…¥å°æ‡‰çš„é¡Œåº«
- âœ… æ–°å¢ program_name æ—¥èªŒè¼¸å‡º

**é©—è­‰æ–¹å¼**:
åŸ·è¡ŒåŒ…å«å¤šå€‹è€ƒè©¦çš„æµç¨‹ï¼Œæ‡‰çœ‹åˆ°æ¯å€‹è€ƒè©¦éƒ½æ­£ç¢ºè¼‰å…¥å°æ‡‰é¡Œåº«ï¼š
```
--- Processing Exam 1/2 ---
  ğŸ“š æ­£åœ¨è¼‰å…¥é¡Œåº«...
  âœ… é¡Œåº«å·²è¼‰å…¥ï¼ˆå…± 10 é¡Œï¼‰
  ğŸ“‹ èª²ç¨‹åç¨±: é«˜é½¡å®¢æˆ¶æŠ•ä¿æ¬Šç›Šä¿éšœ(114å¹´åº¦)

--- Processing Exam 2/2 ---
  ğŸ“š æ­£åœ¨è¼‰å…¥é¡Œåº«...
  âœ… é¡Œåº«å·²è¼‰å…¥ï¼ˆå…± 21 é¡Œï¼‰
  ğŸ“‹ èª²ç¨‹åç¨±: é‡‘èæœå‹™æ¥­å…¬å¹³å¾…å®¢åŸå‰‡ï¼†æ´—éŒ¢é˜²åˆ¶åŠæ‰“æ“Šè³‡ææ•™è‚²è¨“ç·´(114å¹´åº¦)
```

**âš ï¸ é‡è¦ç¶“é©—**:
> **æ‡¶è¼‰å…¥ + å…±äº«ç‹€æ…‹ = æ½›åœ¨ Bug**
>
> ç•¶ç‰©ä»¶å¯¦ä¾‹è¢«é‡è¤‡ä½¿ç”¨è™•ç†ä¸åŒè³‡æ–™é›†æ™‚ï¼š
> - âŒ ä¸è¦åœ¨ä¸æª¢æŸ¥è³‡æ–™ä¸Šä¸‹æ–‡çš„æƒ…æ³ä¸‹ä½¿ç”¨æ‡¶è¼‰å…¥
> - âœ… è™•ç†æ–°è³‡æ–™æ™‚å‹™å¿…é‡æ–°è¼‰å…¥è³‡æº
> - âœ… åŠ å…¥æ—¥èªŒè¿½è¹¤è¼‰å…¥çš„è³‡æº
> - âœ… æ¸¬è©¦å¤šå€‹é€£çºŒæ“ä½œçš„å ´æ™¯

**ç¨‹å¼ç¢¼å¯©æŸ¥æª¢æŸ¥æ¸…å–®**:
- [ ] æ˜¯å¦æœ‰æ‡¶è¼‰å…¥é‚è¼¯ï¼ˆ`if self.resource is None`ï¼‰ï¼Ÿ
- [ ] è©²å¯¦ä¾‹æ˜¯å¦æœƒè¢«é‡è¤‡ä½¿ç”¨è™•ç†ä¸åŒè³‡æ–™ï¼Ÿ
- [ ] è³‡æºæ˜¯å¦ä¾è³´è¼¸å…¥åƒæ•¸ï¼Ÿ
- [ ] æ˜¯å¦æœ‰æ¸¬è©¦å¤šå€‹é€£çºŒæ“ä½œçš„æƒ…å¢ƒï¼Ÿ

---

**æ™ºèƒ½æ¨¡å¼ç‰ˆæœ¬**: 2.0.2+auto-answer.1 (æ‡¶è¼‰å…¥ Bug å·²ä¿®å¾©)
**æ›´æ–°æ—¥æœŸ**: 2025-11-15 æ™šé–“
**æ›´æ–°è€…**: wizard03 (with Claude Code CLI - Gleipnir Project)

---

**æœ¬æ®µçµæŸ**

ğŸ“ **ç¹¼çºŒé–±è®€**: [CLAUDE_CODE_HANDOVER-2B.md](./CLAUDE_CODE_HANDOVER-2B.md) - GUI é–‹ç™¼ã€å¹³å°é·ç§»ã€Burp Suite åˆ†æ

---

*æ–‡æª”ç‰ˆæœ¬: 2.3A | æœ€å¾Œæ›´æ–°: 2025-12-06 | å°ˆæ¡ˆ: Gleipnir*
