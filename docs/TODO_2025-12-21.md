# 待辦事項清單 - 2025-12-21

**專案**: EEBot (Project Gleipnir) v2.3.6
**更新日期**: 2025-12-21
**維護者**: Claude Code (Sonnet 4.5)
**格式**: AI 友善 Markdown

---

## 🎯 優先級說明

- **P0 (Critical)**: 阻塞性問題，必須立即處理
- **P1 (High)**: 高優先級，影響主要功能
- **P2 (Medium)**: 中優先級，功能增強
- **P3 (Low)**: 低優先級，優化改進
- **P4 (Nice-to-have)**: 可選功能

---

## 📋 未完成任務（按優先級排序）

### P0 - Critical（無）
目前無阻塞性問題。

### P1 - High

#### 1. Phase 5.5: 測試批量模式的課程+考試混合處理
**優先級**: P1
**狀態**: ⏳ 待執行
**預估時間**: 30-45 分鐘
**前置條件**: Phase 5.1-5.4 已完成 ✅

**測試內容**:
1. **只有考試的計畫**
   - 測試案例: 「資通安全測驗(114年度)」
   - 驗證: 正確掃描並保存考試信息
   - 驗證: 不嘗試捕獲 Payload
   - 驗證: 只返回一次（不是兩次）

2. **只有課程的計畫**
   - 測試案例: 一般課程計畫
   - 驗證: 正常捕獲 Payload
   - 驗證: 正常發送時長
   - 驗證: 返回兩次

3. **混合計畫（課程+考試）**
   - 測試案例: 找一個既有課程又有考試的計畫
   - 驗證: 同時保存課程和考試
   - 驗證: 選擇菜單正確顯示兩種類型

4. **批量處理**
   - 選擇: 1 個課程 + 1 個考試
   - 驗證: Stage 3 正確處理兩種類型
   - 驗證: 統計信息正確區分
   - 驗證: Stage 4 只驗證課程

**測試步驟**:
```bash
# 1. 啟動程序
python menu.py

# 2. 選擇 h (課程處理增強功能)

# 3. 選擇 2 (批量模式)

# 4. Stage 1: 掃描
# 觀察輸出，確認課程和考試都被掃描

# 5. Stage 2: 選擇
# 驗證菜單顯示正確（📚 課程 / 📝 測驗）
# 選擇不同類型的項目

# 6. Stage 3: 處理
# 觀察課程發送時長
# 觀察考試自動答題

# 7. Stage 4: 驗證
# 確認只驗證課程

# 8. 檢查結果
# 查看統計信息是否正確
```

**驗收標準**:
- ✅ 只有考試的計畫不被跳過
- ✅ 選擇菜單正確顯示兩種類型
- ✅ Stage 3 根據類型正確處理
- ✅ Stage 4 只驗證課程
- ✅ 統計信息正確區分課程和考試
- ✅ 無錯誤或異常

**相關檔案**:
- `menu.py` (h 功能選項 2)
- `src/utils/course_selection_menu.py`

---

### P2 - Medium

#### 2. 實作 Burp Suite 分析建議（Phase 1）
**優先級**: P2
**狀態**: ⏳ 待執行
**預估時間**: 15 分鐘
**參考文檔**: `BURP_ANALYSIS_SUMMARY.md`

**任務 2.1**: 修改 Content-Type
- **檔案**: `src/api/visit_duration_api.py`
- **位置**: Line 103
- **修改**:
  ```python
  # 修改前
  'Content-Type': 'application/json; charset=UTF-8',

  # 修改後
  'Content-Type': 'text/plain;charset=UTF-8',
  ```

**任務 2.2**: 動態設置 Referer
- **檔案**: `src/api/visit_duration_api.py`
- **位置**: send_visit_duration 方法
- **修改**:
  ```python
  # 在構建 headers 之前添加
  if course_id:
      referer = f'{self.base_url}/course/{course_id}/content'
  else:
      referer = f'{self.base_url}/user/courses'

  # 修改 headers
  headers = {
      ...
      'Referer': referer,  # 動態設置
  }
  ```

**任務 2.3**: 測試修改
- 執行一個課程的時長發送
- 觀察日誌中的 Referer 值
- 確認成功率

**相關文檔**:
- `BURP_ANALYSIS_SUMMARY.md` (Phase 1)
- `BURP_ANALYSIS_FINDINGS_AND_RECOMMENDATIONS.md`

---

#### 3. 更新 User-Agent（Phase 2）
**優先級**: P2
**狀態**: ⏳ 待執行
**預估時間**: 10 分鐘
**參考文檔**: `BURP_ANALYSIS_SUMMARY.md`

**修改內容**:
- **檔案**: `src/api/visit_duration_api.py`
- **位置**: Line 75, 104
- **修改**:
  ```python
  # 修改前
  "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",

  # 修改後
  "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.0.0 Safari/537.36",
  ```

**添加日誌**:
```python
# 成功時
if response.status_code == 204:
    print(f'  ✓ API 調用成功 (Referer: {referer}, 時長: {visit_duration}秒)')
    return True
```

---

### P3 - Low

#### 4. PEP8 代碼規範整理
**優先級**: P3
**狀態**: ⏳ 待執行（長期任務）
**預估時間**: 持續進行
**參考文檔**: `docs/TODO_PEP8_PROGRESSIVE_MIGRATION.md`

**策略**: 漸進式遷移
- 只在修改檔案時同步進行 PEP8 整理
- 不單獨為 PEP8 修改代碼（避免大量變更）
- 使用工具輔助: `scripts/pep8_fix.bat`

**工具**:
```bash
# 檢查 PEP8 問題
scripts/pep8_check.bat

# 自動修復
scripts/pep8_fix.bat
```

**優先整理的模組**:
1. 新增的模組（如 `src/utils/course_selection_menu.py`）
2. 經常修改的模組（如 `menu.py`）
3. API 模組（`src/api/`）

---

#### 5. 添加日誌記錄系統（Burp Phase 3）
**優先級**: P3
**狀態**: ⏳ 待執行
**預估時間**: 30 分鐘
**參考文檔**: `BURP_ANALYSIS_SUMMARY.md`

**目標**: 記錄 API 調用詳情以分析成功率

**實作內容**:
1. 創建日誌檔案系統
2. 記錄每次調用:
   - 時間戳
   - course_id
   - visit_duration
   - Referer
   - 成功/失敗
   - 響應狀態碼

3. 定期分析:
   - 成功率模式
   - 哪些課程成功率高/低
   - Referer 是否影響成功率

**建議檔案結構**:
```
logs/
  api_calls_2025-12-21.json
  api_calls_2025-12-22.json
  ...
```

---

### P4 - Nice-to-have

#### 6. 文檔優化
**優先級**: P4
**狀態**: ⏳ 待執行
**預估時間**: 60 分鐘

**任務**:
1. 整理和歸檔舊文檔
2. 更新 README
3. 創建使用者手冊
4. 添加常見問題 (FAQ)

**文檔清單**:
- [ ] 整理交接文檔（HANDOVER 1-4）
- [ ] 歸檔歷史 CHANGELOG
- [ ] 更新主 README
- [ ] 創建測試指南
- [ ] 創建故障排除指南

---

#### 7. 性能優化
**優先級**: P4
**狀態**: ⏳ 待執行

**潛在優化點**:
1. 減少不必要的 `time.sleep()`
2. 優化頁面載入等待邏輯
3. 並行處理（如果可能）
4. 緩存機制（題庫、課程列表等）

---

## ✅ 已完成任務（本次會話）

### Phase 5.1: 修改 Stage 1 掃描邏輯
- ✅ 同時捕獲課程和考試信息
- ✅ 添加 item_type 欄位

### Phase 5.2: 修改 Stage 2 選擇菜單
- ✅ 支持課程和考試混合顯示
- ✅ 使用圖標區分（📚 📝）

### Phase 5.3: 初始化考試服務
- ✅ QuestionBankService
- ✅ ExamAutoAnswerInterceptor
- ✅ AnswerMatcher
- ✅ 雙模式 MitmProxy

### Phase 5.4: 修改 Stage 3 處理邏輯
- ✅ 根據 item_type 分別處理
- ✅ 更新統計信息

### 修復 Stage 4 KeyError
- ✅ 只驗證課程項目
- ✅ 添加類型過濾

### 修復 Stage 1 掃描邏輯
- ✅ 不跳過只有考試的計畫
- ✅ 課程處理條件化
- ✅ 考試保存獨立執行
- ✅ 返回邏輯條件化

---

## 📊 任務統計

### 本次會話
- ✅ 已完成: 6 個任務
- ⏳ 待執行: 7 個任務
- 🔄 進行中: 0 個任務

### 按優先級
- P0 (Critical): 0 個
- P1 (High): 1 個
- P2 (Medium): 2 個
- P3 (Low): 2 個
- P4 (Nice-to-have): 2 個

---

## 🔔 下次工作提醒

**下次開始工作時，請優先執行**:

1. ⚡ **P1 任務**: Phase 5.5 測試批量模式
   - 這是關鍵功能，必須驗證
   - 預估 30-45 分鐘
   - 參考: `docs/WORK_LOG_2025-12-21.md`

2. 📝 **P2 任務**: Burp Suite 分析建議
   - 提高 API 真實性
   - 預估 15 分鐘
   - 參考: `BURP_ANALYSIS_SUMMARY.md`

3. 📋 **更新文檔**: 根據測試結果更新文檔
   - 更新 CHANGELOG
   - 更新交接文檔

---

## 📚 相關文檔索引

### 工作記錄
- `docs/WORK_LOG_2025-12-21.md` - 本次工作日誌
- `docs/WORK_LOG_2025-12-18.md` - 上次工作日誌

### 交接文檔
- `docs/CLAUDE_CODE_HANDOVER-4.md` - 本次交接（待創建）
- `docs/CLAUDE_CODE_HANDOVER-3.md` - 上次交接

### 技術文檔
- `BURP_ANALYSIS_SUMMARY.md` - Burp Suite 分析
- `docs/HYBRID_DURATION_SEND_GUIDE.md` - 混合模式指南
- `docs/USAGE_GUIDE_CONSTANTS_EXCEPTIONS.md` - 常量和異常指南

### 開發指南
- `docs/TODO_PEP8_PROGRESSIVE_MIGRATION.md` - PEP8 遷移計畫
- `docs/TODO_CODE_QUALITY_2025-12-18.md` - 代碼質量待辦

---

## 🛠️ 可用工具

### 代碼質量
```bash
# PEP8 檢查
scripts/pep8_check.bat

# PEP8 自動修復
scripts/pep8_fix.bat
```

### 測試
```bash
# 運行程序
python menu.py

# 測試特定功能
# h -> 2 (批量模式)
# h -> 3 (考試自動答題)
```

### Git
```bash
# 查看狀態
git status

# 查看修改
git diff

# 提交
git add .
git commit -m "feat: 批量模式支持考試處理 (v2.3.7)"
```

---

**待辦清單更新完成** | 2025-12-21

**AI 使用說明**:
- 本文檔使用 Markdown 格式，便於 AI 解析
- 優先級標記清晰（P0-P4）
- 每個任務包含: 狀態、預估時間、驗收標準、相關檔案
- 使用視覺標記（✅ ⏳ ⚡ 等）方便快速識別
- 包含完整的檔案路徑和行號
- 提供代碼範例和測試步驟
